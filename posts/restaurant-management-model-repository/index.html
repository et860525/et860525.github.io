<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Restaurant Management 專案(二) - 建立 Model 與 Repository | Mango Blog</title><meta name=keywords content="TypeScript,Projects,Prisma,Express"><meta name=description content="接下來就要設計 Model 與建立 Repository 來跟資料庫進行交互。
首先，設計 Model 的範本是來自 Cheseto Restaurant POS App - Full Preview，此範本包含四個 table：

Table：餐廳裡的桌子
MenuItem：菜單品項
Order：訂單
Customer：客人的資訊

完成 Model 後，先寫出 repository.base 再套用到各自的 table 上，以上。
Github：et860525/restaurant-management"><meta name=author content="Chen Yu Fan"><link rel=canonical href=https://et860525.github.io/posts/restaurant-management-model-repository/><link crossorigin=anonymous href=/assets/css/stylesheet.8a2092fc98f6612604de3b346ecfc5a7b657cb2e369ffa419f118ac6e3bac6f7.css integrity="sha256-iiCS/Jj2YSYE3js0bs/Fp7ZXyy42n/pBnxGKxuO6xvc=" rel="preload stylesheet" as=style><link rel=icon href=https://et860525.github.io/images/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://et860525.github.io/images/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://et860525.github.io/images/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://et860525.github.io/apple-touch-icon.png><link rel=mask-icon href=https://et860525.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Restaurant Management 專案(二) - 建立 Model 與 Repository"><meta property="og:description" content="接下來就要設計 Model 與建立 Repository 來跟資料庫進行交互。
首先，設計 Model 的範本是來自 Cheseto Restaurant POS App - Full Preview，此範本包含四個 table：

Table：餐廳裡的桌子
MenuItem：菜單品項
Order：訂單
Customer：客人的資訊

完成 Model 後，先寫出 repository.base 再套用到各自的 table 上，以上。
Github：et860525/restaurant-management"><meta property="og:type" content="article"><meta property="og:url" content="https://et860525.github.io/posts/restaurant-management-model-repository/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-14T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-14T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Restaurant Management 專案(二) - 建立 Model 與 Repository"><meta name=twitter:description content="接下來就要設計 Model 與建立 Repository 來跟資料庫進行交互。
首先，設計 Model 的範本是來自 Cheseto Restaurant POS App - Full Preview，此範本包含四個 table：

Table：餐廳裡的桌子
MenuItem：菜單品項
Order：訂單
Customer：客人的資訊

完成 Model 後，先寫出 repository.base 再套用到各自的 table 上，以上。
Github：et860525/restaurant-management"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://et860525.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Restaurant Management 專案(二) - 建立 Model 與 Repository","item":"https://et860525.github.io/posts/restaurant-management-model-repository/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Restaurant Management 專案(二) - 建立 Model 與 Repository","name":"Restaurant Management 專案(二) - 建立 Model 與 Repository","description":"接下來就要設計 Model 與建立 Repository 來跟資料庫進行交互。\n首先，設計 Model 的範本是來自 Cheseto Restaurant POS App - Full Preview，此範本包含四個 table：\nTable：餐廳裡的桌子 MenuItem：菜單品項 Order：訂單 Customer：客人的資訊 完成 Model 後，先寫出 repository.base 再套用到各自的 table 上，以上。\nGithub：et860525/restaurant-management\n","keywords":["TypeScript","Projects","Prisma","Express"],"articleBody":"接下來就要設計 Model 與建立 Repository 來跟資料庫進行交互。\n首先，設計 Model 的範本是來自 Cheseto Restaurant POS App - Full Preview，此範本包含四個 table：\nTable：餐廳裡的桌子 MenuItem：菜單品項 Order：訂單 Customer：客人的資訊 完成 Model 後，先寫出 repository.base 再套用到各自的 table 上，以上。\nGithub：et860525/restaurant-management\n設計 Model 以上資料庫的重點為：\n一個顧客 (Customer) 可以有多張訂單 (Order) 一張桌子 (Table) 可以有多張訂單 (Order) 訂單 (Order) 與 菜單品項 (MenuItem) 是多對多 (many-to-many) 的關係，而這裡使用 Explicit many-to-many relations，原因是我想將菜單品項的數量放在裡面 以下是 Prisma 的程式碼：\ngenerator client { provider = \"prisma-client-js\" } datasource db { provider = \"postgresql\" url = env(\"DATABASE_URL\") } model Customer { id Int @id @default(autoincrement()) name String phone String email String @unique address String orders Order[] } model MenuItem { id Int @id @default(autoincrement()) name String description String? price Float orders OrderItem[] } model Order { id Int @id @default(autoincrement()) customer Customer @relation(fields: [customerId], references: [id]) customerId Int table Table @relation(fields: [tableId], references: [id]) tableId Int items OrderItem[] tag String @default(dbgenerated(\"lpad(nextval('order_tag_seq')::text, 6, '0')\")) status Order_status @default(PLACED) payment_method Payment @default(Cash) createdAt DateTime @default(now()) } model OrderItem { order Order @relation(fields: [orderId], references: [id]) orderId Int menuItem MenuItem @relation(fields: [menuItemId], references: [id]) menuItemId Int quantity Int @@id([orderId, menuItemId]) } model Table { id Int @id @default(autoincrement()) number Int capacity Int status Table_status @default(Free) orders Order[] } enum Order_status { PLACED IN_PROGRESS COMPLETED CANCELLED } enum Table_status { Free Checked_in Reserved } enum Payment { Cash Debit E_wallet } 首先要注意的是 Order 裡面的 tag 欄位，它的作用是將 tag 顯示成 000001。 @default(dbgenerated(\"lpad(nextval('order_tag_seq')::text, 6, '0')\"))：\ndbgenerated()：表示有些功能沒辦法再 Primsa 使用，但是在資料庫裡可以 lpad(string, length[, fill])：將指定字串的左邊填充指定字串到指定長度 nextval：根據 Sequences 的 INCREMENT 來獲得下一個值 由於 order_tag_seq 它的欄位型別是 SEQUENCE，但是在 Primsa 是無法加入這個型別的欄位，所以這裡必須要先將 migrate 檔案產生出來後，再來改裡面的 SQL 語法。其步驟為：\n先輸入 prisma migrate dev --create-only ( 參考來源 Customizing migrations ) 到剛剛產生的 migrate 檔案 (prisma/migrations/20230310190516_test/migration.sql) 下新增 CREATE SEQUENCE order_tag_seq START 1; 再使用 prisma migrate dev 即可完成 如果沒有上面的步驟，而是直接 migrate 就會出現錯誤，因為找不到 order_tag_seq 這個欄位。\nRepository 如果是使用 Mongoose 的專案，為了滿足Layered Architecture 就要先建立一個 Repository 來存放與資料庫交互的程式碼，再由需要資料庫資料的相關程式碼來呼叫，如：Service。但在 Prisma 裡就會比較簡單，這是因為 Prisma Client 本身就是一個 Object 直接使用即可，相關的資料格式可以在 Service 檔案裡做調整。\n嘗試寫一個 Repository Base 在使用 Prisma Client 時，我一直在嘗試讓程式碼更簡潔。因為我有四個 tables 就要建立四個 Repository 的檔案，我有想過讓每一個 table 都繼承一個 Repository Base 物件，並讓這個 Repository Base 直接實作所有獲取資料的方式，以下只是思考的程式碼並不能執行：\nimport { PrismaClient, MenuItem, Order, Customer, Table } from '@prisma/client'; export abstract class RepositoryBase { protected modelName: string = ''; private prisma = new PrismaClient(); public async get(id: number): Promise\u003cMenuItem | Order | Customer | Table | null\u003e { return await this.[modelName].findUnique({ where: { id: id }, }) } } 雖然這個樣子可以少寫程式碼，但是在有些 table 有 relations 時，可能就會需要使用到 include。如果是在 create 的情況下，就要在相應的 Repository 下重寫整個 create 程式碼，那這樣還不如就直接根據相對應的 table，來寫相對應的程式碼就好了。\n我有試過使用 switch，但是那個可讀性還不如寫在各自的 Repository 檔案裡\n實作 上面有說到，直接使用 Prisma Client 物件就可以了，所以這裡我會直接在 Service 檔案裡直接使用 Prisma Client：\nimport { Prisma, PrismaClient, MenuItem } from '@prisma/client'; export class MenuItemService { private readonly prisma = new PrismaClient(); public async get(id: number): Promise\u003cMenuItem | null\u003e { return await this.prisma.menuItem.findUnique({ where: { id: id }, }); } public async get_many( skip: number, take: number ): Promise\u003cMenuItem[] | null\u003e { return await this.prisma.menuItem.findMany({ skip: skip, take: take, }); } public async create( name: string, description: string, price: string ): Promise\u003cMenuItem\u003e { return await this.prisma.menuItem.create({ data: { name: name, description: description, price: Number(price), }, }); } public async delete(id: number): Promise\u003cMenuItem\u003e { return await this.prisma.menuItem.delete({ where: { id: id }, }); } } Controller 會將獲得的參數 ( req 或 Controller 本身的參數 ) 送到 Service 裡，Service 會使用 Prisma Client 來跟資料庫交互，最後獲得的結果再回傳給 Controller。\n目前我只完成 MenuItem table，後面三個參數我會慢慢完成，完成後，就會開始把前端的部分完成\n結語 因為官網文件很完整，所以設計 Model 的部分就沒有那麼多的問題。但是在設計 Repository 的部分就卡的比較久一點，就像上面嘗試的部分撰寫的一樣，我一直很想少寫這些近乎重複的程式碼，但也就是這些微的不同就會影響資料顯示的不同，但我還是想先把它們都寫出來後，再來慢慢的修改。\n","wordCount":"507","inLanguage":"en","datePublished":"2023-03-14T00:00:00Z","dateModified":"2023-03-14T00:00:00Z","author":{"@type":"Person","name":"Chen Yu Fan"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://et860525.github.io/posts/restaurant-management-model-repository/"},"publisher":{"@type":"Organization","name":"Mango Blog","logo":{"@type":"ImageObject","url":"https://et860525.github.io/images/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://et860525.github.io/ accesskey=h title="Mango Blog (Alt + H)">Mango Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://et860525.github.io/ title=Home><span>Home</span></a></li><li><a href=https://et860525.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://et860525.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://et860525.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://et860525.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://et860525.github.io/posts/>Posts</a></div><h1 class=post-title>Restaurant Management 專案(二) - 建立 Model 與 Repository</h1><div class=post-meta><span title='2023-03-14 00:00:00 +0000 UTC'>March 14, 2023</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Chen Yu Fan</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e8%a8%ad%e8%a8%88-model aria-label="設計 Model">設計 Model</a></li><li><a href=#repository aria-label=Repository>Repository</a><ul><li><a href=#%e5%98%97%e8%a9%a6%e5%af%ab%e4%b8%80%e5%80%8b-repository-base aria-label="嘗試寫一個 Repository Base">嘗試寫一個 Repository Base</a></li><li><a href=#%e5%af%a6%e4%bd%9c aria-label=實作>實作</a></li></ul></li><li><a href=#%e7%b5%90%e8%aa%9e aria-label=結語>結語</a></li></ul></div></details></div><div class=post-content><p>接下來就要設計 <code>Model</code> 與建立 <code>Repository</code> 來跟資料庫進行交互。</p><p>首先，設計 <code>Model</code> 的範本是來自 <a href=https://dribbble.com/shots/20762377-Cheseto-Restaurant-POS-App-Full-Preview>Cheseto Restaurant POS App - Full Preview</a>，此範本包含四個 table：</p><ol><li><strong>Table</strong>：餐廳裡的桌子</li><li><strong>MenuItem</strong>：菜單品項</li><li><strong>Order</strong>：訂單</li><li><strong>Customer</strong>：客人的資訊</li></ol><p>完成 <code>Model</code> 後，先寫出 <code>repository.base</code> 再套用到各自的 table 上，以上。</p><p>Github：<a href=https://github.com/et860525/restaurant-management>et860525/restaurant-management</a></p><h2 id=設計-model>設計 Model<a hidden class=anchor aria-hidden=true href=#設計-model>#</a></h2><p><img loading=lazy src=/images/Restaurant-management/model.png alt=model.png></p><p>以上資料庫的重點為：</p><ul><li>一個顧客 (Customer) 可以有多張訂單 (Order)</li><li>一張桌子 (Table) 可以有多張訂單 (Order)</li><li>訂單 (Order) 與 菜單品項 (MenuItem) 是<strong>多對多 (many-to-many)</strong> 的關係，而這裡使用 Explicit many-to-many relations，原因是我想將菜單品項的數量放在裡面</li></ul><p>以下是 Prisma 的程式碼：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>generator client {
</span></span><span class=line><span class=cl>  provider = &#34;prisma-client-js&#34;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>datasource db {
</span></span><span class=line><span class=cl>  provider = &#34;postgresql&#34;
</span></span><span class=line><span class=cl>  url      = env(&#34;DATABASE_URL&#34;)
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>model Customer {
</span></span><span class=line><span class=cl>  id        Int     @id @default(autoincrement())
</span></span><span class=line><span class=cl>  name      String
</span></span><span class=line><span class=cl>  phone     String
</span></span><span class=line><span class=cl>  email     String @unique
</span></span><span class=line><span class=cl>  address   String
</span></span><span class=line><span class=cl>  orders    Order[]
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>model MenuItem {
</span></span><span class=line><span class=cl>  id          Int     @id @default(autoincrement())  
</span></span><span class=line><span class=cl>  name        String
</span></span><span class=line><span class=cl>  description String?
</span></span><span class=line><span class=cl>  price       Float 
</span></span><span class=line><span class=cl>  orders      OrderItem[]
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>model Order {
</span></span><span class=line><span class=cl>  id             Int          @id @default(autoincrement())
</span></span><span class=line><span class=cl>  customer       Customer     @relation(fields: [customerId], references: [id])
</span></span><span class=line><span class=cl>  customerId     Int
</span></span><span class=line><span class=cl>  table          Table        @relation(fields: [tableId], references: [id])
</span></span><span class=line><span class=cl>  tableId        Int
</span></span><span class=line><span class=cl>  items          OrderItem[]
</span></span><span class=line><span class=cl>  tag            String       @default(dbgenerated(&#34;lpad(nextval(&#39;order_tag_seq&#39;)::text, 6, &#39;0&#39;)&#34;))
</span></span><span class=line><span class=cl>  status         Order_status @default(PLACED)
</span></span><span class=line><span class=cl>  payment_method Payment      @default(Cash)     
</span></span><span class=line><span class=cl>  createdAt      DateTime     @default(now())
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>model OrderItem {
</span></span><span class=line><span class=cl>  order      Order    @relation(fields: [orderId], references: [id])
</span></span><span class=line><span class=cl>  orderId    Int
</span></span><span class=line><span class=cl>  menuItem   MenuItem @relation(fields: [menuItemId], references: [id])
</span></span><span class=line><span class=cl>  menuItemId Int
</span></span><span class=line><span class=cl>  quantity   Int
</span></span><span class=line><span class=cl>     
</span></span><span class=line><span class=cl>  @@id([orderId, menuItemId])
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>model Table {
</span></span><span class=line><span class=cl>  id         Int          @id @default(autoincrement())
</span></span><span class=line><span class=cl>  number     Int
</span></span><span class=line><span class=cl>  capacity   Int
</span></span><span class=line><span class=cl>  status     Table_status @default(Free)
</span></span><span class=line><span class=cl>  orders     Order[]
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>enum Order_status {
</span></span><span class=line><span class=cl>  PLACED
</span></span><span class=line><span class=cl>  IN_PROGRESS
</span></span><span class=line><span class=cl>  COMPLETED
</span></span><span class=line><span class=cl>  CANCELLED
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>enum Table_status {
</span></span><span class=line><span class=cl>  Free
</span></span><span class=line><span class=cl>  Checked_in
</span></span><span class=line><span class=cl>  Reserved
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>enum Payment {
</span></span><span class=line><span class=cl>  Cash
</span></span><span class=line><span class=cl>  Debit
</span></span><span class=line><span class=cl>  E_wallet
</span></span><span class=line><span class=cl>}
</span></span></code></pre></div><p>首先要注意的是 Order 裡面的 <code>tag</code> 欄位，它的作用是將 tag 顯示成 <code>000001</code>。 <code>@default(dbgenerated("lpad(nextval('order_tag_seq')::text, 6, '0')"))</code>：</p><ul><li><a href=https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference#dbgenerated>dbgenerated()</a>：表示有些功能沒辦法再 Primsa 使用，但是在資料庫裡可以</li><li><a href=https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-lpad/>lpad(string, length[, fill])</a>：將指定字串的左邊填充指定字串到指定長度</li><li><a href=https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-sequences/>nextval</a>：根據 <code>Sequences</code> 的 <code>INCREMENT</code> 來獲得下一個值</li></ul><p>由於 <code>order_tag_seq</code> 它的欄位型別是 <code>SEQUENCE</code>，但是在 Primsa 是無法加入這個型別的欄位，所以這裡必須要先將 <code>migrate</code> 檔案產生出來後，再來改裡面的 SQL 語法。其步驟為：</p><ol><li>先輸入 <code>prisma migrate dev --create-only</code> ( 參考來源 <a href=https://www.prisma.io/docs/concepts/components/prisma-migrate/migrate-development-production#customizing-migrations>Customizing migrations</a> )</li><li>到剛剛產生的 migrate 檔案 (<code>prisma/migrations/20230310190516_test/migration.sql</code>) 下新增 <code>CREATE SEQUENCE order_tag_seq START 1;</code></li><li>再使用 <code>prisma migrate dev</code> 即可完成</li></ol><p>如果沒有上面的步驟，而是直接 migrate 就會出現錯誤，因為找不到 <code>order_tag_seq</code> 這個欄位。</p><h2 id=repository>Repository<a hidden class=anchor aria-hidden=true href=#repository>#</a></h2><p>如果是使用 Mongoose 的專案，為了滿足<a href=https://www.oreilly.com/library/view/software-architecture-patterns/9781491971437/ch01.html>Layered Architecture</a> 就要先建立一個 <a href=https://github.com/et860525/express-project-architecture/tree/main/src/repositories>Repository</a> 來存放與資料庫交互的程式碼，再由需要資料庫資料的相關程式碼來呼叫，如：<a href=https://github.com/et860525/express-project-architecture/blob/main/src/main/api/todo/todo.service.ts>Service</a>。但在 Prisma 裡就會比較簡單，這是因為 <a href=https://www.prisma.io/docs/concepts/components/prisma-client>Prisma Client</a> 本身就是一個 Object 直接使用即可，相關的資料格式可以在 <code>Service</code> 檔案裡做調整。</p><h3 id=嘗試寫一個-repository-base>嘗試寫一個 Repository Base<a hidden class=anchor aria-hidden=true href=#嘗試寫一個-repository-base>#</a></h3><p>在使用 Prisma Client 時，我一直在嘗試讓程式碼更簡潔。因為我有四個 tables 就要建立四個 <code>Repository</code> 的檔案，我有想過讓每一個 table 都繼承一個 <code>Repository Base</code> 物件，並讓這個 <code>Repository Base</code> 直接實作所有獲取資料的方式，以下只是思考的程式碼並不能執行：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>PrismaClient</span><span class=p>,</span> <span class=nx>MenuItem</span><span class=p>,</span> <span class=nx>Order</span><span class=p>,</span> <span class=nx>Customer</span><span class=p>,</span> <span class=nx>Table</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@prisma/client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>abstract</span> <span class=kr>class</span> <span class=nx>RepositoryBase</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>protected</span> <span class=nx>modelName</span>: <span class=kt>string</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kr>private</span> <span class=nx>prisma</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PrismaClient</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kr>public</span> <span class=kr>async</span> <span class=kr>get</span><span class=p>(</span><span class=nx>id</span>: <span class=kt>number</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>MenuItem</span> <span class=err>|</span> <span class=na>Order</span> <span class=err>|</span> <span class=na>Customer</span> <span class=err>|</span> <span class=na>Table</span> <span class=err>|</span> <span class=na>null</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=k>await</span> <span class=k>this</span><span class=p>.[</span><span class=nx>modelName</span><span class=p>].</span><span class=nx>findUnique</span><span class=p>({</span>
</span></span><span class=line><span class=cl>			<span class=nx>where</span><span class=o>:</span> <span class=p>{</span> <span class=nx>id</span>: <span class=kt>id</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>雖然這個樣子可以少寫程式碼，但是在有些 table 有 relations 時，可能就會需要使用到 <code>include</code>。如果是在 <code>create</code> 的情況下，就要在相應的 <code>Repository</code> 下重寫整個 <code>create</code> 程式碼，那這樣還不如就直接根據相對應的 table，來寫相對應的程式碼就好了。</p><blockquote><p>我有試過使用 <code>switch</code>，但是那個可讀性還不如寫在各自的 <code>Repository</code> 檔案裡</p></blockquote><h3 id=實作>實作<a hidden class=anchor aria-hidden=true href=#實作>#</a></h3><p>上面有說到，直接使用 Prisma Client 物件就可以了，所以這裡我會直接在 <code>Service</code> 檔案裡直接使用 Prisma Client：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Prisma</span><span class=p>,</span> <span class=nx>PrismaClient</span><span class=p>,</span> <span class=nx>MenuItem</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@prisma/client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>MenuItemService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>prisma</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PrismaClient</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=kr>async</span> <span class=kr>get</span><span class=p>(</span><span class=nx>id</span>: <span class=kt>number</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>MenuItem</span> <span class=err>|</span> <span class=na>null</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>prisma</span><span class=p>.</span><span class=nx>menuItem</span><span class=p>.</span><span class=nx>findUnique</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>where</span><span class=o>:</span> <span class=p>{</span> <span class=nx>id</span>: <span class=kt>id</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=kr>async</span> <span class=nx>get_many</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>skip</span>: <span class=kt>number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>take</span>: <span class=kt>number</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>MenuItem</span><span class=err>[]</span> <span class=err>|</span> <span class=na>null</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>prisma</span><span class=p>.</span><span class=nx>menuItem</span><span class=p>.</span><span class=nx>findMany</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>skip</span>: <span class=kt>skip</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>take</span>: <span class=kt>take</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=kr>async</span> <span class=nx>create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span>: <span class=kt>string</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>description</span>: <span class=kt>string</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>price</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>MenuItem</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>prisma</span><span class=p>.</span><span class=nx>menuItem</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>name</span>: <span class=kt>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>description</span>: <span class=kt>description</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>price</span>: <span class=kt>Number</span><span class=p>(</span><span class=nx>price</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=kr>async</span> <span class=k>delete</span><span class=p>(</span><span class=nx>id</span>: <span class=kt>number</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>MenuItem</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>prisma</span><span class=p>.</span><span class=nx>menuItem</span><span class=p>.</span><span class=k>delete</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>where</span><span class=o>:</span> <span class=p>{</span> <span class=nx>id</span>: <span class=kt>id</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>Controller</code> 會將獲得的參數 ( <code>req</code> 或 <code>Controller</code> 本身的參數 ) 送到 <code>Service</code> 裡，<code>Service</code> 會使用 Prisma Client 來跟資料庫交互，最後獲得的結果再回傳給 <code>Controller</code>。</p><blockquote><p>目前我只完成 <code>MenuItem</code> table，後面三個參數我會慢慢完成，完成後，就會開始把前端的部分完成</p></blockquote><h2 id=結語>結語<a hidden class=anchor aria-hidden=true href=#結語>#</a></h2><p>因為<a href=https://www.prisma.io/docs/concepts/components/prisma-schema>官網文件</a>很完整，所以設計 <code>Model</code> 的部分就沒有那麼多的問題。但是在設計 <code>Repository</code> 的部分就卡的比較久一點，就像上面嘗試的部分撰寫的一樣，我一直很想少寫這些近乎重複的程式碼，但也就是這些微的不同就會影響資料顯示的不同，但我還是想先把它們都寫出來後，再來慢慢的修改。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://et860525.github.io/tags/typescript/>TypeScript</a></li><li><a href=https://et860525.github.io/tags/projects/>Projects</a></li><li><a href=https://et860525.github.io/tags/prisma/>Prisma</a></li><li><a href=https://et860525.github.io/tags/express/>Express</a></li></ul><nav class=paginav><a class=next href=https://et860525.github.io/posts/restaurant-management-init/><span class=title>Next »</span><br><span>Restaurant Management 專案(一) - 架構與初始化</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Restaurant Management 專案(二) - 建立 Model 與 Repository on twitter" href="https://twitter.com/intent/tweet/?text=Restaurant%20Management%20%e5%b0%88%e6%a1%88%28%e4%ba%8c%29%20-%20%e5%bb%ba%e7%ab%8b%20Model%20%e8%88%87%20Repository&amp;url=https%3a%2f%2fet860525.github.io%2fposts%2frestaurant-management-model-repository%2f&amp;hashtags=TypeScript%2cProjects%2cPrisma%2cExpress"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Restaurant Management 專案(二) - 建立 Model 與 Repository on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fet860525.github.io%2fposts%2frestaurant-management-model-repository%2f&amp;title=Restaurant%20Management%20%e5%b0%88%e6%a1%88%28%e4%ba%8c%29%20-%20%e5%bb%ba%e7%ab%8b%20Model%20%e8%88%87%20Repository&amp;summary=Restaurant%20Management%20%e5%b0%88%e6%a1%88%28%e4%ba%8c%29%20-%20%e5%bb%ba%e7%ab%8b%20Model%20%e8%88%87%20Repository&amp;source=https%3a%2f%2fet860525.github.io%2fposts%2frestaurant-management-model-repository%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Restaurant Management 專案(二) - 建立 Model 與 Repository on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fet860525.github.io%2fposts%2frestaurant-management-model-repository%2f&title=Restaurant%20Management%20%e5%b0%88%e6%a1%88%28%e4%ba%8c%29%20-%20%e5%bb%ba%e7%ab%8b%20Model%20%e8%88%87%20Repository"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Restaurant Management 專案(二) - 建立 Model 與 Repository on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fet860525.github.io%2fposts%2frestaurant-management-model-repository%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Restaurant Management 專案(二) - 建立 Model 與 Repository on whatsapp" href="https://api.whatsapp.com/send?text=Restaurant%20Management%20%e5%b0%88%e6%a1%88%28%e4%ba%8c%29%20-%20%e5%bb%ba%e7%ab%8b%20Model%20%e8%88%87%20Repository%20-%20https%3a%2f%2fet860525.github.io%2fposts%2frestaurant-management-model-repository%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Restaurant Management 專案(二) - 建立 Model 與 Repository on telegram" href="https://telegram.me/share/url?text=Restaurant%20Management%20%e5%b0%88%e6%a1%88%28%e4%ba%8c%29%20-%20%e5%bb%ba%e7%ab%8b%20Model%20%e8%88%87%20Repository&amp;url=https%3a%2f%2fet860525.github.io%2fposts%2frestaurant-management-model-repository%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://et860525.github.io/>Mango Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>