<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Node.js + JWT Authentication 專案(一) - 初始化專案 | Mango Blog</title><meta name=keywords content="Node.js,TypeScript,Express,MongoDB,Projects,API"><meta name=description content="這個專案會使用 Node.js 和 TypeScript 來建構 REST API 後端，使用 JWT 來實作身分認證與授權。

此專案會遵循我慣用的 OOP 架構  et860525/express-project-architecture，有鑑於上一次專案的經驗，由於這些都只是小專案，我不會把所有東西都全部都包在 class 裡面

建構此專案會用到的重要套件：



Package
Usage




Express
Web 應用框架


TypeScript
開發工具


Mongoose
訪問資料庫


Docker
應用容器化


MongoDB
儲存使用者的資料庫


Redis
儲存使用者緩存的 session 資料庫


JsonWebToken
產生 JWTs


Bcryptjs
密碼加密


Zod
驗證使用者的輸入


Typegoose
使用 TypeScript 優化 Mongoose 模型


Dotenv
讀取環境變數


Cors
允許資料能在前端與後端之間分享


lodash
對 JavaScript 的功能擴充


ts-node-dev
當檔案變更時自動重啟


"><meta name=author content="Chen Yu Fan"><link rel=canonical href=https://et860525.github.io/posts/jwt-authentication-init/><link crossorigin=anonymous href=/assets/css/stylesheet.8a2092fc98f6612604de3b346ecfc5a7b657cb2e369ffa419f118ac6e3bac6f7.css integrity="sha256-iiCS/Jj2YSYE3js0bs/Fp7ZXyy42n/pBnxGKxuO6xvc=" rel="preload stylesheet" as=style><link rel=icon href=https://et860525.github.io/images/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://et860525.github.io/images/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://et860525.github.io/images/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://et860525.github.io/apple-touch-icon.png><link rel=mask-icon href=https://et860525.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Node.js + JWT Authentication 專案(一) - 初始化專案"><meta property="og:description" content="這個專案會使用 Node.js 和 TypeScript 來建構 REST API 後端，使用 JWT 來實作身分認證與授權。

此專案會遵循我慣用的 OOP 架構  et860525/express-project-architecture，有鑑於上一次專案的經驗，由於這些都只是小專案，我不會把所有東西都全部都包在 class 裡面

建構此專案會用到的重要套件：



Package
Usage




Express
Web 應用框架


TypeScript
開發工具


Mongoose
訪問資料庫


Docker
應用容器化


MongoDB
儲存使用者的資料庫


Redis
儲存使用者緩存的 session 資料庫


JsonWebToken
產生 JWTs


Bcryptjs
密碼加密


Zod
驗證使用者的輸入


Typegoose
使用 TypeScript 優化 Mongoose 模型


Dotenv
讀取環境變數


Cors
允許資料能在前端與後端之間分享


lodash
對 JavaScript 的功能擴充


ts-node-dev
當檔案變更時自動重啟


"><meta property="og:type" content="article"><meta property="og:url" content="https://et860525.github.io/posts/jwt-authentication-init/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-11T00:00:00+00:00"><meta property="article:modified_time" content="2023-04-11T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Node.js + JWT Authentication 專案(一) - 初始化專案"><meta name=twitter:description content="這個專案會使用 Node.js 和 TypeScript 來建構 REST API 後端，使用 JWT 來實作身分認證與授權。

此專案會遵循我慣用的 OOP 架構  et860525/express-project-architecture，有鑑於上一次專案的經驗，由於這些都只是小專案，我不會把所有東西都全部都包在 class 裡面

建構此專案會用到的重要套件：



Package
Usage




Express
Web 應用框架


TypeScript
開發工具


Mongoose
訪問資料庫


Docker
應用容器化


MongoDB
儲存使用者的資料庫


Redis
儲存使用者緩存的 session 資料庫


JsonWebToken
產生 JWTs


Bcryptjs
密碼加密


Zod
驗證使用者的輸入


Typegoose
使用 TypeScript 優化 Mongoose 模型


Dotenv
讀取環境變數


Cors
允許資料能在前端與後端之間分享


lodash
對 JavaScript 的功能擴充


ts-node-dev
當檔案變更時自動重啟


"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://et860525.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Node.js + JWT Authentication 專案(一) - 初始化專案","item":"https://et860525.github.io/posts/jwt-authentication-init/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Node.js + JWT Authentication 專案(一) - 初始化專案","name":"Node.js \u002b JWT Authentication 專案(一) - 初始化專案","description":"這個專案會使用 Node.js 和 TypeScript 來建構 REST API 後端，使用 JWT 來實作身分認證與授權。\n此專案會遵循我慣用的 OOP 架構 et860525/express-project-architecture，有鑑於上一次專案的經驗，由於這些都只是小專案，我不會把所有東西都全部都包在 class 裡面\n建構此專案會用到的重要套件：\nPackage Usage Express Web 應用框架 TypeScript 開發工具 Mongoose 訪問資料庫 Docker 應用容器化 MongoDB 儲存使用者的資料庫 Redis 儲存使用者緩存的 session 資料庫 JsonWebToken 產生 JWTs Bcryptjs 密碼加密 Zod 驗證使用者的輸入 Typegoose 使用 TypeScript 優化 Mongoose 模型 Dotenv 讀取環境變數 Cors 允許資料能在前端與後端之間分享 lodash 對 JavaScript 的功能擴充 ts-node-dev 當檔案變更時自動重啟 ","keywords":["Node.js","TypeScript","Express","MongoDB","Projects","API"],"articleBody":"這個專案會使用 Node.js 和 TypeScript 來建構 REST API 後端，使用 JWT 來實作身分認證與授權。\n此專案會遵循我慣用的 OOP 架構 et860525/express-project-architecture，有鑑於上一次專案的經驗，由於這些都只是小專案，我不會把所有東西都全部都包在 class 裡面\n建構此專案會用到的重要套件：\nPackage Usage Express Web 應用框架 TypeScript 開發工具 Mongoose 訪問資料庫 Docker 應用容器化 MongoDB 儲存使用者的資料庫 Redis 儲存使用者緩存的 session 資料庫 JsonWebToken 產生 JWTs Bcryptjs 密碼加密 Zod 驗證使用者的輸入 Typegoose 使用 TypeScript 優化 Mongoose 模型 Dotenv 讀取環境變數 Cors 允許資料能在前端與後端之間分享 lodash 對 JavaScript 的功能擴充 ts-node-dev 當檔案變更時自動重啟 JWT 驗證流程 使用者需要提供瀏覽器帳號密碼來做登入。前端會發送帶有使用者憑證的請求到後端，當後端驗證成功後，會傳送使用者相關的 cookies 回到前端。\n使用者註冊的流程：\n使用者登入的流程：\nAPI 路由設置 HTTP Method Route Description GET /api/users 回傳所有使用者的資訊 GET /api/users/me 回傳已登入者的資訊 POST /api/auth/register 註冊新用戶 POST /api/auth/login 登入 初始化專案 建立資料夾並初始化： mkdir jwt-auth-node cd jwt-auth-node pnpm init 安裝套件 安裝相關套件： pnpm install @typegoose/typegoose bcryptjs cookie-parser dotenv express jsonwebtoken lodash mongoose redis ts-node-dev zod cors 安裝開發用套件： pnpm install -D morgan typescript 安裝 Type Definition 檔案： pnpm install -D @types/bcryptjs @types/cookie-parser @types/express @types/jsonwebtoken @types/lodash @types/morgan @types/node @types/cors TypeScript 相關設定 產生 tsconfig.json 檔案： tsc --init tsconfig.json： { \"compilerOptions\": { \"target\": \"es2017\", \"experimentalDecorators\": true, \"emitDecoratorMetadata\": true, \"module\": \"commonjs\", \"rootDir\": \"./src\", \"outDir\": \"./dist\", \"esModuleInterop\": true, \"forceConsistentCasingInFileNames\": true, \"strict\": true, \"skipLibCheck\": true } } 在 How to Start using typegoose 有說明，以下兩個設定一定要開啟：\nexperimentalDecorators: true emitDecoratorMetadata: true 簡單的 Express Server 建立 ./.env 檔案： PORT=3000 ./src/app.ts： import dotenv from 'dotenv'; import express, { Request, Response } from 'express'; dotenv.config(); const env = process.env.NODE_ENV; const port = process.env.PORT; const app = express(); app.get('/', (req: Request, res: Response) =\u003e { res.send('JWT + Express + TypeScript Server'); }); app.listen(port, () =\u003e { console.log( `[server]: Server is running at http://localhost:${port} in ${env}` ); ; 在 ./package.json 裡寫一個啟動腳本： \"scripts\": { \"dev\": \"NODE_ENV=development ts-node-dev --respawn src/app.ts\" } 啟動伺服器： pnpm dev 並訪問 http://localhost:3000 就可以看到成功畫面。\n使用 Docker Compose 設定資料庫 在專案目錄下新增一個檔案 ./docker-compose.yaml： services: mongo: image: mongo:4.4.19-focal container_name: mongo environment: MONGO_INITDB_ROOT_USERNAME: ${MONGODB_USERNAME} MONGO_INITDB_ROOT_PASSWORD: ${MONGODB_PASSWORD} MONGO_INITDB_DATABASE: ${MONGODB_DATABASE} env_file: - ./.env ports: - '6017:27017' volumes: - mongo:/data/db - ./init-mongo.sh:/docker-entrypoint-initdb.d/init-mongo.sh:ro redis: image: redis:latest container_name: redis ports: - '6379:6379' volumes: - redis:/data volumes: mongo: redis: docker-compose.yaml 檔案會使用專案下 .env 裡的設定，所以要新增所需要的相關設定：\n.env PORT=3000 MONGODB_USERNAME=jwtweb MONGODB_PASSWORD=pwd123 MONGODB_DATABASE=jwtAuth 當 MongoDB 建立後，它並不會自動建立 database。這就是 ./init-mongo.sh:/docker-entrypoint-initdb.d/init-mongo.sh:ro 的功用，寫一個初始化資料庫的檔案並掛載到容器裡。\n在專案目錄下新增一個檔案 ./init-mongo.sh：\nmongo \u003c\u003c EOF db = db.getSiblingDB('jwtAuth') db.createUser({ user: '${MONGODB_USERNAME}', pwd: '${MONGODB_PASSWORD}', roles: [ { role: 'readWrite', db: '${MONGODB_DATABASE}', }, ], }); EOF 完成後使用下面指令來運行：\ndocker compose up -d 如果要停止的話可以使用：\ndocker compose down # or docker compose down -v # 停止並刪除 volume 連接到 MongoDB ./src/database/connectMongo import mongoose from 'mongoose'; const db_user = process.env.MONGODB_USERNAME; const db_pwd = process.env.MONGODB_PASSWORD; const db_name = process.env.MONGODB_DATABASE; mongoose.set('strictQuery', false); const url = `mongodb://${db_user}:${db_pwd}@localhost:6017/${db_name}`; const connectDB = async () =\u003e { try { await mongoose.connect(url); console.log('Database connected...'); } catch (error: any) { console.log(error.message); setTimeout(connectDB, 5000); } }; export default connectDB; 讓 app.ts 連接： import connectDB from './database/connectMongo'; //... app.listen(port, () =\u003e { console.log( `[server]: Server is running at http://localhost:${port} in ${env}` ); connectDB(); }); 連接到 Redis ./src/database/connectRedis import { createClient } from 'redis'; const redisUrl = 'redis://localhost:6379'; const redisClient = createClient({ url: redisUrl, }); const connectRedis = async () =\u003e { try { await redisClient.connect(); console.log('Redis client connect...'); } catch (err: any) { console.log(err.message); setTimeout(connectRedis, 5000); } }; connectRedis(); redisClient.on('error', (err) =\u003e console.log(err)); export default redisClient; 因為 Redis 只會儲存 session 狀態，所以目前還不需要套用在任何地方。\n可以到我的 et860525/jwt-auth-node 來查看程式碼\n結語 自從上一次發文後馬上就確診了，所以新的專案就停了一陣子。這次的專案是結合以前所學過的東西，來實作一個簡單的 JWT (JSON Web Tokens) RESTful API。\n下一個章節會從建立資料庫的 model 開始。\n","wordCount":"497","inLanguage":"en","datePublished":"2023-04-11T00:00:00Z","dateModified":"2023-04-11T00:00:00Z","author":{"@type":"Person","name":"Chen Yu Fan"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://et860525.github.io/posts/jwt-authentication-init/"},"publisher":{"@type":"Organization","name":"Mango Blog","logo":{"@type":"ImageObject","url":"https://et860525.github.io/images/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://et860525.github.io/ accesskey=h title="Mango Blog (Alt + H)">Mango Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://et860525.github.io/ title=Home><span>Home</span></a></li><li><a href=https://et860525.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://et860525.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://et860525.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://et860525.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://et860525.github.io/posts/>Posts</a></div><h1 class=post-title>Node.js + JWT Authentication 專案(一) - 初始化專案</h1><div class=post-meta><span title='2023-04-11 00:00:00 +0000 UTC'>April 11, 2023</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Chen Yu Fan</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#jwt-%e9%a9%97%e8%ad%89%e6%b5%81%e7%a8%8b aria-label="JWT 驗證流程">JWT 驗證流程</a></li><li><a href=#api-%e8%b7%af%e7%94%b1%e8%a8%ad%e7%bd%ae aria-label="API 路由設置">API 路由設置</a></li><li><a href=#%e5%88%9d%e5%a7%8b%e5%8c%96%e5%b0%88%e6%a1%88 aria-label=初始化專案>初始化專案</a><ul><li><a href=#%e5%ae%89%e8%a3%9d%e5%a5%97%e4%bb%b6 aria-label=安裝套件>安裝套件</a></li><li><a href=#typescript-%e7%9b%b8%e9%97%9c%e8%a8%ad%e5%ae%9a aria-label="TypeScript 相關設定">TypeScript 相關設定</a></li><li><a href=#%e7%b0%a1%e5%96%ae%e7%9a%84-express-server aria-label="簡單的 Express Server">簡單的 Express Server</a></li></ul></li><li><a href=#%e4%bd%bf%e7%94%a8-docker-compose-%e8%a8%ad%e5%ae%9a%e8%b3%87%e6%96%99%e5%ba%ab aria-label="使用 Docker Compose 設定資料庫">使用 Docker Compose 設定資料庫</a></li><li><a href=#%e9%80%a3%e6%8e%a5%e5%88%b0-mongodb aria-label="連接到 MongoDB">連接到 MongoDB</a></li><li><a href=#%e9%80%a3%e6%8e%a5%e5%88%b0-redis aria-label="連接到 Redis">連接到 Redis</a></li><li><a href=#%e7%b5%90%e8%aa%9e aria-label=結語>結語</a></li></ul></div></details></div><div class=post-content><p>這個專案會使用 Node.js 和 TypeScript 來建構 REST API 後端，使用 <a href=https://jwt.io/>JWT</a> 來實作身分認證與授權。</p><blockquote><p>此專案會遵循我慣用的 OOP 架構 <a href=https://github.com/et860525/express-project-architecture>et860525/express-project-architecture</a>，有鑑於上一次專案的經驗，由於這些都只是小專案，我不會把所有東西都全部都包在 class 裡面</p></blockquote><p>建構此專案會用到的重要套件：</p><table><thead><tr><th>Package</th><th>Usage</th></tr></thead><tbody><tr><td><a href=https://expressjs.com/>Express</a></td><td>Web 應用框架</td></tr><tr><td><a href=https://www.typescriptlang.org/>TypeScript</a></td><td>開發工具</td></tr><tr><td><a href=https://mongoosejs.com/>Mongoose</a></td><td>訪問資料庫</td></tr><tr><td><a href=https://www.docker.com/>Docker</a></td><td>應用容器化</td></tr><tr><td><a href=https://www.mongodb.com/>MongoDB</a></td><td>儲存使用者的資料庫</td></tr><tr><td><a href=https://www.npmjs.com/package/redis>Redis</a></td><td>儲存使用者緩存的 session 資料庫</td></tr><tr><td><a href=https://github.com/auth0/node-jsonwebtoken>JsonWebToken</a></td><td>產生 JWTs</td></tr><tr><td><a href=https://github.com/dcodeIO/bcrypt.js>Bcryptjs</a></td><td>密碼加密</td></tr><tr><td><a href=https://github.com/colinhacks/zod>Zod</a></td><td>驗證使用者的輸入</td></tr><tr><td><a href=https://typegoose.github.io/typegoose/>Typegoose</a></td><td>使用 TypeScript 優化 Mongoose 模型</td></tr><tr><td><a href=https://github.com/motdotla/dotenv>Dotenv</a></td><td>讀取環境變數</td></tr><tr><td><a href=https://github.com/expressjs/cors>Cors</a></td><td>允許資料能在前端與後端之間分享</td></tr><tr><td><a href=https://lodash.com/>lodash</a></td><td>對 JavaScript 的功能擴充</td></tr><tr><td><a href=https://github.com/wclr/ts-node-dev>ts-node-dev</a></td><td>當檔案變更時自動重啟</td></tr></tbody></table><h2 id=jwt-驗證流程>JWT 驗證流程<a hidden class=anchor aria-hidden=true href=#jwt-驗證流程>#</a></h2><p><img loading=lazy src=/images/JWT-authentication/JWT-authentication-flow.png alt=JWT-authentication-flow.png></p><p>使用者需要提供瀏覽器帳號密碼來做登入。<strong>前端</strong>會發送帶有使用者憑證的請求到<strong>後端</strong>，當<strong>後端</strong>驗證成功後，會傳送使用者相關的 <code>cookies</code> 回到<strong>前端</strong>。</p><ul><li><p>使用者註冊的流程：</p><p><img loading=lazy src=/images/JWT-authentication/JWT-registration-flow.png alt=JWT-registration-flow.png></p></li><li><p>使用者登入的流程：</p><p><img loading=lazy src=/images/JWT-authentication/JWT-login-flow.png alt=JWT-login-flow.png></p></li></ul><h2 id=api-路由設置>API 路由設置<a hidden class=anchor aria-hidden=true href=#api-路由設置>#</a></h2><table><thead><tr><th>HTTP Method</th><th>Route</th><th>Description</th></tr></thead><tbody><tr><td>GET</td><td><code>/api/users</code></td><td>回傳所有使用者的資訊</td></tr><tr><td>GET</td><td><code>/api/users/me</code></td><td>回傳已登入者的資訊</td></tr><tr><td>POST</td><td><code>/api/auth/register</code></td><td>註冊新用戶</td></tr><tr><td>POST</td><td><code>/api/auth/login</code></td><td>登入</td></tr></tbody></table><h2 id=初始化專案>初始化專案<a hidden class=anchor aria-hidden=true href=#初始化專案>#</a></h2><ul><li>建立資料夾並初始化：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir jwt-auth-node
</span></span><span class=line><span class=cl><span class=nb>cd</span> jwt-auth-node
</span></span><span class=line><span class=cl>pnpm init
</span></span></code></pre></div><h3 id=安裝套件>安裝套件<a hidden class=anchor aria-hidden=true href=#安裝套件>#</a></h3><ul><li>安裝相關套件：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pnpm install @typegoose/typegoose bcryptjs cookie-parser dotenv express jsonwebtoken lodash mongoose redis ts-node-dev zod cors
</span></span></code></pre></div><ul><li>安裝開發用套件：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pnpm install -D morgan typescript
</span></span></code></pre></div><ul><li>安裝 Type Definition 檔案：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pnpm install -D @types/bcryptjs @types/cookie-parser @types/express @types/jsonwebtoken @types/lodash @types/morgan @types/node @types/cors
</span></span></code></pre></div><h3 id=typescript-相關設定>TypeScript 相關設定<a hidden class=anchor aria-hidden=true href=#typescript-相關設定>#</a></h3><ul><li>產生 <code>tsconfig.json</code> 檔案：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tsc --init
</span></span></code></pre></div><ul><li><code>tsconfig.json</code>：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;compilerOptions&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;es2017&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;experimentalDecorators&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;emitDecoratorMetadata&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;module&#34;</span><span class=p>:</span> <span class=s2>&#34;commonjs&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rootDir&#34;</span><span class=p>:</span> <span class=s2>&#34;./src&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;outDir&#34;</span><span class=p>:</span> <span class=s2>&#34;./dist&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;esModuleInterop&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;forceConsistentCasingInFileNames&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;strict&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;skipLibCheck&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p>在 <a href=https://typegoose.github.io/typegoose/docs/guides/quick-start-guide#how-to-start-using-typegoose>How to Start using typegoose</a> 有說明，以下兩個設定一定要開啟：</p><ul><li><code>experimentalDecorators: true</code></li><li><code>emitDecoratorMetadata: true</code></li></ul></blockquote><h3 id=簡單的-express-server>簡單的 Express Server<a hidden class=anchor aria-hidden=true href=#簡單的-express-server>#</a></h3><ul><li>建立 <code>./.env</code> 檔案：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=nv>PORT</span><span class=o>=</span><span class=m>3000</span>
</span></span></code></pre></div><ul><li><code>./src/app.ts</code>：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>dotenv</span> <span class=kr>from</span> <span class=s1>&#39;dotenv&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>express</span><span class=p>,</span> <span class=p>{</span> <span class=nx>Request</span><span class=p>,</span> <span class=nx>Response</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;express&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>dotenv</span><span class=p>.</span><span class=nx>config</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>env</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>port</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span>: <span class=kt>Request</span><span class=p>,</span> <span class=nx>res</span>: <span class=kt>Response</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;JWT + Express + TypeScript Server&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>port</span><span class=p>,</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=sb>`[server]: Server is running at http://localhost:</span><span class=si>${</span><span class=nx>port</span><span class=si>}</span><span class=sb> in </span><span class=si>${</span><span class=nx>env</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>;</span>
</span></span></code></pre></div><ul><li>在 <code>./package.json</code> 裡寫一個啟動腳本：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;scripts&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dev&#34;</span><span class=p>:</span> <span class=s2>&#34;NODE_ENV=development ts-node-dev --respawn src/app.ts&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>啟動伺服器：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pnpm dev
</span></span></code></pre></div><p>並訪問 <code>http://localhost:3000</code> 就可以看到成功畫面。</p><h2 id=使用-docker-compose-設定資料庫>使用 Docker Compose 設定資料庫<a hidden class=anchor aria-hidden=true href=#使用-docker-compose-設定資料庫>#</a></h2><ul><li>在專案目錄下新增一個檔案 <code>./docker-compose.yaml</code>：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mongo</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mongo:4.4.19-focal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>mongo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>MONGO_INITDB_ROOT_USERNAME</span><span class=p>:</span><span class=w> </span><span class=l>${MONGODB_USERNAME}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>MONGO_INITDB_ROOT_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>${MONGODB_PASSWORD}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>MONGO_INITDB_DATABASE</span><span class=p>:</span><span class=w> </span><span class=l>${MONGODB_DATABASE}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env_file</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./.env</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;6017:27017&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>mongo:/data/db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./init-mongo.sh:/docker-entrypoint-initdb.d/init-mongo.sh:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>redis:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;6379:6379&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>redis:/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mongo</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></div><p><code>docker-compose.yaml</code> 檔案會使用專案下 <code>.env</code> 裡的設定，所以要新增所需要的相關設定：</p><ul><li><code>.env</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>PORT=</span><span class=mi>3000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>MONGODB_USERNAME=jwtweb</span>
</span></span><span class=line><span class=cl><span class=err>MONGODB_PASSWORD=pwd</span><span class=mi>123</span>
</span></span><span class=line><span class=cl><span class=err>MONGODB_DATABASE=jwtAuth</span>
</span></span></code></pre></div><p>當 MongoDB 建立後，它並不會自動建立 database。這就是 <code>./init-mongo.sh:/docker-entrypoint-initdb.d/init-mongo.sh:ro</code> 的功用，寫一個初始化資料庫的檔案並掛載到容器裡。</p><p>在專案目錄下新增一個檔案 <code>./init-mongo.sh</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mongo <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>db = db.getSiblingDB(&#39;jwtAuth&#39;)
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>db.createUser({
</span></span></span><span class=line><span class=cl><span class=s>  user: &#39;${MONGODB_USERNAME}&#39;,
</span></span></span><span class=line><span class=cl><span class=s>  pwd: &#39;${MONGODB_PASSWORD}&#39;,
</span></span></span><span class=line><span class=cl><span class=s>  roles: [
</span></span></span><span class=line><span class=cl><span class=s>  {
</span></span></span><span class=line><span class=cl><span class=s>    role: &#39;readWrite&#39;,
</span></span></span><span class=line><span class=cl><span class=s>    db: &#39;${MONGODB_DATABASE}&#39;,
</span></span></span><span class=line><span class=cl><span class=s>  },
</span></span></span><span class=line><span class=cl><span class=s>  ],
</span></span></span><span class=line><span class=cl><span class=s>});
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><p>完成後使用下面指令來運行：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker compose up -d
</span></span></code></pre></div><p>如果要停止的話可以使用：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker compose down
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl>docker compose down -v <span class=c1># 停止並刪除 volume</span>
</span></span></code></pre></div><h2 id=連接到-mongodb>連接到 MongoDB<a hidden class=anchor aria-hidden=true href=#連接到-mongodb>#</a></h2><ul><li><code>./src/database/connectMongo</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>mongoose</span> <span class=kr>from</span> <span class=s1>&#39;mongoose&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>db_user</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>MONGODB_USERNAME</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>db_pwd</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>MONGODB_PASSWORD</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>db_name</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>MONGODB_DATABASE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>mongoose</span><span class=p>.</span><span class=kr>set</span><span class=p>(</span><span class=s1>&#39;strictQuery&#39;</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>url</span> <span class=o>=</span> <span class=sb>`mongodb://</span><span class=si>${</span><span class=nx>db_user</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>db_pwd</span><span class=si>}</span><span class=sb>@localhost:6017/</span><span class=si>${</span><span class=nx>db_name</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>connectDB</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=nx>mongoose</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Database connected...&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span>: <span class=kt>any</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>connectDB</span><span class=p>,</span> <span class=mi>5000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>connectDB</span><span class=p>;</span>
</span></span></code></pre></div><ul><li>讓 <code>app.ts</code> 連接：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>connectDB</span> <span class=kr>from</span> <span class=s1>&#39;./database/connectMongo&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>port</span><span class=p>,</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=sb>`[server]: Server is running at http://localhost:</span><span class=si>${</span><span class=nx>port</span><span class=si>}</span><span class=sb> in </span><span class=si>${</span><span class=nx>env</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>connectDB</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h2 id=連接到-redis>連接到 Redis<a hidden class=anchor aria-hidden=true href=#連接到-redis>#</a></h2><ul><li><code>./src/database/connectRedis</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createClient</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;redis&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>redisUrl</span> <span class=o>=</span> <span class=s1>&#39;redis://localhost:6379&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>redisClient</span> <span class=o>=</span> <span class=nx>createClient</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>url</span>: <span class=kt>redisUrl</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>connectRedis</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Redis client connect...&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span>: <span class=kt>any</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>connectRedis</span><span class=p>,</span> <span class=mi>5000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>connectRedis</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>redisClient</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>err</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>redisClient</span><span class=p>;</span>
</span></span></code></pre></div><p>因為 Redis 只會儲存 session 狀態，所以目前還不需要套用在任何地方。</p><blockquote><p>可以到我的 <a href=https://github.com/et860525/jwt-auth-node>et860525/jwt-auth-node</a> 來查看程式碼</p></blockquote><h2 id=結語>結語<a hidden class=anchor aria-hidden=true href=#結語>#</a></h2><p>自從上一次發文後馬上就確診了，所以新的專案就停了一陣子。這次的專案是結合以前所學過的東西，來實作一個簡單的 JWT (JSON Web Tokens) RESTful API。</p><p>下一個章節會從建立資料庫的 model 開始。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://et860525.github.io/tags/node.js/>Node.js</a></li><li><a href=https://et860525.github.io/tags/typescript/>TypeScript</a></li><li><a href=https://et860525.github.io/tags/express/>Express</a></li><li><a href=https://et860525.github.io/tags/mongodb/>MongoDB</a></li><li><a href=https://et860525.github.io/tags/projects/>Projects</a></li><li><a href=https://et860525.github.io/tags/api/>API</a></li></ul><nav class=paginav><a class=prev href=https://et860525.github.io/posts/jwt-authentication-models-jwt/><span class=title>« Prev</span><br><span>Node.js + JWT Authentication 專案(二) - 資料庫 Models 與 JWT</span></a>
<a class=next href=https://et860525.github.io/posts/oauth-grant/><span class=title>Next »</span><br><span>OAuth Grant</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Node.js + JWT Authentication 專案(一) - 初始化專案 on twitter" href="https://twitter.com/intent/tweet/?text=Node.js%20%2b%20JWT%20Authentication%20%e5%b0%88%e6%a1%88%28%e4%b8%80%29%20-%20%e5%88%9d%e5%a7%8b%e5%8c%96%e5%b0%88%e6%a1%88&amp;url=https%3a%2f%2fet860525.github.io%2fposts%2fjwt-authentication-init%2f&amp;hashtags=Node.js%2cTypeScript%2cExpress%2cMongoDB%2cProjects%2cAPI"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Node.js + JWT Authentication 專案(一) - 初始化專案 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fet860525.github.io%2fposts%2fjwt-authentication-init%2f&amp;title=Node.js%20%2b%20JWT%20Authentication%20%e5%b0%88%e6%a1%88%28%e4%b8%80%29%20-%20%e5%88%9d%e5%a7%8b%e5%8c%96%e5%b0%88%e6%a1%88&amp;summary=Node.js%20%2b%20JWT%20Authentication%20%e5%b0%88%e6%a1%88%28%e4%b8%80%29%20-%20%e5%88%9d%e5%a7%8b%e5%8c%96%e5%b0%88%e6%a1%88&amp;source=https%3a%2f%2fet860525.github.io%2fposts%2fjwt-authentication-init%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Node.js + JWT Authentication 專案(一) - 初始化專案 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fet860525.github.io%2fposts%2fjwt-authentication-init%2f&title=Node.js%20%2b%20JWT%20Authentication%20%e5%b0%88%e6%a1%88%28%e4%b8%80%29%20-%20%e5%88%9d%e5%a7%8b%e5%8c%96%e5%b0%88%e6%a1%88"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Node.js + JWT Authentication 專案(一) - 初始化專案 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fet860525.github.io%2fposts%2fjwt-authentication-init%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Node.js + JWT Authentication 專案(一) - 初始化專案 on whatsapp" href="https://api.whatsapp.com/send?text=Node.js%20%2b%20JWT%20Authentication%20%e5%b0%88%e6%a1%88%28%e4%b8%80%29%20-%20%e5%88%9d%e5%a7%8b%e5%8c%96%e5%b0%88%e6%a1%88%20-%20https%3a%2f%2fet860525.github.io%2fposts%2fjwt-authentication-init%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Node.js + JWT Authentication 專案(一) - 初始化專案 on telegram" href="https://telegram.me/share/url?text=Node.js%20%2b%20JWT%20Authentication%20%e5%b0%88%e6%a1%88%28%e4%b8%80%29%20-%20%e5%88%9d%e5%a7%8b%e5%8c%96%e5%b0%88%e6%a1%88&amp;url=https%3a%2f%2fet860525.github.io%2fposts%2fjwt-authentication-init%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://et860525.github.io/>Mango Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>