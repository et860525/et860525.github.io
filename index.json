[{"content":"ä½¿ç”¨ Docker ä¾†å»ºç½® MongoDBï¼Œå¯ä»¥å…ˆåˆ° docker mongo ä¾†é¸æ“‡ç‰ˆæœ¬ã€‚\nMongoDB æœƒæœ‰å¹¾ç¨®æ¶æ§‹ï¼š\nStandalone å»ºç«‹é›£åº¦ ä½ å–®ä¸€ MongoDB è³‡æ–™åº« Replica Set å»ºç«‹é›£åº¦ ä¸­ è³‡æ–™æœƒæœ‰å¤šå€‹å‰¯æœ¬æä¾›å®¹éŒ¯ç©ºé–“ Sharded Cluster å»ºç«‹é›£åº¦ é«˜ è³‡æ–™æ”¾ç½®åœ¨ä¸åŒçš„ shardï¼Œæ¯å€‹ shard æˆ– config servers éƒ½æ˜¯ Replica Set Standalone Standalone è¡¨ç¤ºåªæœ‰ä¸€å€‹ MongoDB å¯¦é«”ï¼ŒMongo Client åªè¦ç›´æ¥é€£æ¥å®ƒå°±å¯ä»¥ä½¿ç”¨ã€‚\næ ¹æ“š Docker compose file æ‰€é¡¯ç¤ºï¼Œ2023å¹´å…­æœˆå¾Œå°±ä¸æœƒæ”¯æ´ Compose V1 ï¼Œæ‰€ä»¥é™¤äº†åœ¨ Standalone æœƒè©¦åšä¸€å€‹ V1ï¼Œå…¶ä»–éƒ½æœƒæ›æˆ Compose V2 çš„æ ¼å¼\nDocker compose V1 ä½¿ç”¨ docker-compose ä¾†å»ºç«‹ MongoDBï¼š\n# docker-compose.yml versio: \u0026#39;3.1\u0026#39; services: mongo: image: mongo:latest container_name: mongodb environment: MONGO_INITDB_ROOT_USERNAME: root MONGO_INITDB_ROOT_PASSWORD: example ports: - \u0026#39;27017:27017\u0026#39; volumes: - mongo-mount-data:/data/db é‹è¡Œ docker-composeï¼š\n# Start docker-compose up -d # Close docker-compose down Docker compose V2 # docker-compose.yaml services: mongo: image: mongo:latest container_name: mongodb-test environment: MONGO_INITDB_ROOT_USERNAME: root MONGO_INITDB_ROOT_PASSWORD: example ports: - \u0026#39;27017:27017\u0026#39; volumes: - mongo-mount-data:/data/db é‹è¡Œ docker composeï¼š\n# Start docker compose up -d # Close docker compose down é€²å…¥ mongoDB docker exec -it \u0026lt;mongo-name\u0026gt; bash è¼¸å…¥å¾Œæœƒçœ‹åˆ°å‘½ä»¤åˆ—æœƒç”± root é–‹é ­ï¼Œæ¥è‘—å†è¼¸å…¥ï¼š\n# 5.0+ mongosh -u root -p # 4.0 mongo -u root -p è¼¸å…¥å¯†ç¢¼å¾Œï¼Œå°±å¯ä»¥é€²å…¥ MongoDB äº†ã€‚\nä½¿ç”¨ VM æœƒé‡åˆ°çš„å•é¡Œ å¦‚æœåœ¨ VM ä¸‹ä½¿ç”¨ MongoDB 5.0+ ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œæœ‰å¯èƒ½æœƒçœ‹åˆ°ï¼š\nWARNING: MongoDB 5.0+ requires a CPU with AVX support, and your current system does not appear to have that! æ ¹æ“š Mongo DB deployment not working in kubernetes because processor doesn\u0026rsquo;t have AVX support\nå¦‚æœæ˜¯ Windows + VirtualBox å¯ä»¥åœ¨ CMD è¼¸å…¥ï¼š\nbcdedit /set hypervisorlaunchtype off DISM /Online /Disable-Feature:Microsoft-Hyper-V é‡é–‹æ©Ÿå¾Œå°±å¯ä»¥è§£æ±ºã€‚\nç›®å‰æˆ‘é€™è£¡é‚„æ˜¯æœ‰ä½¿ç”¨ WSL2ï¼Œå¦‚æœè¼¸å…¥ä»¥ä¸ŠæŒ‡ä»¤å¯èƒ½æœƒé€ æˆ WSL2 ç„¡æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘é¸æ“‡ä½¿ç”¨èˆŠç‰ˆæœ¬ï¼Œæš«ä¸”ä¸ä½¿ç”¨ mongo:5.0+ã€‚\nReplica Set MongoDB Replication å¯ä»¥å»ºç«‹ä¸€ä»½è³‡æ–™åº«å‰¯æœ¬ï¼Œåœ¨ä¸»è¦çš„è³‡æ–™åº«ç™¼ç”Ÿå•é¡Œæ™‚ï¼Œå‰¯æœ¬å¯ä»¥ç›´æ¥æ¥æ‰‹ä¸»è¦è³‡æ–™åº«çš„å·¥ä½œã€‚\nä½¿ç”¨ Replica Set çš„é‡é»ï¼š\nReplica Set æœƒæä¾› High availability ä¾ç…§ç¡¬é«”è¦æ ¼ä¾†èª¿æ•´ Replica Setï¼Œä¾‹å¦‚ï¼šæ›´å¤§æ›´å¿«çš„ç¡¬ç¢Ÿ ä¸æœƒå½±éŸ¿ Primaryï¼Œä½¿ç”¨ Read Preference ä¾†è®€å–æ›´å¿«æ›´è¿‘çš„å‰¯æœ¬ MongoDB Replication çš„æ¶æ§‹ MongoDB Replication ä¸»è¦çš„æ¶æ§‹çš„æ§‹æˆï¼š\nReplica Set Member æœ‰å…©ç¨®ï¼š\nPrimaryï¼šæ¥å—æ‰€æœ‰è®€å¯«çš„æ“ä½œ Secondariesï¼šè¤‡è£½ Primary çš„è³‡æ–™ æœ€åŸºæœ¬çš„ Replica Set éœ€è¦æœ‰ä¸‰å€‹æ•¸æ“šæ‰¿è¼‰æˆå“¡ ( data-bearing members )ï¼šä¸€å€‹ Primary èˆ‡äºŒå€‹ Secondaryï¼š\nåœ¨æŸäº›æƒ…æ³ä¸‹ ( ä¾‹å¦‚ï¼šç¡¬é«”é™åˆ¶ ) å¯ä»¥å°‡æŸå€‹ member æ”¹ç‚º arbiterï¼Œå®ƒåªæœƒåƒèˆ‡ æŠ•ç¥¨ ( elections ) ä¸¦ä¸æœƒæ“æœ‰ä»»ä½•è³‡æ–™ï¼Œæ›´ä¸æœƒæˆç‚º Primaryï¼š\nä»¥ä¸‹ä½¿ç”¨ Docker compose ä¾†å»ºæ§‹ Replica Setã€‚\nDocker compose ä½¿ç”¨ Docker compose ä¾†å»ºç«‹ä¸‹æ–¹çš„æ¶æ§‹ï¼š\né€™ä¸€å€‹ Replica Set å‘½åç‚º RSï¼Œéœ€è¦ä½¿ç”¨ --replSet RS å»ºç«‹ä¸‰å€‹ container ä¾†æ»¿è¶³æœ€åŸºæœ¬çš„ Replica Setï¼š container (rs1/rs2/rs3) ï¼›port (Â 27041/27042/27043) docker-compose-replica-set.yamlï¼š\nservices: rs1: image: mongo:4.4.19-focal container_name: rs1 network_mode: host command: mongod --replSet RS --port 27041 --dbpath /data/db --config /resource/mongod.yaml volumes: - ./replica/config/mongod.yaml:/resource/mongod.yaml - ./replica/data/rs1:/data/db extra_hosts: - \u0026#34;rs1.local:127.0.0.1\u0026#34; - \u0026#34;rs2.local:127.0.0.1\u0026#34; - \u0026#34;rs3.local:127.0.0.1\u0026#34; rs2: image: mongo:4.4.19-focal container_name: rs2 network_mode: host command: mongod --replSet RS --port 27042 --dbpath /data/db --config /resource/mongod.yaml volumes: - ./replica/config/mongod.yaml:/resource/mongod.yaml - ./replica/data/rs2:/data/db extra_hosts: - \u0026#34;rs1.local:127.0.0.1\u0026#34; - \u0026#34;rs2.local:127.0.0.1\u0026#34; - \u0026#34;rs3.local:127.0.0.1\u0026#34; rs3: image: mongo:4.4.19-focal container_name: rs3 network_mode: host command: mongod --replSet RS --port 27043 --dbpath /data/db --config /resource/mongod.yaml volumes: - ./replica/config/mongod.yaml:/resource/mongod.yaml - ./replica/data/rs3:/data/db extra_hosts: - \u0026#34;rs1.local:127.0.0.1\u0026#34; - \u0026#34;rs2.local:127.0.0.1\u0026#34; - \u0026#34;rs3.local:127.0.0.1\u0026#34; network_mode è¨­å®šç‚º hostï¼Œè³‡æ–™åº«æœƒå¦‚åŒæ¶è¨­åœ¨æœ¬æ©Ÿä¸€æ¨£ï¼Œè®“ rs1.localã€rs2.local èˆ‡ rs3.local éƒ½æœƒå°æ‡‰åˆ° 127.0.0.1 command è£¡é¢çš„è¨­å®šï¼š --dbpathï¼šæŒ‡å®š MongoDB å­˜æ”¾è³‡æ–™çš„è³‡æ–™å¤¾ --portï¼šæŒ‡å®š MongoDB è¦é–‹å•Ÿçš„ Port --configï¼šæŒ‡å®š MongoDB Config file volumes è£¡é¢çš„è¨­å®šï¼š ./replica/config/mongod.yaml:/resource/mongod.yamlï¼šå…¶æ ¼å¼ç‚º A:Bï¼ŒA ç‚ºä¸»æ©Ÿç«¯çš„è·¯å¾‘ï¼›B ç‚ºå®¹å™¨å…§çš„è·¯å¾‘ã€‚ç•¶å®¹å™¨æ›è¼‰å®Œæˆï¼Œå®¹å™¨ç«¯å°±æœƒæœ‰ /resource/mongod.yaml æª”æ¡ˆï¼Œé”åˆ°è·¯å¾‘èƒ½å…±äº«è³‡æ–™çš„åŠŸèƒ½ ./replica/data/rs3:/data/dbï¼šèˆ‡ä¸Šæ–¹è¨­å®šå¾ˆåƒï¼Œè³‡æ–™å…±äº«èˆ‡ç¶å®šã€‚ç•¶ç›®å‰çš„å®¹å™¨è¢«åˆªé™¤å¾Œï¼Œå…¶è³‡æ–™éƒ½æœƒè¢«å­˜æ”¾åœ¨æœ¬æ©Ÿç«¯ï¼Œç­‰å¾…ä¸‹ä¸€å€‹å®¹å™¨æŒ‡å‘ç›¸åŒçš„ä½ç½®ï¼Œå°±å¯ä»¥ç¹¼çºŒä½¿ç”¨ä»¥å‰çš„è³‡æ–™ extra_hosts è¨­å®šè§£æçš„åŸŸå rs1.localã€rs2.local èˆ‡ rs3.local éƒ½æœƒè§£æ 127.0.0.1ï¼Œé€™æ¨£å°±ä¸ç”¨å†æ‰“ 127.0.0.1 æ¥ä¸‹ä¾†è¨­å®š MongoDB config file replica/config/mongod.yamlï¼š\nnet: bindIpAll: true storage: engine: wiredTiger wiredTiger: engineConfig: cacheSizeGB: 0.1 net Option è£¡çš„ bindIpAllï¼šè¨­å®šé‚£äº› Client IP å¯ä»¥é€£é€² MongoDBï¼Œé è¨­ç‚º localhost ä¹Ÿå°±æ˜¯åªæœ‰æœ¬æ©Ÿã€‚å‡è¨­ Client IP ä¾†è‡ªä¸åŒçš„ä¸»æ©Ÿï¼Œè¨­å®š true å°±è¡¨ç¤ºä»»ä½• Client IP éƒ½å¯ä»¥é€£é€²ä¾† storage Option è£¡çš„ engineï¼šæœ‰ wiredTigerÂ èˆ‡ inMemory å…©ç¨®ï¼Œä¸è«–é¸æ“‡å“ªä¸€å€‹éƒ½è¦å°å¿ƒè¨­å®š cacheSizeGB æˆ– inMemorySizeGB çš„å¤§å°ã€‚é€™æ˜¯å› ç‚º Mongo æœƒä¾ç…§ç¡¬é«”é…ç½®ä¾†è¨ˆç®—å…§éƒ¨ç·©å­˜çš„é è¨­å€¼ï¼Œè€Œ Mongo ä¸¦ä¸æœƒçŸ¥é“è‡ªå·±é‹è¡Œåœ¨ Docker å®¹å™¨ä¸­ï¼Œæ‰€ä»¥åœ¨åŒä¸€å€‹ Docker ä¸Šæ¶è¨­å…©å°ä»¥ä¸Šçš„ Mongoï¼Œå°±æœ‰å¯èƒ½æœƒå‡ºç¾å•é¡Œï¼Œå¦‚ï¼šæ–·ç·šæˆ–ç„¡æ³•é€£ç·šé€²å»ã€‚æ‰€ä»¥ä½¿ç”¨ Docker æ¶è¨­ Mongo ä¸€å®šè¦è¨­å®š ä»¥ä¸Šåªç”¨ä½¿ç”¨å¹¾å€‹é‡è¦çš„è¨­å®šï¼Œå®Œæ•´çš„ Mongo config å¯ä»¥åˆ° Configuration File Optionsã€‚\néƒ½å®Œæˆå¾Œï¼Œä½¿ç”¨ docker compose up -d ä¾†é‹è¡Œã€‚\nReplica Set è¨­å®š ç¢ºèªè³‡æ–™åº«é€£ç·šç‹€æ³ é€²å…¥ rs1 å®¹å™¨ï¼Œä¾†æ¸¬è©¦èƒ½å¦ç”¨åŸŸåé€£ç·šåˆ°å…¶ä»–è³‡æ–™åº«ï¼š\ndocker exec -it rs1 bash ç¢ºèªè³‡æ–™åº«é€£ç·šï¼š\nmongo rs1.local:27041 --eval \u0026#34;print(\u0026#39;rs1 ok\u0026#39;)\u0026#34; mongo rs2.local:27042 --eval \u0026#34;print(\u0026#39;rs2 ok\u0026#39;)\u0026#34; mongo rs3.local:27043 --eval \u0026#34;print(\u0026#39;rs3 ok\u0026#39;)\u0026#34; å¦‚æœéƒ½èƒ½é¡¯ç¤ºé€™äº›å­—ä¸²ï¼Œå°±å¯ä»¥é–‹å§‹è¨­å®š Replica Setã€‚\nè¨­å®š Replica Set éš¨ä¾¿é€²å…¥ä¸€å€‹ memberï¼š\nmongo rs1.local:27041 è¨­å®š Replica Set configï¼š\ncfg = { \u0026#34;_id\u0026#34;: \u0026#34;RS\u0026#34;, \u0026#34;members\u0026#34;: [{ \u0026#34;_id\u0026#34;: 0, \u0026#34;host\u0026#34;: \u0026#34;rs1.local:27041\u0026#34; }, { \u0026#34;_id\u0026#34;: 1, \u0026#34;host\u0026#34;: \u0026#34;rs2.local:27042\u0026#34; }, { \u0026#34;_id\u0026#34;: 2, \u0026#34;host\u0026#34;: \u0026#34;rs3.local:27043\u0026#34; } ] }; rs.initiate(cfg); é¡¯ç¤º ok: 1 å°±è¡¨ç¤ºå®Œæˆã€‚\nç¢ºèª Replica Set ç‹€æ…‹ ç•¶è¦å¢åŠ æˆ–æ¸›å°‘ member æ™‚ï¼Œæˆ–æ˜¯è¦æª¢æŸ¥ member æ˜¯å¦æœ‰é€£ç·šï¼Œå°±è¦ç¢ºèª member çš„ç‹€æ…‹ã€‚æœ€å¸¸ç”¨çš„æœ‰ä¸‰ç¨®ï¼š\nrs.status()ï¼šmembers çš„ç‹€æ…‹ rs.status().members.forEach(m =\u0026gt; print(`${m.name} =\u0026gt; ${m.stateStr}`)) æœƒåˆ—å‡ºï¼š rs1.local:27041 =\u0026gt; PRIMARY rs2.local:27042 =\u0026gt; SECONDARY rs3.local:27043 =\u0026gt; SECONDARY ç•¶ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ rs.status() ä¾†çœ‹æ›´è©³ç´°çš„ç‹€æ…‹ã€‚ rs.printSecondaryReplicationInfo()ï¼šmembers çš„åŒæ­¥ç‹€æ…‹ source: rs2.local:27042 syncedTo: Fri Mar 03 2023 11:50:04 GMT+0000 (UTC) 0 secs (0 hrs) behind the primary source: rs3.local:27043 syncedTo: Fri Mar 03 2023 11:50:04 GMT+0000 (UTC) 0 secs (0 hrs) behind the primary rs.printReplicationInfo()ï¼šmembers çš„ oplog ç‹€æ…‹ configured oplog size: 6040.000781059265MB log length start to end: 18735secs (5.2hrs) oplog first event time: Fri Mar 03 2023 06:33:09 GMT+0000 (UTC) oplog last event time: Fri Mar 03 2023 11:45:24 GMT+0000 (UTC) now: Fri Mar 03 2023 11:45:31 GMT+0000 (UTC) çµèª èµ·åˆæœƒæ¥è§¸åˆ° Replica Set çš„åŸå› ï¼Œæ˜¯å‡ºè‡ªæ–¼æˆ‘æƒ³ä½¿ç”¨ Prisma é€£æ¥ local MongoDBã€‚ä¸éç•¶é€£æ¥æ™‚å°±æœƒè·³å‡ºéŒ¯èª¤ï¼š\nprisma needs to perform transactions, which requires your mongodb server to be run as a replica set. é€™ä¹Ÿè®“æˆ‘æƒ³äº†è§£ä¸€ä¸‹é€™å€‹ Replica Set åˆ°åº•æ˜¯ä»€éº¼æ±è¥¿ã€‚\nè€Œçœ‹äº†è©²æ–‡ç« æ‰çŸ¥é“ï¼Œåœ¨ Docker è£¡å»ºç«‹ MongoDB æ™‚éœ€è¦è¨­å®š cacheSizeGB ä¾†è¨­å®šç·©å­˜å¤§å°ã€‚å¯èƒ½æ˜¯é€šå¸¸æˆ‘ä¹Ÿåªæœƒä½¿ç”¨åˆ°ä¸€å€‹çš„ MongoDB è³‡æ–™åº«ï¼Œæ‰€ä»¥æ‰æ²’æœ‰é‡åˆ°é‚£äº›å•é¡Œã€‚\nReference [è³‡æ–™åº«]ä½¿ç”¨ Docker æ§‹ç¯‰ä¸åŒ MongoDB æ¶æ§‹ (ä¸‰) - Replica Set ","permalink":"https://et860525.github.io/posts/docker-mongodb/","summary":"\u003cp\u003eä½¿ç”¨ Docker ä¾†å»ºç½® MongoDBï¼Œå¯ä»¥å…ˆåˆ° \u003ca href=\"https://hub.docker.com/_/mongo\"\u003edocker mongo\u003c/a\u003e ä¾†é¸æ“‡ç‰ˆæœ¬ã€‚\u003c/p\u003e\n\u003cp\u003eMongoDB æœƒæœ‰å¹¾ç¨®æ¶æ§‹ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eStandalone\n\u003cul\u003e\n\u003cli\u003eå»ºç«‹é›£åº¦ \u003cstrong\u003eä½\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eå–®ä¸€ MongoDB è³‡æ–™åº«\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.mongodb.com/docs/manual/replication/\"\u003eReplica Set\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003eå»ºç«‹é›£åº¦ \u003cstrong\u003eä¸­\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eè³‡æ–™æœƒæœ‰å¤šå€‹å‰¯æœ¬æä¾›å®¹éŒ¯ç©ºé–“\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.mongodb.com/docs/manual/sharding/\"\u003eSharded Cluster\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003eå»ºç«‹é›£åº¦ \u003cstrong\u003eé«˜\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eè³‡æ–™æ”¾ç½®åœ¨ä¸åŒçš„ shardï¼Œæ¯å€‹ shard æˆ– config servers éƒ½æ˜¯ \u003ccode\u003eReplica Set\u003c/code\u003e\n\u003cimg loading=\"lazy\" src=\"/images/Docker-mongodb/Docker-sharded-cluster-production-architecture.png\" alt=\"Docker-sharded-cluster-production-architecture.png\"  /\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e","title":"Docker: è¨­å®š MongoDB"},{"content":"Pnpm ( Performant Node Package Manager ) æ˜¯ä¸€å€‹å¥—ä»¶ç®¡ç†å™¨ã€‚æ ¹æ“šå®˜ç¶²è¡¨ç¤ºï¼Œå¯ä»¥ç¯€çœç£ç¢Ÿç©ºé–“ä¸¦æå‡å®‰è£é€Ÿåº¦ã€‚\nFast, disk space efficient package manager\npnpm çš„ç‰¹é» ä¸åŒçš„å°ˆæ¡ˆå…±ç”¨ä¾è³´å¥—ä»¶ï¼Œç¯€çœç£ç¢Ÿç©ºé–“ æ‰€æœ‰ä¾è³´å¥—ä»¶çš„æª”æ¡ˆéƒ½æœƒè¢«å­˜åœ¨åŒä¸€å€‹ä½ç½®ä¸­ï¼Œç•¶æœ‰å°ˆæ¡ˆéœ€è¦ä¾è³´å¥—ä»¶æ™‚ï¼Œå®ƒçš„æª”æ¡ˆæœƒè¢«ç¡¬é€£çµåˆ°è©²ä½ç½®ï¼Œé€™æ¨£å°±ä¸æœƒæ¶ˆè€—é¡å¤–çš„ç£ç¢Ÿç©ºé–“\néæ‰å¹³åŒ–çš„ node_modules ç›®éŒ„ npm èˆ‡ yarn éƒ½æ˜¯ä»¥æ‰å¹³åŒ–çš„æ–¹å¼å»ºç«‹ node_modules ç›®éŒ„ï¼Œä»–å€‘æœƒç”¢ç”Ÿéæ³•è¨ªå•ä¾è³´çš„å•é¡Œã€‚èˆ‰å€‹ä¾‹å­ï¼Œä»Šå¤©æœ‰ Aã€B å’Œ C ä¸‰ç¨®å¥—ä»¶ï¼Œè€Œä»–å€‘ä¹‹ä¸­çš„é—œä¿‚æ˜¯ A ä¾è³´ C çš„ APIï¼Œå¦‚æœ B ç‰ˆæœ¬æ›´æ–°ä¸¦ä¾è³´ C çš„ 2.0.1 ç‰ˆæœ¬ï¼Œä½† A ä¾ç„¶é‚„æ˜¯ä½¿ç”¨èˆŠç‰ˆçš„ Cï¼Œé‚£å°±æœƒå ±éŒ¯ã€‚\nè€Œ pnpm æ˜¯ä½¿ç”¨è»Ÿé€£çµçš„æ–¹å¼ä¾†å»ºæ§‹ node_modules ç›®éŒ„ï¼š\nç•¶é–‹ç™¼è€…å®‰è£å¥—ä»¶ bar@1.0.0ï¼Œè€Œ bar@1.0.0 åˆä¾è³´ foo@1.0.0å¥—ä»¶ï¼Œæ­¤æ™‚ pnpm å°±æœƒå°‡å°ˆæ¡ˆç›´æ¥ä¾è³´çš„å¥—ä»¶ç¡¬é€£çµæ–¼ .pnpm storeã€‚è€Œ bar@1.0.0 çš„ foo@1.0.0 å°±æœƒä½¿ç”¨è»Ÿé€£çµç›´æ¥ä¾è³´çš„ foo@1.0.0ã€‚\né€™æ¨£å°±å¯ä»¥é¿å…éæ³•è¨ªå•ä¾è³´çš„å•é¡Œäº†ã€‚\næ›´å¤šèˆ‡ npm/yarn çš„æ¯”è¼ƒ Feature Comparison\nå®‰è£æ–¹å¼ æˆ‘ä½¿ç”¨çš„æ˜¯ Linux ç³»çµ±ï¼Œæ ¹æ“šå®˜ç¶²çš„æ–‡ä»¶ä¸‹è¼‰ï¼š\n# bash wget -qO- https://get.pnpm.io/install.sh | ENV=\u0026#34;$HOME/.bashrc\u0026#34; SHELL=\u0026#34;$(which bash)\u0026#34; bash - å…¶ä»–ä¸‹è¼‰æ–¹å¼ï¼špnpm Installation\nCommands npm command pnpm equivalent npm init pnpm init npm install pnpm install npm i \u0026lt;pkg\u0026gt; pnpm add \u0026lt;pkg\u0026gt; npm run \u0026lt;cmd\u0026gt; pnpm \u0026lt;cmd\u0026gt; pnpm updateï¼šå¦‚æœæ²’æœ‰åŠ ä¸Š --filter ä¾†æŒ‡å®š packageï¼Œé‚£å°±æ˜¯æ›´æ–°å…¨éƒ¨ pnpm removeï¼šä¹Ÿå¯ä»¥ä½¿ç”¨ rm, uninstall, un æ›´å¤šçš„æŒ‡ä»¤å¯ä»¥åƒè€ƒå®˜ç¶²çš„ CLI commandsã€‚\nçµè«– æœ€è¿‘é–‹å§‹è½‰æˆä½¿ç”¨ pnpmï¼Œæœ‰æ„Ÿçš„å°±æ˜¯é€Ÿåº¦å¾ˆå¿«ã€‚æœƒä½¿ç”¨å®ƒæœ€å¤§çš„åŸå› å°±æ˜¯å®ƒèƒ½å°‡ä¾è³´ä»¶éƒ½æ”¾åœ¨åŒä¸€è³‡æ–™å¤¾ç®¡ç† (å°ˆæ¡ˆè£¡çš„.pnpm)ï¼Œé€™æ¨£å°±ä¸æœƒå› ç‚ºä¸åŒçš„ä¾è³´ä»¶ç‰ˆæœ¬ï¼Œé€ æˆå…¶ä»–ä¾è³´ä»¶éŒ¯èª¤çš„å•é¡Œã€‚\nSource pnpm, Fast, disk space efficient package manager ä¸ºä»€ä¹ˆç°åœ¨æˆ‘æ›´æ¨è pnpm è€Œä¸æ˜¯ npm/yarn? ","permalink":"https://et860525.github.io/posts/pnpm/","summary":"\u003cp\u003e\u003ca href=\"https://pnpm.io/\"\u003ePnpm\u003c/a\u003e ( Performant Node Package Manager ) æ˜¯ä¸€å€‹å¥—ä»¶ç®¡ç†å™¨ã€‚æ ¹æ“šå®˜ç¶²è¡¨ç¤ºï¼Œå¯ä»¥ç¯€çœç£ç¢Ÿç©ºé–“ä¸¦æå‡å®‰è£é€Ÿåº¦ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eFast, disk space efficient package manager\u003c/p\u003e\n\u003c/blockquote\u003e","title":"Pnpm ( Performant Node Package Manager )"},{"content":"ç”Ÿå‘½é€±æœŸ ( lifetimes ) æœƒç¢ºä¿æˆ‘å€‘åœ¨éœ€è¦å¼•ç”¨çš„æ™‚å€™ï¼Œå®ƒå€‘éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚\nåœ¨ Rust ä¸­ï¼Œæ¯å€‹å¼•ç”¨éƒ½æ˜¯æœ‰ç”Ÿå‘½é€±æœŸçš„ï¼Œç°¡å–®ä¾†èªªå°±æ˜¯å®ƒçš„æœ‰æ•ˆç¯„åœã€‚åœ¨å¤§å¤šæƒ…æ³ä¸‹ï¼Œç”Ÿå‘½é€±æœŸéƒ½æ˜¯éš±è—ä¸”å¯ä»¥æ¨å°å‡ºä¾†çš„ï¼Œå¦‚åŒå‹åˆ¥ä¸€æ¨£ä¹Ÿéƒ½æ˜¯å¯ä»¥æ¨å°å‡ºä¾†çš„ã€‚ç•¶å‹åˆ¥æœ‰å¾ˆå¤šç¨®å¯èƒ½çš„æƒ…æ³ä¸‹ï¼Œå°±è¦è©®é‡‹å‹åˆ¥ï¼ŒåŒæ¨£åœ¨ç”Ÿå‘½é€±æœŸä¸‹ï¼Œå¼•ç”¨ä»¥ä¸åŒæ–¹å¼é—œè¯çš„è©±ï¼Œå°±è¦è©®é‡‹ç”Ÿå‘½é€±æœŸã€‚\né€éç”Ÿå‘½é€±æœŸé é˜²è¿·é€”å¼•ç”¨ ç”Ÿå‘½é€±æœŸæœ€ä¸»è¦çš„ç›®çš„å°±æ˜¯è¦é é˜²è¿·é€”å¼•ç”¨ ( dangling references )ï¼š\nfn main() { let r; { let x = 5; r = \u0026amp;x; } println!(\u0026#34;r: {}\u0026#34;, r); } åœ¨é€™è£¡å˜—è©¦ä½¿ç”¨å·²ç¶“é›¢é–‹ä½œç”¨åŸŸçš„å¼•ç”¨ï¼Œå°±æœƒå¾—åˆ°éŒ¯èª¤è¨Šæ¯ï¼Œé€™æ˜¯å› ç‚º r æ‰€æŒ‡å‘çš„æ•¸å€¼å·²ç¶“é›¢é–‹ä½œç”¨åŸŸã€‚é€™ä¹Ÿè¡¨ç¤ºè®Šæ•¸ x å­˜åœ¨çš„ä¸å¤ ä¹…ã€‚é‚£ Rust è¦å¦‚ä½•æ±ºå®šç¨‹å¼ç¢¼ç„¡æ•ˆï¼Ÿå®ƒä½¿ç”¨äº†å€Ÿç”¨æª¢æŸ¥å™¨ ( borrow checker ) ä¾†åšæª¢æŸ¥ã€‚\nå€Ÿç”¨æª¢æŸ¥å™¨ ( Borrow checker ) Rust ç·¨è­¯å™¨æœ‰ä¸€å€‹å€Ÿç”¨æª¢æŸ¥å™¨ ( borrow checker ) æœƒæ¯”è¼ƒä½œç”¨åŸŸä¾†æª¢æ¸¬æ‰€æœ‰çš„å€Ÿç”¨æ˜¯å¦æœ‰æ•ˆã€‚\nä¾ä¸Šé¢çš„ç¨‹å¼ç¢¼ç‚ºä¾‹ï¼š\nfn main() { let r; // ---------+-- \u0026#39;a // | { // | let x = 5; // -+-- \u0026#39;b | r = \u0026amp;x; // | | } // -+ | // | println!(\u0026#34;r: {}\u0026#34;, r); // | } // ---------+ r çš„ç”Ÿå‘½é€±æœŸç‚º 'aï¼Œx ç‚º 'bï¼Œå¯ä»¥çœ‹åˆ° 'b çš„ç”Ÿå‘½é€±æœŸå€å¡Šæ¯” 'a é‚„è¦å°ã€‚è€Œ r å¼•ç”¨äº†ä¸€å€‹ç”Ÿå‘½é€±æœŸæ¯”ä»–è‡ªå·±é‚„çŸ­çš„è®Šæ•¸ xï¼Œæ‰€ä»¥ç¨‹å¼æœƒå ±éŒ¯ï¼šå¼•ç”¨çš„å°è±¡æ¯”å¼•ç”¨è€…å­˜åœ¨çš„æ™‚é–“é‚„çŸ­ã€‚\nä»¥ä¸‹ç‚ºä¿®æ­£ç‰ˆæœ¬ï¼š\nfn main() { let x = 5; // ----------+-- \u0026#39;b // | let r = \u0026amp;x; // --+-- \u0026#39;a | // | | println!(\u0026#34;r: {}\u0026#34;, r); // | | // --+ | } // ----------+ æ­¤æ™‚ x çš„ç”Ÿå‘½é€±æœŸ 'b æ¯” r çš„ç”Ÿå‘½é€±æœŸ 'a é‚„é•·ï¼ŒRust å°±èƒ½çŸ¥é“ r å¼•ç”¨ x æ˜¯æ°¸é æœ‰æ•ˆçš„ã€‚\nå‡½å¼ä¸­çš„æ³›å‹ç”Ÿå‘½é€±æœŸ å¯«ä¸€å€‹æ¯”è¼ƒå…©å€‹å­—ä¸²åˆ‡ç‰‡èª°æ¯”è¼ƒé•·çš„å‡½å¼ã€‚è©²å‡½å¼æœƒæ¥æ”¶å…©å€‹å­—ä¸²åˆ‡ç‰‡ä¸¦å›å‚³ä¸€å€‹å­—ä¸²åˆ‡ç‰‡ï¼š\nfn main() { let string1 = String::from(\u0026#34;abcd\u0026#34;); let string2 = \u0026#34;xyz\u0026#34;; let result = longest(string1.as_str(), string2); println!(\u0026#34;The longest string is {}\u0026#34;, result); } è©²å‡½å¼æ¥æ”¶çš„æ˜¯å­—ä¸²åˆ‡ç‰‡çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯å­—ä¸²ï¼Œå› æ­¤æˆ‘å€‘ä¸å¸Œæœ› longest æ‹¿åˆ°åƒæ•¸çš„æ‰€æœ‰æ¬Šã€‚\nå­—ä¸²åˆ‡ç‰‡æœ¬ä¾†å°±æ˜¯å¼•ç”¨ï¼Œæ‰€ä»¥ä½œç‚ºåƒæ•¸æ™‚å¯ä»¥ä¸ç”¨åŠ å…¥ \u0026amp;\nå¯¦ä½œ longest å‡½å¼ï¼š\nfn longest(x: \u0026amp;str, y: \u0026amp;str) -\u0026gt; \u0026amp;str { if x.len() \u0026gt; y.len() { x } else { y } } ç·¨è­¯å¾Œæœƒå‡ºç¾ç”Ÿå‘½é€±æœŸçš„éŒ¯èª¤ï¼š\n$ cargo run Compiling chapter10 v0.1.0 (file:///projects/hello) error[E0106]: missing lifetime specifier --\u0026gt; src/main.rs:9:33 | 9 | fn longest(x: \u0026amp;str, y: \u0026amp;str) -\u0026gt; \u0026amp;str { | ---- ---- ^ expected named lifetime parameter | = help: this function\u0026#39;s return type contains a borrowed value, but the signature does not say whether it is borrowed from `x` or `y` help: consider introducing a named lifetime parameter | 9 | fn longest\u0026lt;\u0026#39;a\u0026gt;(x: \u0026amp;\u0026#39;a str, y: \u0026amp;\u0026#39;a str) -\u0026gt; \u0026amp;\u0026#39;a str { | ++++ ++ ++ ++ For more information about this error, try `rustc --explain E0106`. error: could not compile `chapter10` due to previous error éŒ¯èª¤è¨Šæ¯è¡¨ç¤ºå›å‚³å‹åˆ¥å¿…é ˆè¦æœ‰ä¸€å€‹æ³›å‹ç”Ÿå‘½é€±æœŸåƒæ•¸ï¼Œå› ç‚º Rust ä¸çŸ¥é“å›å‚³çš„å¼•ç”¨æ˜¯ x é‚„æ˜¯ yã€‚äº‹å¯¦ä¸Šæˆ‘å€‘ä¹Ÿä¸çŸ¥é“ï¼Œå› ç‚ºé€™è£¡æ˜¯äº¤ç”± if else å€å¡Šåˆ¤å®š x å’Œ y å“ªå€‹å­—ä¸²å¤§å°±å›å‚³å“ªå€‹ã€‚\nç•¶æˆ‘å€‘ä¸çŸ¥é“å“ªå€‹å­—ä¸²æœƒè¢«å›å‚³ï¼Œä¹Ÿä¸çŸ¥é“å‚³éé€²ä¾†çš„å¼•ç”¨å¯¦éš›çš„ç”Ÿå‘½é€±æœŸç‚ºä½•ï¼Œå°±æœƒé€ æˆä»¥ä¸Šçš„å•é¡Œã€‚ç‚ºäº†è§£æ±ºé€™å€‹éŒ¯èª¤ï¼Œå¿…é ˆè¦åŠ ä¸Šæ³›å‹ç”Ÿå‘½é€±æœŸåƒæ•¸ä¾†å®šç¾©å¼•ç”¨çš„é—œä¿‚ï¼Œè®“å€Ÿç”¨æª¢æŸ¥å™¨èƒ½å¤ åˆ†æã€‚\nç”Ÿå‘½é€±æœŸè©®é‡‹èªæ³• ç”Ÿå‘½é€±æœŸè©®é‡‹ ( Lifetime Annotation ) ä¸æœƒæ”¹è®Šå¼•ç”¨èƒ½å­˜æ´»å¤šä¹…ï¼Œåªæ˜¯æè¿°å¼•ç”¨ä¹‹é–“çš„ç›¸äº’é—œä¿‚ï¼Œä¸æœƒå½±éŸ¿å¼•ç”¨çš„ç”Ÿå‘½é€±æœŸã€‚é€™å°±åƒå‡½å¼ç°½åæŒ‡å®šäº†ä¸€å€‹æ³›å‹å‹åˆ¥åƒæ•¸ï¼Œè©²å‡½å¼å°±èƒ½æ¥å—ä»»æ„å‹åˆ¥ä¸€æ¨£ã€‚å‡½å¼å¯ä»¥æŒ‡å®šä¸€å€‹æ³›å‹ç”Ÿå‘½é€±æœŸåƒæ•¸ï¼Œè©²å‡½å¼å°±èƒ½æ¥å—ä»»ä½•ç”Ÿå‘½é€±æœŸã€‚\nç”Ÿå‘½é€±æœŸåƒæ•¸çš„åç¨±å¿…é ˆä»¥ ( ' ) ä½œç‚ºé–‹é ­ï¼Œé€šå¸¸æ˜¯å°å¯«ä¸”å¾ˆçŸ­ã€‚å¤§å¤šæ•¸äººéƒ½ä½¿ç”¨ 'a ä½œç‚ºç¬¬ä¸€å€‹ç”Ÿå‘½é€±æœŸè©®é‡‹ã€‚å°‡ç”Ÿå‘½é€±æœŸè©®é‡‹æ”¾åœ¨ \u0026amp; å¾Œé¢ï¼Œå†ä½¿ç”¨ç©ºæ ¼ä¾†è©®é‡‹å¼•ç”¨çš„å‹åˆ¥ï¼š\n\u0026amp;i32 // ä¸€å€‹å¼•ç”¨ \u0026amp;\u0026#39;a i32 // ä¸€å€‹æœ‰é¡¯å¼ç”Ÿå‘½é€±æœŸçš„å¼•ç”¨ \u0026amp;\u0026#39;a mut i32 // ä¸€å€‹æœ‰é¡¯å¼ç”Ÿå‘½é€±æœŸçš„å¯è®Šå¼•ç”¨ åœ¨å‡½å¼ç°½åä¸­çš„ç”Ÿå‘½é€±æœŸè©®é‡‹ åœ¨æ­¤æ®µç°½åæƒ³è¦è¡¨é”ï¼šç•¶æ‰€æœ‰å‚³éé€²ä¾†çš„åƒæ•¸éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œé‚£å›å‚³çš„å¼•ç”¨æ‰æœƒæ˜¯æœ‰æ•ˆçš„ã€‚ä»¥ä¸‹æœƒå°‡ç”Ÿå‘½é€±æœŸå‘½åç‚º 'a ä¸¦åŠ é€²æ¯å€‹å¼•ç”¨ï¼š\nfn longest\u0026lt;\u0026#39;a\u0026gt;(x: \u0026amp;\u0026#39;a str, y: \u0026amp;\u0026#39;a str) -\u0026gt; \u0026amp;\u0026#39;a str { if x.len() \u0026gt; y.len() { x } else { y } } é€™æ¨£æ›´æ”¹å®Œ longest å°±èƒ½åŸ·è¡Œäº†ã€‚\næ­¤å‡½å¼ç°½åå‘Šè¨´ Rust æœ‰å€‹ç”Ÿå‘½é€±æœŸ 'aï¼Œå‡½å¼çš„å…©å€‹åƒæ•¸éƒ½æ˜¯å­—ä¸²åˆ‡ç‰‡ï¼Œä¸¦ä¸”éƒ½æœ‰ç”Ÿå‘½é€±æœŸ 'aï¼Œè€Œå›å‚³çš„å­—ä¸²åˆ‡ç‰‡ä¹Ÿæœƒå’Œç”Ÿå‘½é€±æœŸ 'a å­˜æ´»ä¸€æ¨£ä¹…ã€‚\næ³¨æ„ï¼šç•¶æ­¤å‡½å¼ç°½åæŒ‡å®šç”Ÿå‘½é€±æœŸåƒæ•¸æ™‚ï¼Œå°±ä¸èƒ½è®Šæ›´ä»»ä½•å‚³å…¥æˆ–å‚³å‡ºæ•¸å€¼çš„ç”Ÿå‘½é€±æœŸã€‚é€™å€‹ç›®çš„åªæ˜¯ç‚ºäº†å‘Šè¨´å€Ÿç”¨æª¢æŸ¥å™¨ä¸€ä»¶äº‹ï¼Œæ‹’çµ•ä»»ä½•æ²’æœ‰æœå¾ç´„æŸçš„æ•¸å€¼ã€‚longest å‡½å¼ä¸¦ä¸éœ€è¦çŸ¥é“ x èˆ‡ y æœƒå­˜æ´»å¤šä¹…ï¼Œå®ƒåªéœ€è¦çŸ¥é“æœ‰æŸå€‹ä½œç”¨åŸŸæœƒè¢« 'a æ‰€å–ä»£ã€‚\nç•¶ longest å‚³å…¥å¯¦éš›çš„å¼•ç”¨æ™‚ï¼Œæ³›å‹ç”Ÿå‘½é€±æœŸÂ 'aÂ å–å¾—çš„ç”Ÿå‘½é€±æœŸï¼Œæœƒç­‰æ–¼Â xÂ èˆ‡Â yÂ çš„ç”Ÿå‘½é€±æœŸä¸­è¼ƒçŸ­çš„ï¼Œè€Œå›å‚³å¼•ç”¨çš„ç”Ÿå‘½é€±æœŸä¹Ÿæœƒç›¸åŒã€‚\nå‚³å…¥ä¸åŒå¯¦éš›ç”Ÿå‘½é€±æœŸçš„å¼•ç”¨ï¼Œä¾†ä½¿ç”Ÿå‘½é€±æœŸè©®é‡‹èƒ½ç´„æŸÂ longestÂ å‡½å¼ï¼š\nfn main() { let string1 = String::from(\u0026#34;Long long string\u0026#34;); { let string2 = String::from(\u0026#34;xyz\u0026#34;); let result = longest(string1.as_str(), string2.as_str()); println!(\u0026#34;The longest string is {}\u0026#34;, result); } } string1 åœ¨å¤–éƒ¨ä½œç”¨åŸŸçµæŸå‰éƒ½æœ‰æ•ˆï¼›string2 åœ¨å…§éƒ¨ä½œç”¨åŸŸçµæŸå‰éƒ½æœ‰æ•ˆã€‚ result æœƒå–å¾—æŸå€‹å¼•ç”¨ç›´åˆ°å…§éƒ¨ä½œç”¨åŸŸçµæŸ ( ä¾ç…§åƒæ•¸æœ€çŸ­çš„ç”Ÿå‘½é€±æœŸ )ã€‚ æ¥ä¸‹ä¾†åšä¸€é»æ”¹è®Šï¼Œå¦‚æœå°‡ result ç§»å‹•åˆ°å¤–éƒ¨ä½œç”¨åŸŸåšå®£å‘Šï¼Œä¸¦ä¿ç•™ result çš„è³¦å€¼èˆ‡ string2 åœ¨å…§éƒ¨ä½œç”¨åŸŸã€‚ä¸¦å°‡ä½¿ç”¨ result çš„ println! ç§»å‹•åˆ°å¤–éƒ¨ä½œç”¨åŸŸï¼Œç·¨è­¯ä¸¦ä¸”è§€çœ‹çµæœï¼š\nfn main() { let string1 = String::from(\u0026#34;Long long string\u0026#34;); let result; { let string2 = String::from(\u0026#34;xyz\u0026#34;); result = longest(string1.as_str(), string2.as_str()); } println!(\u0026#34;The longest string is {}\u0026#34;, result); } ç·¨è­¯å¾Œæœƒçœ‹åˆ°ä»¥ä¸‹çš„éŒ¯èª¤è¨Šæ¯ï¼š\n$ cargo run Compiling chapter10 v0.1.0 (file:///projects/hello) error[E0597]: `string2` does not live long enough --\u0026gt; src/main.rs:6:44 | 6 | result = longest(string1.as_str(), string2.as_str()); | ^^^^^^^^^^^^^^^^ borrowed value does not live long enough 7 | } | - `string2` dropped here while still borrowed 8 | println!(\u0026#34;The longest string is {}\u0026#34;, result); | ------ borrow later used here For more information about this error, try `rustc --explain E0597`. error: could not compile `chapter10` due to previous error éŒ¯èª¤è¨Šæ¯è¡¨ç¤ºï¼Œéœ€è¦è®“ result èˆ‡ println! æœ‰æ•ˆçš„è©±ï¼Œstring2 å¿…é ˆè¦åœ¨å¤–éƒ¨ä½œç”¨åŸŸæœ‰æ•ˆï¼Œå› ç‚º Rust çŸ¥é“é€™å€‹å‡½å¼çš„åƒæ•¸èˆ‡å›å‚³å€¼ï¼Œéƒ½ä½¿ç”¨è‘—ç›¸åŒçš„ç”Ÿå‘½é€±æœŸ 'aã€‚\nç•¶ç„¶æˆ‘å€‘éƒ½çŸ¥é“ string1 å­—ä¸²é•·åº¦æ¯”è¼ƒé•·ï¼Œresult çš„çµæœæœƒæ˜¯ string1 çš„å¼•ç”¨ï¼Œè€Œä¸” string1 é‚„åœ¨ä½œç”¨åŸŸè£¡ï¼Œç…§ç†ä¾†èªªæ‡‰è©²æ˜¯ä¸æœƒæœ‰å•é¡Œæ‰å°ã€‚ä½†æ˜¯ç·¨è­¯å™¨ä¸æ‡‚ï¼Œæ‰€ä»¥æˆ‘å€‘æ‰æœƒå‘Šè¨´ Rust æ­¤å‡½å¼æ‰€å›å‚³å¼•ç”¨çš„ç”Ÿå‘½é€±æœŸï¼Œæœƒç­‰æ–¼è¼ƒçŸ­çš„ç”Ÿå‘½é€±æœŸã€‚æ‰€ä»¥ç·¨è­¯å™¨æ‰æœƒå ±éŒ¯ï¼Œå› ç‚ºå›å‚³å¯èƒ½æœƒåŒ…å«ç„¡æ•ˆçš„å¼•ç”¨ã€‚\næ·±å…¥ç†è§£ç”Ÿå‘½é€±æœŸ å†ä¾†åšä¸€é»æ”¹è®Šï¼Œå¦‚æœç¾åœ¨ longest å›å‚³çš„æ¢ä»¶æ˜¯æ°¸é å›å‚³ç¬¬ä¸€å€‹å­—ä¸²åˆ‡ç‰‡ï¼Œé‚£åƒæ•¸ y å°±å¯ä»¥ä¸éœ€è¦æŒ‡å®šç”Ÿå‘½é€±æœŸï¼š\nfn longest\u0026lt;\u0026#39;a\u0026gt;(x: \u0026amp;\u0026#39;a str, y: \u0026amp;str) -\u0026gt; \u0026amp;\u0026#39;a str { x } é€™æ˜¯å› ç‚º x èˆ‡å›å‚³å‹åˆ¥çš„ç”Ÿå‘½é€±æœŸéƒ½æ˜¯ 'aï¼Œä½†ç¾åœ¨æ°¸é åªå›å‚³ xï¼Œy æœ‰æ²’æœ‰ç”Ÿå‘½é€±æœŸæ ¹æœ¬æ²’æœ‰ä»»ä½•å·®åˆ¥ã€‚é€™ä¹Ÿè¡¨ç¤ºç•¶å‡½å¼å›å‚³å¼•ç”¨æ™‚ï¼Œå›å‚³å‹åˆ¥çš„ç”Ÿå‘½é€±æœŸå¿…é ˆç¬¦åˆå…¶ä¸­ä¸€å€‹åƒæ•¸çš„ç”Ÿå‘½é€±æœŸã€‚æ‰€ä»¥ä¸‹é¢çš„ç¨‹å¼ç¢¼æ˜¯ä¸æœƒç·¨è­¯æˆåŠŸçš„ï¼š\nfn longest\u0026lt;\u0026#39;a\u0026gt;(x: \u0026amp;str, y: \u0026amp;str) -\u0026gt; \u0026amp;\u0026#39;a str { let result = String::from(\u0026#34;Long long string\u0026#34;); result.as_str() } å› ç‚ºå›å‚³å€¼çš„ç”Ÿå‘½é€±æœŸèˆ‡åƒæ•¸çš„ç”Ÿå‘½é€±æœŸç„¡é—œã€‚éŒ¯èª¤è¨Šæ¯ç‚ºï¼š\n$ cargo run Compiling chapter10 v0.1.0 (file:///projects/hello) error[E0515]: cannot return reference to local variable `result` --\u0026gt; src/main.rs:11:5 | 11 | result.as_str() | ^^^^^^^^^^^^^^^ returns a reference to data owned by the current function For more information about this error, try `rustc --explain E0515`. error: could not compile `chapter10` due to previous error æ­¤æ™‚æˆ‘å€‘å˜—è©¦å¾å‡½å¼ä¸­å›å‚³ result å¼•ç”¨ï¼Œ ä½† result å·²ç¶“é›¢é–‹ä½œç”¨åŸŸï¼Œå·²ç¶“æ˜¯è¿·é€”å¼•ç”¨äº†ï¼ŒRust æ˜¯ä¸æœƒå…è¨±ä½¿ç”¨è¿·é€”å¼•ç”¨ã€‚è§£æ±ºé€™å€‹å•é¡Œæœ€å¥½çš„æ–¹æ³•å°±æ˜¯å›å‚³æœ‰æ‰€æœ‰æ¬Šçš„å‹åˆ¥ï¼Œè€Œä¸æ˜¯å¼•ç”¨ã€‚\nç”±ä¸Šå¯çŸ¥ï¼Œç”Ÿå‘½é€±æœŸèªæ³•æ˜¯ç”¨ä¾†é€£æ¥å‡½å¼ä¸­ä¸åŒåƒæ•¸èˆ‡å›å‚³å€¼çš„ç”Ÿå‘½é€±æœŸã€‚åªè¦èƒ½é€£çµï¼ŒRust å°±èƒ½æœ‰è¶³å¤ çš„è³‡è¨Šé˜²æ­¢ç”¢ç”Ÿè¿·é€”æŒ‡æ¨™æˆ–é•åè¨˜æ†¶é«”å®‰å…¨çš„æ“ä½œã€‚\nåœ¨çµæ§‹é«”ä¸­ä½¿ç”¨ç”Ÿå‘½é€±æœŸè©®é‡‹ çµæ§‹é«”çš„æ‰€æœ‰å®šç¾©éƒ½æŒæœ‰å‹åˆ¥çš„æ‰€æœ‰æ¬Šï¼Œç„¶è€Œçµæ§‹é«”ä¹Ÿå¯ä»¥æŒæœ‰å¼•ç”¨ã€‚åœ¨é€™è£¡ä½¿ç”¨ ImportantExcerpt ä¾†ç•¶ä½œä¾‹å­ï¼š\nstruct ImportantExcerpt\u0026lt;\u0026#39;a\u0026gt; { part: \u0026amp;\u0026#39;a str, } fn main() { let novel = String::from(\u0026#34;Call me Ishmael. Some years ago...\u0026#34;); let first_sentence = novel.split(\u0026#39;.\u0026#39;).next().expect(\u0026#34;Can not find \u0026#39;.\u0026#39;\u0026#34;); let i = ImportantExcerpt { part: first_sentence, }; } å¦‚åŒæ³›å‹è³‡æ–™å‹åˆ¥ï¼Œåœ¨çµæ§‹é«”åç¨±å¾ŒåŠ ä¸Šæ³›å‹ç”Ÿå‘½é€±æœŸåƒæ•¸ ( \u0026lt;'a\u0026gt; ) åœ¨ main è£¡ç”¢ç”Ÿä¸€å€‹çµæ§‹é«” ImportantExcerpt å¯¦ä¾‹ï¼Œè®Šæ•¸ novel æ“æœ‰ String è³‡æ–™ï¼Œè€Œ novel åœ¨ ImportantExcerpt å¯¦ä¾‹ä¹‹å‰å»ºç«‹çš„ï¼Œé€™è¡¨ç¤º novel ä¸æœƒæ¯” ImportantExcerpt æ—©é›¢é–‹ä½œç”¨åŸŸï¼Œæ‰€ä»¥ ImportantExcerpt è£¡çš„å¼•ç”¨å°±èƒ½æˆç«‹ çœç•¥ç”Ÿå‘½é€±æœŸ ç¾åœ¨æˆ‘å€‘å·²ç¶“çŸ¥é“æ¯å€‹å¼•ç”¨éƒ½æœ‰ç”Ÿå‘½é€±æœŸï¼Œé‚£æ˜¯å¦æ¯ä¸€æ¬¡éƒ½è¦å¯«å‡ºä¾†å‘¢ï¼Ÿä»¥ä¸‹çš„å‡½å¼æ˜¯æ²’æœ‰è©®é‡‹ç”Ÿå‘½é€±æœŸé‚„å¯ä»¥ç·¨è­¯æˆåŠŸçš„ï¼š\nfn first_word(s: \u0026amp;str) -\u0026gt; \u0026amp;str { let bytes = s.as_bytes(); for (i, \u0026amp;item) in bytes.iter().enumerate() { if item == b\u0026#39; \u0026#39; { return \u0026amp;s[0..i]; } } \u0026amp;s[..] } ä»¥ä¸Šçš„ç¨‹å¼æ›¾ç¶“å‡ºç¾åœ¨Rust: æ‰€æœ‰æ¬Š ( Ownership )ï¼Œé‚£ç‚ºä»€éº¼å®ƒå¯ä»¥ä¸ç”¨å¯«å‡ºç”Ÿå‘½é€±æœŸï¼Ÿ\nå¦‚æœæ˜¯åœ¨æ—©æœŸç‰ˆæœ¬ Rust ( 1.0 ä¹‹å‰ )ï¼Œä¸Šé¢çš„ç¨‹å¼ç¢¼å°±çœŸçš„ç„¡æ³•ç·¨è­¯äº†ï¼Œå› ç‚ºé‚£å€‹æ™‚å€™æ¯å€‹å¼•ç”¨éƒ½å¿…é ˆè¦é¡¯ç¤ºç”Ÿå‘½é€±æœŸï¼Œåœ¨ç•¶æ™‚æ­¤å‡½å¼å°±æœƒæ˜¯ï¼š\nfn first_word\u0026lt;\u0026#39;a\u0026gt;(s: \u0026amp;\u0026#39;a str) -\u0026gt; \u0026amp;\u0026#39;a str{ åœ¨å¯«äº†å¤§é‡ Rust ç¨‹å¼ç¢¼å¾Œï¼ŒRust åœ˜éšŠç™¼ç¾é–‹ç™¼è€…æœƒåœ¨ç‰¹å®šæƒ…æ³åè¦†è¼¸å…¥åŒæ¨£çš„ç”Ÿå‘½é€±æœŸè©®é‡‹ï¼Œè€Œé€™äº›æƒ…æ³éƒ½æ˜¯å¯é æœŸçš„ï¼Œä¸¦ä¸”éµå¾ªä¸€äº›æ˜ç¢ºçš„æ¨¡å¼ã€‚æ‰€ä»¥ Rust åœ˜éšŠå°‡é€™äº›æ¨¡å¼åŠ å…¥ç·¨è­¯å™¨çš„ç¨‹å¼ç¢¼ä¸­ï¼Œè®“å€Ÿç”¨æª¢æŸ¥å™¨å¯ä»¥ä¾æ“šé€™äº›è¦å‰‡è‡ªè¡Œæ¨å°ç”Ÿå‘½ç”Ÿå‘½é€±æœŸã€‚\né€™å€‹è®“ Rust åˆ†æçš„æ¨¡å¼ç¨±ç‚ºç”Ÿå‘½é€±æœŸçœç•¥è¦å‰‡ ( lifetime elision rules ) ï¼Œç•¶ä½ çš„ç¨‹å¼ç¢¼ç¬¦åˆè©²æƒ…å½¢æ™‚ï¼Œå°±å¯ä»¥ä¸ç”¨å¯«å‡ºç”Ÿå‘½é€±æœŸã€‚\nç”Ÿå‘½é€±æœŸçœç•¥è¦å‰‡ä¸¦ä¸æ˜¯å®Œç¾çš„ï¼Œé‚„æ˜¯æœ‰ä¸€äº›æ¨¡ç¨œå…©å¯çš„ç”Ÿå‘½é€±æœŸï¼Œç•¶ç·¨è­¯å™¨ç„¡æ³•çŒœå‡ºç”Ÿå‘½é€±æœŸæ™‚ï¼Œå°±æœƒå›å‚³éŒ¯èª¤çµ¦ä½ ï¼Œèªªæ˜ä½ å¿…é ˆè‡ªå·±æŒ‡å®šç”Ÿå‘½é€±æœŸ\nç”Ÿå‘½é€±æœŸçœç•¥è¦å‰‡ ( Lifetime elision rules ) é¦–å…ˆè¦å…ˆçŸ¥é“ç”Ÿå‘½é€±æœŸæœ‰å…©ç¨®ï¼š\nåœ¨å‡½å¼æˆ–æ–¹æ³•åƒæ•¸ä¸Šçš„ç”Ÿå‘½é€±æœŸç¨±ç‚ºè¼¸å…¥ç”Ÿå‘½é€±æœŸ ( input lifetimes ) åœ¨å›å‚³å€¼çš„ç”Ÿå‘½é€±æœŸå‰‡ç¨±ç‚ºè¼¸å‡ºç”Ÿå‘½é€±æœŸ ( output lifetimes ) ç·¨è­¯å™¨æœƒæ ¹æ“šä¸‰é …è¦å‰‡ä¾†æ¨å°æ²’æœ‰é¡¯å¼ç”Ÿå‘½é€±æœŸçš„å‹åˆ¥ã€‚ç¬¬ä¸€å€‹è¦å‰‡é©ç”¨æ–¼è¼¸å…¥ç”Ÿå‘½é€±æœŸï¼Œè€Œç¬¬äºŒèˆ‡ç¬¬ä¸‰å€‹è¦å‰‡é©ç”¨æ–¼è¼¸å‡ºç”Ÿå‘½é€±æœŸã€‚å¦‚æœä¸‰å€‹è¦å‰‡è·‘å®Œï¼Œé‚„æ˜¯æ²’æœ‰æ¨æ–·å‡ºç”Ÿå‘½é€±æœŸï¼Œç·¨è­¯å™¨å°±æœƒåœæ­¢ä¸¦å›å‚³éŒ¯èª¤ã€‚\nç¬¬ä¸€å€‹è¦å‰‡ï¼šç·¨è­¯å™¨æœƒçµ¦äºˆæ¯å€‹å¼•ç”¨åƒæ•¸ä¸€å€‹ç”Ÿå‘½é€±æœŸåƒæ•¸ï¼š\nfn foo\u0026lt;\u0026#39;a\u0026gt;(x: \u0026amp;\u0026#39;a i32) // 1å€‹åƒæ•¸ï¼›1å€‹ç”Ÿå‘½é€±æœŸ fn foo\u0026lt;\u0026#39;a, \u0026#39;b\u0026gt;(x: \u0026amp;\u0026#39;a i32, y: \u0026amp;\u0026#39;b i32) // 2å€‹åƒæ•¸ï¼›2å€‹ç”Ÿå‘½é€±æœŸ ç¬¬äºŒå€‹è¦å‰‡ï¼šå¦‚æœåªæœ‰ä¸€å€‹è¼¸å…¥ç”Ÿå‘½é€±æœŸåƒæ•¸ï¼Œæ‰€æœ‰è¼¸å‡ºç”Ÿå‘½é€±æœŸåƒæ•¸å°±ç­‰æ–¼æ­¤åƒæ•¸ï¼š\nfn foo\u0026lt;\u0026#39;a\u0026gt;(x: \u0026amp;\u0026#39;a i32) -\u0026gt; \u0026amp;\u0026#39;a i32 ç¬¬ä¸‰å€‹è¦å‰‡ï¼šå¦‚æœè¼¸å…¥çš„ç”Ÿå‘½é€±æœŸåƒæ•¸è£¡æœ‰Â \u0026amp;selfÂ æˆ–Â \u0026amp;mut selfï¼Œå¾ˆæ˜é¡¯é€™å°±æ˜¯æ–¹æ³• ( methods )ï¼Œé‚£ self çš„ç”Ÿå‘½é€±æœŸåƒæ•¸å°±ç­‰åŒæ–¼æ‰€æœ‰è¼¸å‡ºç”Ÿå‘½é€±æœŸåƒæ•¸ã€‚\nç¾åœ¨å°±å¯ä»¥æ ¹æ“šä¸Šé¢çš„ä¸‰å€‹è¦å‰‡ï¼Œä¾†è§£é‡‹ å‡½å¼ä¸­çš„æ³›å‹ç”Ÿå‘½é€±æœŸ è£¡çš„ longest å‡½å¼éŒ¯èª¤çš„åŸå› äº†ï¼š\nfn longest(x: \u0026amp;str, y: \u0026amp;str) -\u0026gt; \u0026amp;str { å…ˆå¥—ç”¨ç¬¬ä¸€å€‹è¦å‰‡ï¼Œæ¯å€‹åƒæ•¸éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½é€±æœŸã€‚è€Œé€™æ¬¡æœ‰å…©å€‹åƒæ•¸ï¼š\nfn longest\u0026lt;\u0026#39;a, \u0026#39;b\u0026gt;(x: \u0026amp;\u0026#39;a str, y: \u0026amp;\u0026#39;b str) -\u0026gt; \u0026amp;str { ç¬¬äºŒå€‹è¦å‰‡å°±ä¸é©ç”¨äº†ï¼Œå› ç‚ºé€™è£¡ä¸åªæœ‰ä¸€å€‹ç”Ÿå‘½é€±æœŸåƒæ•¸ã€‚ç¬¬ä¸‰å€‹è¦å‰‡ä¹Ÿä¸é©ç”¨ï¼Œlongest æ˜¯å‡½å¼è€Œä¸æ˜¯æ–¹æ³•ã€‚ç¶“éä¸‰å€‹è¦å‰‡å¾Œï¼Œç·¨è­¯å™¨é‚„æ˜¯ç„¡æ³•æ¨æ–·å‡ºå‹åˆ¥çš„ç”Ÿå‘½é€±æœŸï¼Œé€™ä¹Ÿå°±æ˜¯ç¨‹å¼æœƒå‡ºç¾éŒ¯èª¤çš„åŸå› ã€‚\nå±¬æ–¼æ–¹æ³•å®šç¾©ä¸­çš„ç”Ÿå‘½é€±æœŸè©®é‡‹ é‚£ç‚ºä»€éº¼ç¬¬ä¸‰å€‹è¦å‰‡åªé©ç”¨æ–¼æ–¹æ³•å‘¢ï¼Ÿ\nçµæ§‹é«”æ¬„ä½çš„ç”Ÿå‘½é€±æœŸæ°¸é éœ€è¦å®£å‘Šåœ¨Â implÂ é—œéµå­—å¾Œæ–¹ä»¥åŠçµæ§‹é«”åç¨±å¾Œæ–¹ï¼Œå› ç‚ºé€™äº›ç”Ÿå‘½é€±æœŸæ˜¯çµæ§‹é«”å‹åˆ¥çš„ä¸€éƒ¨åˆ†ã€‚\nåœ¨ impl å€å¡Šä¸­ï¼Œæ–¹æ³•æ‰€ç°½åçš„å¼•ç”¨å¾ˆå¯èƒ½æœƒèˆ‡çµæ§‹é«”æ¬„ä½çš„å¼•ç”¨ç”Ÿå‘½é€±æœŸç¶å®šï¼Œç•¶ç„¶å®ƒå€‘ä¹Ÿå¯èƒ½æ˜¯ç¨ç«‹çš„ã€‚\né€™è£¡ä½¿ç”¨ ImportantExcerpt ä¾†ä½œç¯„ä¾‹ï¼Œé¦–å…ˆä½¿ç”¨ä¸€å€‹æ–¹æ³•åç‚º levelï¼Œå…¶åƒæ•¸å°±åªæœ‰ \u0026amp;self çš„å¼•ç”¨ï¼Œè€Œå›å‚³å€¼æ˜¯ i32 ä¸¦ä¸æ˜¯å¼•ç”¨ï¼š\nstruct ImportantExcerpt\u0026lt;\u0026#39;a\u0026gt; { part: \u0026amp;\u0026#39;a str, } impl\u0026lt;\u0026#39;a\u0026gt; ImportantExcerpt\u0026lt;\u0026#39;a\u0026gt; { fn level(\u0026amp;self) -\u0026gt; i32 { 3 } } ä»¥ä¸‹ç‚ºç¬¬ä¸‰å€‹ç”Ÿå‘½é€±æœŸçœç•¥è¦å‰‡é©ç”¨çš„ç¯„ä¾‹ï¼š\nimpl\u0026lt;\u0026#39;a\u0026gt; ImportantExcerpt\u0026lt;\u0026#39;a\u0026gt; { fn announce_and_return_part(\u0026amp;self, announcement: \u0026amp;str) -\u0026gt; \u0026amp;str { println!(\u0026#34;Noticeï¼š{}\u0026#34;, announcement); self.part } } é¦–å…ˆï¼Œæ ¹æ“šç¬¬ä¸€å€‹ç”Ÿå‘½é€±æœŸçœç•¥è¦å‰‡ï¼Œçµ¦äºˆ \u0026amp;self èˆ‡ announcement å„è‡ªçš„ç”Ÿå‘½é€±æœŸã€‚ç„¶å¾Œå› ç‚ºå…¶ä¸­ä¸€å€‹åƒæ•¸æ˜¯ \u0026amp;selfï¼Œé©ç”¨æ–¼ç¬¬ä¸‰å€‹ç”Ÿå‘½é€±æœŸçœç•¥è¦å‰‡ï¼Œæ‰€ä»¥è©²å›å‚³å‹åˆ¥æœƒå–å¾—Â \u0026amp;selfÂ çš„ç”Ÿå‘½é€±æœŸã€‚\néœæ…‹ç”Ÿå‘½é€±æœŸ æœ‰å€‹ç‰¹æ®Šçš„ç”Ÿå‘½é€±æœŸÂ 'staticï¼Œé€™è¡¨ç¤ºè©²å¼•ç”¨å¯ä»¥å­˜æ´»åœ¨æ•´å€‹ç¨‹å¼æœŸé–“ã€‚å­—ä¸²æœ‰ 'static ç”Ÿå‘½é€±æœŸï¼š\nlet s: \u0026amp;\u0026#39;static str = \u0026#34;I have static lifetime\u0026#34;; æ­¤å­—ä¸²çš„æ–‡å­—æœƒç›´æ¥å„²å­˜åœ¨ç¨‹å¼çš„åŸ·è¡Œæª”ä¸­ï¼Œæ°¸é æœ‰æ•ˆã€‚\næ³›å‹å‹åˆ¥åƒæ•¸ã€ç‰¹å¾µç•Œé™èˆ‡ç”Ÿå‘½é€±æœŸçš„çµ„åˆ é€™é‚Šä½¿ç”¨ä¸€å€‹å‡½å¼ä¾†çµ„åˆæ³›å‹å‹åˆ¥åƒæ•¸ã€ç‰¹å¾µç•Œé™èˆ‡ç”Ÿå‘½é€±æœŸï¼š\nuse std::fmt::Display; fn longest_with_an_announcement\u0026lt;\u0026#39;a, T\u0026gt;( x: \u0026amp;\u0026#39;a str, y: \u0026amp;\u0026#39;a str, ann: T, ) -\u0026gt; \u0026amp;\u0026#39;a str where T: Display, { println!(\u0026#34;Announcementï¼{}\u0026#34;, ann); if x.len() \u0026gt; y.len() { x } else { y } } é€™å€‹å‡½å¼æœƒæ¯”è¼ƒå…©å€‹å­—ä¸²åˆ‡ç‰‡ï¼Œä¸¦å›å‚³æ¯”è¼ƒé•·çš„é‚£ä¸€å€‹ ann ä½¿ç”¨æ³›å‹å‹åˆ¥ Tï¼Œå¾Œé¢çš„ where å¯ä»¥æŒ‡å®š T æœ‰ Display ç‰¹å¾µã€‚é€™è¡¨ç¤ºé€™å€‹ ann åƒæ•¸å¯ä»¥ä½¿ç”¨ {} æ–¹å¼å°å‡ºä¾† ç”Ÿå‘½é€±æœŸä¹Ÿæ˜¯ä¸€ç¨®æ³›å‹ï¼Œæ‰€ä»¥ç”Ÿå‘½é€±æœŸåƒæ•¸ 'a èˆ‡ æ³›å‹å‹åˆ¥åƒæ•¸ T éƒ½æœƒä¸€èµ·å¯«åœ¨ \u0026lt;\u0026gt; è£¡ çµè«– ç”Ÿå‘½é€±æœŸèˆ‡æ‰€æœ‰æ¬Šéƒ½æ˜¯ Rust ç®¡ç†è¨˜æ†¶é«”å¾ˆé‡è¦çš„æ©Ÿåˆ¶ï¼Œè€Œé€éå€Ÿç”¨æª¢æŸ¥å™¨å°‡å¼•ç”¨çš„ä½œç”¨åŸŸåšæ¯”è¼ƒï¼Œå¯ä»¥è®“ç„¡æ•ˆçš„å¼•ç”¨åœ¨ç·¨è­¯æœŸé–“å°±è¢«ç™¼ç¾ã€‚åœ¨ä¸‰å€‹ç”Ÿå‘½é€±æœŸçœç•¥è¦å‰‡ä¸‹ï¼ŒRust å¤§å¤šçš„ç”Ÿå‘½é€±æœŸéƒ½å¯ä»¥è‡ªå‹•è¢«æ¨å°å‡ºä¾†ï¼Œé€™å°±è·Ÿé€™å°±è·Ÿå‹åˆ¥ä¸€æ¨£ã€‚\nä»¥ä¸Šé€™äº›åˆ†æéƒ½æ˜¯åœ¨ç·¨è­¯æœŸé–“é€²è¡Œçš„ï¼Œå®Œå…¨ä¸æœƒå½±éŸ¿åŸ·è¡Œçš„æ•ˆèƒ½ğŸ˜†ï¼\n","permalink":"https://et860525.github.io/posts/rust-lifetimes/","summary":"\u003cp\u003e\u003cstrong\u003eç”Ÿå‘½é€±æœŸ ( lifetimes )\u003c/strong\u003e æœƒç¢ºä¿æˆ‘å€‘åœ¨éœ€è¦å¼•ç”¨çš„æ™‚å€™ï¼Œå®ƒå€‘éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨ Rust ä¸­ï¼Œæ¯å€‹å¼•ç”¨éƒ½æ˜¯æœ‰ç”Ÿå‘½é€±æœŸçš„ï¼Œç°¡å–®ä¾†èªªå°±æ˜¯å®ƒçš„æœ‰æ•ˆç¯„åœã€‚åœ¨å¤§å¤šæƒ…æ³ä¸‹ï¼Œç”Ÿå‘½é€±æœŸéƒ½æ˜¯éš±è—ä¸”å¯ä»¥æ¨å°å‡ºä¾†çš„ï¼Œå¦‚åŒå‹åˆ¥ä¸€æ¨£ä¹Ÿéƒ½æ˜¯å¯ä»¥æ¨å°å‡ºä¾†çš„ã€‚ç•¶å‹åˆ¥æœ‰å¾ˆå¤šç¨®å¯èƒ½çš„æƒ…æ³ä¸‹ï¼Œå°±è¦\u003cstrong\u003eè©®é‡‹å‹åˆ¥\u003c/strong\u003eï¼ŒåŒæ¨£åœ¨ç”Ÿå‘½é€±æœŸä¸‹ï¼Œå¼•ç”¨ä»¥ä¸åŒæ–¹å¼é—œè¯çš„è©±ï¼Œå°±è¦\u003cstrong\u003eè©®é‡‹ç”Ÿå‘½é€±æœŸ\u003c/strong\u003eã€‚\u003c/p\u003e","title":"Rust: ç”Ÿå‘½é€±æœŸ( Lifetimes )"},{"content":"é€™ç¯‡æ–‡ç« æœƒç´€éŒ„å¦‚ä½•åœ¨ Express å°ˆæ¡ˆè£¡è¨­å®š TypeScriptã€‚\nå…ˆæ±ºæ¢ä»¶ï¼š\nå®‰è£ Node.js ( LTS ) åœ¨ä½ çš„é–‹ç™¼ç’°å¢ƒä¸Š åŸºæœ¬çš„ Node.js ã€ Express èˆ‡ TypeScript çŸ¥è­˜ å°ˆæ¡ˆåˆå§‹åŒ– å»ºç«‹ä¸€å€‹ç©ºçš„è³‡æ–™å¤¾ï¼Œä¸¦åˆå§‹åŒ–Â package.jsonï¼š\nmkdir express-typescript cd express-typescript npm init -y ä¸‹è¼‰ Express èˆ‡é–‹ç™¼ä¼ºæœå™¨çš„ç›¸é—œå¥—ä»¶ï¼š\nnpm i express dotenv dotenvÂ æ˜¯ä¸€å€‹ç®¡ç†ç’°å¢ƒè®Šæ•¸çš„å¥—ä»¶ï¼Œå¯ä»¥æ ¹æ“šç’°å¢ƒçš„ä¸åŒè¨­å®šä¸åŒçš„é…ç½® å®‰è£ TypeScript èˆ‡Â @typesÂ å®£å‘Šå¥—ä»¶ï¼š\nnpm i -D typescript @types/express @types/node @types/\u0026lt;package-name\u0026gt;ï¼šåªè¦è©²å¥—ä»¶æœ‰æ”¯æ´ TypeScriptï¼Œä½ å°±èƒ½åœ¨ç›´æ¥ä½¿ç”¨é€™å€‹æ–¹å¼ï¼Œä¸‹è¼‰é å…ˆå®šç¾©å¥½çš„å®£å‘Šæª”æ¡ˆ -D æ˜¯ --save-devï¼šè¡¨ç¤ºå¥—ä»¶åªæœƒå­˜åœ¨æ–¼ devDependencies éƒ½å®Œæˆå¾Œå¯ä»¥æª¢æŸ¥ package.json æª”æ¡ˆ (æ²’æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå¥—ä»¶çš„ç‰ˆæœ¬ä»¥è‡ªå·±çš„ç‚ºæº–)ï¼š\n{ \u0026#34;name\u0026#34;: \u0026#34;express-typescript\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;main\u0026#34;: \u0026#34;index.js\u0026#34;, \u0026#34;scripts\u0026#34;: { \u0026#34;test\u0026#34;: \u0026#34;echo \\\u0026#34;Error: no test specified\\\u0026#34; \u0026amp;\u0026amp; exit 1\u0026#34; }, \u0026#34;keywords\u0026#34;: [], \u0026#34;author\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;license\u0026#34;: \u0026#34;ISC\u0026#34;, \u0026#34;dependencies\u0026#34;: { \u0026#34;dotenv\u0026#34;: \u0026#34;^16.0.3\u0026#34;, \u0026#34;express\u0026#34;: \u0026#34;^4.18.2\u0026#34; }, \u0026#34;devDependencies\u0026#34;: { \u0026#34;@types/express\u0026#34;: \u0026#34;^4.17.17\u0026#34;, \u0026#34;@types/node\u0026#34;: \u0026#34;^18.11.18\u0026#34;, \u0026#34;typescript\u0026#34;: \u0026#34;^4.9.5\u0026#34; } } ç”¢ç”Ÿ TypeScript çš„é…ç½®æ–‡ä»¶ ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ä¾†ç”¢ç”ŸÂ tsconfig.jsonï¼š\nnpx tsc --init åœ¨è¼¸å‡ºå¯ä»¥çœ‹åˆ°ç”¢ç”Ÿçš„æª”æ¡ˆèˆ‡é è¨­çš„è¨­å®šï¼š\nCreated a new tsconfig.json with: target: es2016 module: commonjs strict: true esModuleInterop: true skipLibCheck: true forceConsistentCasingInFileNames: true You can learn more at https://aka.ms/tsconfig é€™è£¡ä¹Ÿå¯ä»¥æ‰“é–‹ tsconfig.json ä¾†ä¿®æ”¹è‡ªå·±éœ€è¦çš„è¨­å®šã€‚ä»¥ä¸‹æ˜¯æˆ‘çš„è¨­å®šï¼š\n{ \u0026#34;compilerOptions\u0026#34;: { \u0026#34;target\u0026#34;: \u0026#34;es2017\u0026#34;, \u0026#34;module\u0026#34;: \u0026#34;commonjs\u0026#34;, \u0026#34;esModuleInterop\u0026#34;: true, \u0026#34;skipLibCheck\u0026#34;: true, \u0026#34;forceConsistentCasingInFileNames\u0026#34;: true, \u0026#34;strict\u0026#34;: true, \u0026#34;rootDir\u0026#34;: \u0026#34;./src\u0026#34;, \u0026#34;outDir\u0026#34;: \u0026#34;./dist\u0026#34;, }, \u0026#34;include\u0026#34;: [\u0026#34;src/**/*.ts\u0026#34;], \u0026#34;exclude\u0026#34;: [\u0026#34;node_modules\u0026#34;, \u0026#34;dist\u0026#34;] } é è¨­çš„è¨­å®šï¼š\ntargetï¼šæŒ‡å®šç·¨è­¯å™¨æ‰€ç”¢ç”Ÿçš„ JavaScript version moduleï¼šç·¨è­¯ JavaScript ç¨‹å¼ç¢¼ä½¿ç”¨çš„ modules managerã€‚commonjsÂ ç‚º Node.js çš„æ¨™æº– strictï¼šåš´æ ¼é¡å‹æª¢æŸ¥é¸é … esModuleInteropï¼šè®“æˆ‘å€‘èƒ½å°‡ ES6 modules ç·¨è­¯æˆ commonJS modules skipLibCheckï¼šå¦‚æœç‚ºÂ trueï¼Œå‰‡æœƒè·³éæª¢æŸ¥åŸºç¤å®£å‘Šæª”æ¡ˆ ( declaration files ) forceConsistentCasingInFileNamesï¼šå¦‚æœç‚ºÂ trueï¼Œå•Ÿç”¨å€åˆ†å¤§å°å¯«å‘½åæ–‡ä»¶ æ–°å¢çš„è¨­å®šï¼š\nrootDirï¼šæ¬²ç·¨è­¯çš„è·¯å¾‘ï¼ŒæŠŠè©²è³‡æ–™å¤¾è£¡é¢çš„ .ts éƒ½ç·¨è­¯æˆ JavaScript outDirï¼šç·¨è­¯å¾Œè¼¸å‡ºæª”æ¡ˆçš„åœ°æ–¹ includeï¼šç´å…¥ç·¨è­¯çš„ç¯„åœ excludeï¼šä¸ç´å…¥ç·¨è­¯çš„ç¯„åœ å»ºç«‹ Express app é¦–å…ˆï¼Œå…ˆåœ¨æ ¹ç›®éŒ„ ( root ) ä¸‹å»ºç«‹ä¸€å€‹æª”æ¡ˆ .envï¼Œé€™å€‹æª”æ¡ˆå­˜æ”¾çš„æ˜¯æ•æ„Ÿè³‡æ–™ä¾› dotenv ä¾†è®€å–çš„ã€‚è©²æª”æ¡ˆç›®å‰æœƒæœ‰ä»¥ä¸‹è¨­å®šï¼š\nPORT=3000 ä¹‹å¾Œå†æ–°å¢æª”æ¡ˆ src/app.ts ä¸¦è¼¸å…¥ä¸‹é¢çš„ç¨‹å¼ç¢¼ä¾†å»ºç«‹ä¸€å€‹ä¼ºæœå™¨ï¼š\nimport express, { Express, Request, Response } from \u0026#39;express\u0026#39;; import dotenv from \u0026#39;dotenv\u0026#39;; dotenv.config(); const app: Express = express(); const port = process.env.PORT; app.get(\u0026#39;/\u0026#39;, (req: Request, res: Response) =\u0026gt; { res.send(\u0026#39;Express + TypeScript Server\u0026#39;); }); app.listen(port, () =\u0026gt; { console.log( `[server]: Server is running at http://localhost:${port}` ); }); é€é dotenv å°±å¯ä»¥è®“ port ç²å–åœ¨ .env æª”æ¡ˆè£¡çš„è¨­å®š è¦é‹è¡Œä¼ºæœå™¨å‰å¿…é ˆè¦å…ˆçŸ¥é“ä¸€ä»¶äº‹æƒ…ï¼Œç€è¦½å™¨æ˜¯ç„¡æ³•ç†è§£ TypeScript ç¨‹å¼ç¢¼çš„ï¼Œå¿…é ˆè¦å…ˆå°‡æª”æ¡ˆè½‰æˆ JavaScript ç€è¦½å™¨æ‰èƒ½ä½¿ç”¨ã€‚é‚£è¦å¦‚ä½•æ‰èƒ½è®“ TypeScript çŸ¥é“å“ªäº›æª”æ¡ˆæ˜¯éœ€è¦ç·¨è­¯çš„å‘¢ï¼Ÿé€™æ™‚å€™è¨­å®š tsconfig.json å°±å¾ˆé‡è¦äº† (è«‹åƒè€ƒä¸Šæ–¹ tsconfig.json æ‰€æ–°å¢çš„è¨­å®š)ã€‚\nå¦‚æœå·²ç¶“æœ‰è¨­å®šæŒ‡å®šçš„è³‡æ–™å¤¾ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤ä¾†å°‡ .ts æª”æ¡ˆè½‰ç‚º .jsï¼š\ntsc è½‰æ›å®Œæˆå¾Œå°±å¯ä»¥é‹è¡Œä¼ºæœå™¨äº†ï¼š\nnode dist/app.js ç•«é¢ä¸Šæœƒé¡¯ç¤º [server]: Server is running at http://localhost:3000 é€£æ¥åˆ°å¾Œé¢çš„ç¶²å€ï¼Œå°±å¯ä»¥çœ‹åˆ°ä¼ºæœå™¨æ­£å¸¸é‹è¡Œçš„ç•«é¢äº†ã€‚\næŒ‰ä¸‹ Ctrl+c å°±å¯ä»¥åœæ­¢ä¼ºæœå™¨\næŒçºŒç›£çœ‹ TypeScript æª”æ¡ˆ åœ¨é–‹ç™¼æœŸé–“ï¼Œé€šå¸¸æœƒé »ç¹çš„æ”¹è®Šç¶²é å…§å®¹ä¸¦è§€å¯Ÿå…¶çµæœï¼Œå¦‚æœä»¥ä¸Šè¿°æ–¹å¼æ¯ä¸€æ¬¡éƒ½è¦å…ˆç·¨è­¯å†åŸ·è¡Œï¼Œè‚¯å®šæœƒé€ æˆè¨±å¤šä¸æ–¹ä¾¿ï¼Œè€Œä¸”éš¨è‘—æ™‚é–“å¢é•·ç¨‹å¼ä¹Ÿæœƒè¶Šä¾†è¶Šå¤§ï¼Œæ‰€ç·¨è­¯çš„æ™‚é–“ä¹Ÿæœƒç›¸å°å¢åŠ ã€‚\nå¯ä»¥ä½¿ç”¨ nodemon ä¾†è§£æ±ºé€™å€‹å•é¡Œã€‚nodemon æ˜¯ä¸€å€‹å¹«åŠ©é–‹ç™¼è€…çš„å·¥å…·ï¼Œç•¶ç›®éŒ„è£¡çš„æª”æ¡ˆæ”¹è®Šæ™‚ï¼Œå®ƒæœƒè‡ªå‹•åµæ¸¬ä¸¦å¹«åŠ©æˆ‘å€‘é‡é–‹æ‡‰ç”¨ç¨‹å¼ã€‚ä½†æ˜¯é‡é–‹æ‡‰ç”¨ç¨‹å¼æ˜¯ä¸å¤ çš„ï¼Œå› ç‚º TypeScript é‚„æœ‰è¦å…ˆç·¨è­¯çš„å•é¡Œï¼Œæ‰€ä»¥å¯ä»¥æ­é… ts-node ä¸€èµ·ä½¿ç”¨ (å¦‚æœæ²’æœ‰å®‰è£æ­¤å¥—ä»¶ï¼Œåœ¨åŸ·è¡Œ nodemon æ™‚å°±æœƒè¦ä½ å®‰è£)ã€‚\nå®‰è£å…©å€‹æ‰€éœ€è¦çš„å¥—ä»¶ï¼š\nnpm i -D nodemon ts-node æ‰“é–‹ package.json ä¾†ç·¨å¯«è…³æœ¬ï¼š\n\u0026#34;scripts\u0026#34;: { \u0026#34;build\u0026#34;: \u0026#34;tsc\u0026#34;, \u0026#34;dev\u0026#34;: \u0026#34;NODE_ENV=development nodemon ./src/app.ts\u0026#34; } é‹è¡Œè…³æœ¬ï¼š\nnpm run dev ä½ å¯ä»¥å˜—è©¦æ”¹è®Š res.send('Express + TypeScript Server'); è£¡çš„æ–‡å­—ï¼Œå„²å­˜å¾Œé‡æ•´ç¶²é å°±èƒ½çœ‹åˆ°æ”¹è®Šçš„çµæœï¼Œå°±ä¸éœ€è¦é€²è¡Œç·¨è­¯å†åŸ·è¡Œçš„å‹•ä½œäº†ã€‚\nçµè«– ä»¥ä¸Šå°±æ˜¯å»ºç«‹ä¸€å€‹æœ€åŸºæœ¬ Express + TypeScript çš„æ–¹å¼ã€‚\n","permalink":"https://et860525.github.io/posts/typescript-express-initialization/","summary":"\u003cp\u003eé€™ç¯‡æ–‡ç« æœƒç´€éŒ„å¦‚ä½•åœ¨ \u003ca href=\"https://expressjs.com/\"\u003eExpress\u003c/a\u003e å°ˆæ¡ˆè£¡è¨­å®š \u003ca href=\"https://www.typescriptlang.org/\"\u003eTypeScript\u003c/a\u003eã€‚\u003c/p\u003e\n\u003cp\u003eå…ˆæ±ºæ¢ä»¶ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå®‰è£ \u003ca href=\"https://nodejs.org/en/\"\u003eNode.js\u003c/a\u003e ( LTS ) åœ¨ä½ çš„é–‹ç™¼ç’°å¢ƒä¸Š\u003c/li\u003e\n\u003cli\u003eåŸºæœ¬çš„ \u003ccode\u003eNode.js\u003c/code\u003e ã€ \u003ccode\u003eExpress\u003c/code\u003e èˆ‡ \u003ccode\u003eTypeScript\u003c/code\u003e çŸ¥è­˜\u003c/li\u003e\n\u003c/ul\u003e","title":"TypeScript: åˆå§‹åŒ– Express å°ˆæ¡ˆ"},{"content":"ç‰¹å¾µ( trait )ï¼Œæ˜¯å®šç¾©ç‰¹å®šå‹åˆ¥èˆ‡å…¶ä»–å‹åˆ¥å…±äº«çš„åŠŸèƒ½ã€‚å¯ä»¥ä½¿ç”¨ç‰¹å¾µç•Œé™ ( trait bounds ) ä¾†æŒ‡å®šæ³›å‹å‹åˆ¥ç‚ºæ“æœ‰ç‰¹å®šè¡Œç‚ºçš„ä»»æ„å‹åˆ¥ã€‚\nç‰¹å¾µé¡ä¼¼æ–¼å…¶ä»–èªè¨€å¸¸ç¨±ä½œä»‹é¢ ( interfaces ) çš„åŠŸèƒ½ï¼Œä½†é‚„æ˜¯æœ‰äº›å·®ç•°ã€‚\nå®šç¾©ç‰¹å¾µ èˆ‰ä¾‹ï¼Œç¾åœ¨æˆ‘å€‘æœ‰å…©å€‹çµæ§‹é«”å„è‡ªæ“æœ‰ä¸åŒç¨®é¡èˆ‡ä¸åŒæ•¸é‡çš„æ–‡å­—ï¼š\nNewsArticleÂ å„²å­˜ç‰¹å®šåœ°é»çš„æ–°èæ•…äº‹ TweetÂ å‰‡æœ‰æœ€å¤š 280 å­—å…ƒçš„å…§å®¹ï¼Œä¸”æœ‰å€‹æ¬„ä½ä¾†åˆ¤æ–·æ˜¯å…¨æ–°çš„æ¨æ–‡ã€è½‰æ¨æˆ–å…¶ä»–æ¨æ–‡çš„å›è¦†ã€‚ æˆ‘å€‘æƒ³è¦å»ºç«‹ä¸€å€‹å¤šåª’é«”è³‡æ–™åº«ï¼Œä¾†é¡¯ç¤ºå¯èƒ½å­˜åœ¨æ–¼ NewsArticleÂ æˆ–Â TweetÂ å¯¦ä¾‹çš„ç¸½çµ ( summary )ã€‚è¦é”æˆé€™å€‹ç›®çš„ï¼Œæˆ‘å€‘æœƒå‘¼å«è©²å¯¦ä¾‹çš„Â summarizeÂ æ–¹æ³•ä¾†ç²å¾—å¯¦ä¾‹è£¡çš„ summaryã€‚\næ–°å»ºç«‹ä¸€å€‹æª”æ¡ˆç‚º src/lib.rsï¼Œä¸¦åœ¨æ­¤ä½¿ç”¨Â traitÂ é—œéµå­—å®šç¾©ä¸€å€‹ Summary ç‰¹å¾µï¼š\npub trait Summary { fn summarize(\u0026amp;self) -\u0026gt; String; } fn summarize(\u0026amp;self) -\u0026gt; String å®£å‘Šæ–¹æ³•ç°½åä¾†æè¿°æœ‰å¯¦ä½œæ­¤ç‰¹å¾µçš„å‹åˆ¥è¡Œç‚º ç‰¹å¾µæœ¬é«”ä¸­å¯ä»¥æœ‰å¤šå€‹æ–¹æ³•ï¼Œæ¯è¡Œæœƒæœ‰ä¸€å€‹æ–¹æ³•ç°½åä¸¦éƒ½ä»¥åˆ†è™Ÿåšçµå°¾ã€‚\næ¯å€‹æœ‰å¯¦ä½œæ­¤ç‰¹å¾µçš„å‹åˆ¥ï¼Œéƒ½å¿…é ˆæä¾›å…¶è‡ªè¨‚è¡Œç‚ºçš„æ–¹æ³•æœ¬é«”ã€‚ç·¨è­¯å™¨æœƒå¼·åˆ¶è¦æ±‚ä»»ä½•æœ‰Â SummaryÂ ç‰¹å¾µçš„å‹åˆ¥éƒ½è¦æœ‰å®šç¾©ç›¸åŒç°½åçš„Â summarizeÂ æ–¹æ³•ã€‚\nå‹åˆ¥å¯¦ä½œç‰¹å¾µ åœ¨ src/lib.rs ä¸­å®šç¾© Summary ç‰¹å¾µå®Œæˆå¾Œï¼Œå°±å¯ä»¥åœ¨è³‡æ–™åº«è£¡å¯¦ä½œå®ƒï¼š\npub trait Summary { fn summarize(\u0026amp;self) -\u0026gt; String; } pub struct NewsArticle { pub headline: String, pub location: String, pub author: String, pub content: String, } impl Summary for NewsArticle { fn summarize(\u0026amp;self) -\u0026gt; String { format!(\u0026#34;{} {} è‘— ({})\u0026#34;, self.headline, self.author, self.location) } } pub struct Tweet { pub username: String, pub content: String, pub reply: bool, pub retweet: bool, } impl Summary for Tweet { fn summarize(\u0026amp;self) -\u0026gt; String { format!(\u0026#34;{}: {}\u0026#34;, self.username, self.content) } } åœ¨Â implÂ ä¹‹å¾Œæˆ‘å€‘åŠ ä¸Šæƒ³è¦å¯¦ä½œçš„ç‰¹å¾µï¼Œç„¶å¾Œä½¿ç”¨ for é—œéµå­—åŠ ä¸Šæƒ³è¦å¯¦ä½œçš„å‹åˆ¥åç¨±ã€‚ä¸¦åœ¨ impl å€å¡Šè£¡å®šç¾©ç‰¹å¾µæ‰€æŒ‡å®šçš„æ–¹æ³•ã€‚\né€™è£¡ä½¿ç”¨çš„ rust_aggregator æ˜¯ä¸€é–‹å§‹ cargo new \u0026lt;name\u0026gt; çš„åå­—ï¼Œæˆ‘å€‘å·²ç¶“åœ¨å‡½å¼åº«è£¡åŠ å…¥å°Â NewsArticleÂ å’ŒÂ TweetÂ å¯¦ä½œÂ SummaryÂ ç‰¹å¾µï¼Œå¦‚æœæ˜¯ crate çš„ä½¿ç”¨è€…åªè¦ç›´æ¥å‘¼å«å³å¯ã€‚å”¯ä¸€çš„ä¸åŒå°±æ˜¯ï¼Œä½¿ç”¨çš„ç‰¹å¾µä¹Ÿå¿…é ˆåŠ å…¥åˆ°ä½œç”¨åŸŸä¸­ã€‚\nä»¥ä¸‹æ˜¯æˆ‘çš„ rust_aggregator å‡½å¼åº«çš„ main.rsï¼š\nuse rust_aggregator::{self, Summary, Tweet}; fn main() { let tweet = Tweet { username: String::from(\u0026#34;horse_ebooks\u0026#34;), content: String::from( \u0026#34;of course, as you probably already know, people\u0026#34;, ), reply: false, retweet: false, }; println!(\u0026#34;1 å‰‡æ–°æ¨æ–‡ï¼š{}\u0026#34;, tweet.summarize()); } æ­¤ç¨‹å¼ç¢¼æœƒå°å‡ºï¼š1 å‰‡æ–°æ¨æ–‡ï¼šhorse_ebooks: of course, as you probably alreadyknow, peopleã€‚\né è¨­å¯¦ä½œ å°‡ç‰¹å¾µå…§çš„ä¸€äº›æ–¹æ³•é å…ˆå®šç¾©å¯¦ä½œï¼Œå°±ä¸ç”¨è¦æ±‚å‹åˆ¥å¯¦ä½œé€™äº›æ–¹æ³•äº†ã€‚å¦‚æœç‰¹å®šå‹åˆ¥æƒ³è¦æ›´æ”¹ç‰¹å¾µå…§æ–¹æ³•çš„å¯¦ä½œï¼Œç›´æ¥å¯«ä¸Šæ–¹æ³•å°±èƒ½è¦†è“‹é è¨­çš„å¯¦ä½œã€‚ä»¥ä¸‹æ˜¯å®šç¾©é è¨­å¯¦ä½œï¼š\npub trait Summary { fn summarize(\u0026amp;self) -\u0026gt; String { String::from(\u0026#34;(é–±è®€æ›´å¤š...)\u0026#34;) } } ç•¶ summarize æ–¹æ³•æ­¤æ™‚æœ‰é è¨­å¯¦ä½œï¼Œå°±ä¸æœƒå¼·åˆ¶è¦æ±‚å‹åˆ¥éœ€è¦è¨­å®šæ­¤æ–¹æ³•ï¼š\nfn main() { let article = NewsArticle { headline: String::from(\u0026#34;Penguins win the Stanley Cup Championship!\u0026#34;), location: String::from(\u0026#34;Pittsburgh, PA, USA\u0026#34;), author: String::from(\u0026#34;Iceburgh\u0026#34;), content: String::from( \u0026#34;The Pittsburgh Penguins once again are the best \\ hockey team in the NHL.\u0026#34;, ), }; println!(\u0026#34;æœ‰æ–°æ–‡ç« ç™¼ä½ˆï¼{}\u0026#34;, article.summarize()); } å¦‚æœ NewsArticle æ²’æœ‰å¯¦ä½œ summarize æ–¹æ³•ï¼Œæ­¤ç¨‹å¼ç¢¼å°±æœƒå°å‡ºÂ æœ‰æ–°æ–‡ç« ç™¼ä½ˆï¼(é–±è®€æ›´å¤š...)ã€‚\nç‰¹å¾µä½œç‚ºåƒæ•¸ ä½¿ç”¨ç‰¹å¾µä¾†å®šç¾©å‡½å¼æ‰€æ¥å—çš„åƒæ•¸ã€‚åœ¨ Summary ç‰¹å¾µå®šç¾©ä¸€å€‹æ–°çš„ notify å‡½å¼ï¼Œå®ƒæœƒä½¿ç”¨è‡ªå·±çš„åƒæ•¸ item ä¾†å‘¼å« summarize æ–¹æ³•ï¼Œæ‰€ä»¥æ­¤åƒæ•¸çš„å‹åˆ¥æœƒé æœŸæœ‰ Summary ç‰¹å¾µã€‚\npub fn notify(item: \u0026amp;impl Summary) { println!(\u0026#34;é ­æ¢æ–°èï¼{}\u0026#34;, item.summarize()); } itemÂ åƒæ•¸æŒ‡å®šå¯¦éš›å‹åˆ¥ç”¨çš„æ˜¯ impl é—œéµå­—åŠ ä¸Šç‰¹å¾µåç¨±ï¼Œè¡¨ç¤ºæ­¤åƒæ•¸æœƒæ¥å—ä»»ä½•æœ‰å¯¦ä½œæŒ‡å®šç‰¹å¾µçš„å‹åˆ¥ ( NewsArticleÂ æˆ–Â Tweet ) ã€‚ä½†å¦‚æœç”¨å…¶ä»–å‹åˆ¥åƒæ˜¯Â StringÂ æˆ–Â i32Â ä¾†å‘¼å«æ­¤ç¨‹å¼ç¢¼å‰‡æœƒç„¡æ³•ç·¨è­¯ï¼Œå› ç‚ºé‚£äº›å‹åˆ¥æ²’æœ‰å¯¦ä½œÂ Summaryã€‚\né€™èƒ½è®“å‡½å¼çš„åƒæ•¸åªæ¥å—ç‰¹å®šç‰¹å¾µçš„å‹åˆ¥\nç‰¹å¾µç•Œé™èªæ³• impl TraitÂ æ˜¯ä¸€å€‹æ›´é•·æ ¼å¼çš„èªæ³•ç³–ï¼Œè€Œé€™å€‹æ ¼å¼ç¨±ç‚ºç‰¹å¾µç•Œé™ ( trait bound )ï¼Œå®ƒé•·å¾—åƒï¼š\npub fn notify\u0026lt;T: Summary\u0026gt;(item: \u0026amp;T) { println!(\u0026#34;é ­æ¢æ–°èï¼{}\u0026#34;, item.summarize()); } impl TraitÂ èªæ³•æ¯”è¼ƒæ–¹ä¾¿ï¼Œä¸”åœ¨ç°¡å–®çš„æ¡ˆä¾‹ä¸­å¯ä»¥è®“ç¨‹å¼ç¢¼æ¯”è¼ƒç°¡æ½”ï¼Œè€Œç‰¹å¾µç•Œé™é©åˆå…¶ä»–è¤‡é›œçš„æ¡ˆä¾‹ã€‚\nèˆ‰ä¾‹åƒæ•¸æ˜¯å…©å€‹å¯¦ä½œ Summary åƒæ•¸ï¼Œä½¿ç”¨ impl Traitï¼š\npub fn notify(item1: \u0026amp;impl Summary, item2: \u0026amp;impl Summary) { å¦‚æœå‡½å¼å…è¨± item1 èˆ‡ item2 æ˜¯ä¸åŒå‹åˆ¥ï¼Œå°±å¯ä½¿ç”¨ impl Traitã€‚ä½†å¦‚æœå…©å€‹åƒæ•¸æ˜¯åŒä¸€å‹åˆ¥ï¼Œå°±è¦æ”¹æˆç‰¹å¾µç•Œé™ ( trait bound ) çš„æ–¹å¼ï¼š\npub fn notify\u0026lt;T: Summary\u0026gt;(item1: \u0026amp;T, item2: \u0026amp;T) { é€™æ¨£ item1 èˆ‡ item2 çš„å‹åˆ¥å°±å¿…é ˆè¦ç›¸åŒäº†ã€‚\nä½¿ç”¨ã€Œ+ã€æŒ‡å®šå¤šå€‹ç‰¹å¾µç•Œé™ åœ¨ä¸Šä¸€ç« æ³›å‹æœ‰æåˆ°ç”¨å…©å€‹ç‰¹å¾µçš„å‡½å¼ï¼š\nfn largest\u0026lt;T: PartialOrd + Copy\u0026gt;(list: \u0026amp;[T]) -\u0026gt; T { é€™å…©å€‹ç‰¹å¾µåˆ†åˆ¥ç‚ºï¼š\nPartialOrd åˆ¤æ–·é‚è¼¯ Copy å°‡è®Šæ•¸æŒ‡æ´¾çµ¦å¦ä¸€å€‹è®Šæ•¸ é€™å€‹æ–¹æ³•ä¹Ÿä¸€æ¨£å¯ä»¥ç”¨åœ¨åƒæ•¸è£¡ã€‚å‡è¨­ notify ä¸­çš„ item ä¸åªèƒ½å‘¼å« summarizeÂ æ–¹æ³•ï¼Œé‚„èƒ½é¡¯ç¤ºæ ¼å¼åŒ–è¨Šæ¯çš„è©±ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ +ï¼š\nimpl Trait pub fn notify(item: \u0026amp;(impl Summary + Display)) { ç‰¹å¾µç•Œé™ pub fn notify\u0026lt;T: Summary + Display\u0026gt;(item: \u0026amp;T) ä½¿ç”¨ã€Œwhereã€ä½¿ç‰¹å¾µç•Œé™æ›´æ¸…æ¥š å¦‚æœä»Šå¤©æ¯å€‹æ³›å‹éƒ½æœ‰è‡ªå·±çš„ç‰¹å¾µç•Œé™ï¼Œæœƒé€ æˆå‡½å¼ç°½åé›£ä»¥é–±è®€ï¼š\nfn some_function\u0026lt;T: Display + Clone, U: Clone + Debug\u0026gt;(t: \u0026amp;T, u: \u0026amp;U) -\u0026gt; i32 { ä½¿ç”¨ where è®“ä¸€åˆ‡çœ‹èµ·ä¾†ä¸é‚£éº¼è¤‡é›œï¼š\nfn some_function\u0026lt;T, U\u0026gt;(t: \u0026amp;T, u: \u0026amp;U) -\u0026gt; i32 where { T: Display + Clone, U: Clone + Debug, } å›å‚³æœ‰å¯¦ä½œç‰¹å¾µçš„å‹åˆ¥ åœ¨å›å‚³å‹åˆ¥çš„ä½ç½®ä½¿ç”¨Â impl TraitÂ èªæ³•ï¼Œä¾†å›å‚³æŸå€‹æœ‰å¯¦ä½œç‰¹å¾µçš„å‹åˆ¥ï¼š\nfn returns_summarizable() -\u0026gt; impl Summary { Tweet { username: String::from(\u0026#34;horse_ebooks\u0026#34;), content: String::from( \u0026#34;of course, as you probably already know, people\u0026#34;, ), reply: false, retweet: false, } } ä½†æ˜¯å¦‚æœä½¿ç”¨ impl Trait çš„è©±å°±åªèƒ½å›å‚³å–®ä¸€å‹åˆ¥ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œé›–ç„¶ç¨‹å¼ç¢¼æŒ‡å®šå›å‚³çš„å‹åˆ¥ç‚º impl Summaryï¼Œä½†æ˜¯å°‡ç¨‹å¼ç¢¼å¯«æˆå¯èƒ½æœƒå›å‚³ NewsArticleÂ æˆ–Â Tweet å°±æœƒç„¡æ³•åŸ·è¡Œï¼š\nfn returns_summarizable(switch: bool) -\u0026gt; impl Summary { if switch { NewsArticle { headline: String::from( \u0026#34;Penguins win the Stanley Cup Championship!\u0026#34;, ), location: String::from(\u0026#34;Pittsburgh, PA, USA\u0026#34;), author: String::from(\u0026#34;Iceburgh\u0026#34;), content: String::from( \u0026#34;The Pittsburgh Penguins once again are the best \\ hockey team in the NHL.\u0026#34;, ), } } else { Tweet { username: String::from(\u0026#34;horse_ebooks\u0026#34;), content: String::from( \u0026#34;of course, as you probably already know, people\u0026#34;, ), reply: false, retweet: false, } } } å°æ–¼å¯èƒ½è¿”å›Â NewsArticleÂ æˆ–Â TweetÂ çš„è©±æ˜¯ä¸è¢«å…è¨±çš„ï¼Œå› ç‚ºÂ impl TraitÂ èªæ³•æœƒé™åˆ¶åœ¨ç·¨è­¯å™¨ä¸­æœ€çµ‚æ±ºå®šçš„å‹åˆ¥ã€‚\né€éç‰¹å¾µç•Œé™ä¾†é¸æ“‡æ€§å¯¦ä½œæ–¹æ³• åœ¨æœ‰ä½¿ç”¨æ³›å‹å‹åˆ¥åƒæ•¸Â implÂ å€å¡Šä¸­ä½¿ç”¨ç‰¹å¾µç•Œé™ï¼Œå°±å¯ä»¥æœ‰é¸æ“‡æ€§çš„å¯¦ä½œç‰¹å®šå‹åˆ¥çš„å¯¦ä½œæ–¹æ³•ï¼š\nuse std::fmt::Display; struct Pair\u0026lt;T\u0026gt; { x: T, y: T, } impl\u0026lt;T\u0026gt; Pair\u0026lt;T\u0026gt; { fn new(x: T, y: T) -\u0026gt; Self { Self { x, y } } } impl\u0026lt;T: Display + PartialOrd\u0026gt; Pair\u0026lt;T\u0026gt; { fn cmp_display(\u0026amp;self) { if self.x \u0026gt;= self.y { println!(\u0026#34;æœ€å¤§çš„æ˜¯ x = {}\u0026#34;, self.x); } else { println!(\u0026#34;æœ€å¤§çš„æ˜¯ y = {}\u0026#34;, self.y); } } } ç°¡å–®ä¾†èªªï¼Œç¬¬ä¸€å€‹ impl\u0026lt;T\u0026gt; å› ç‚ºå®ƒæ²’æœ‰ä»»ä½•ç‰¹å¾µï¼Œæ‰€æœ‰å‹åˆ¥çš„ Pair éƒ½å¯ä»¥ä½¿ç”¨é€™å€‹æ–¹æ³•ï¼›ç¬¬äºŒå€‹ impl å‰‡æœ‰é™å®šå‹åˆ¥ï¼Œå¦‚æœå‹åˆ¥çš„ç‰¹å¾µæ˜¯ \u0026lt;T: Display + PartialOrd\u0026gt; é‚£å®ƒå°±å¯ä»¥ä½¿ç”¨ï¼Œå¦‚æœæ²’æœ‰å‰‡ç„¡æ³•ä½¿ç”¨é€™å€‹æ–¹æ³•ã€‚\nè€Œé€™ç¨®æ»¿è¶³ç‰¹å¾µç•Œé™çš„å‹åˆ¥å¯¦ä½œç‰¹å¾µï¼Œå‰‡ç¨±ä¹‹ç‚ºå…¨é¢å¯¦ä½œ ( blanket implementations )ï¼Œé€™è¢«å»£æ³›çš„ä½¿ç”¨åœ¨ Rust æ¨™æº–å‡½å¼ä¸­ã€‚èˆ‰å€‹ä¾‹å­ï¼Œæ¨™æº–å‡½å¼åº«æœƒå°ä»»ä½•æœ‰å¯¦ä½œ Display ç‰¹å¾µçš„å‹åˆ¥å¯¦ä½œ ToStringï¼Œä»¥ä¸‹æ˜¯é¡ä¼¼æ–¼æ¨™æº–å‡½å¼åº«ä¸­çš„ impl å€å¡Šï¼š\nimpl\u0026lt;T: Display\u0026gt; ToString for T { // --çœç•¥-- } æ¨™æº–å‡½å¼åº«æœ‰æ­¤å…¨é¢å¯¦ä½œï¼Œé€™æ¨£å°±èƒ½å°‡æ•´æ•¸èˆ‡å­—å…ƒè½‰ç‚º Stringï¼š\nlet s1 = 3.to_string(); let s2 = \u0026#39;c\u0026#39;.to_string(); çµè«– ä¸Šè¿°æœ‰æåˆ° Traitèˆ‡å…¶ä»–ç¨‹å¼èªè¨€çš„ Interface æœ‰äº›ä¸åŒï¼Œå…¶ä¸­æœ€å¤§çš„ä¸åŒåœ¨æ–¼ï¼šInterface ä¸»è¦æ˜¯æ ¹æ“šç‰¹å®šçš„ object ä¾†è¨­å®šæ¥å£çš„ï¼›Trait å‰‡å¯ä»¥å°ç¾æœ‰çš„å‹åˆ¥ä¾†å¯¦ç¾å¯¦ä½œï¼š\ntrait Hash { fn hash(\u0026amp;self) -\u0026gt; u64; } impl Hash for bool { fn hash(\u0026amp;self) -\u0026gt; u64 { if *self { 0 } else { 1 } } } impl Hash for i64 { fn hash(\u0026amp;self) -\u0026gt; u64 { *self as u64 } } åœ¨ Hash çš„ä½œç”¨åŸŸå…§å°±å¯ä»¥ä½¿ç”¨ true.hash() é€™æ¨£çš„å¯«æ³•ã€‚\nå¼•ç”¨ ç‰¹å¾µï¼šå®šç¾©å…±åŒè¡Œç‚º Traits: Defining Shared Behavior Abstraction without overhead: traits in Rust ","permalink":"https://et860525.github.io/posts/rust-trait/","summary":"\u003cp\u003eç‰¹å¾µ( trait )ï¼Œæ˜¯å®šç¾©ç‰¹å®šå‹åˆ¥èˆ‡å…¶ä»–å‹åˆ¥å…±äº«çš„åŠŸèƒ½ã€‚å¯ä»¥ä½¿ç”¨\u003cstrong\u003eç‰¹å¾µç•Œé™ ( trait bounds )\u003c/strong\u003e ä¾†æŒ‡å®šæ³›å‹å‹åˆ¥ç‚ºæ“æœ‰ç‰¹å®šè¡Œç‚ºçš„ä»»æ„å‹åˆ¥ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eç‰¹å¾µé¡ä¼¼æ–¼å…¶ä»–èªè¨€å¸¸ç¨±ä½œ\u003cstrong\u003eä»‹é¢ ( interfaces )\u003c/strong\u003e çš„åŠŸèƒ½ï¼Œä½†é‚„æ˜¯æœ‰äº›å·®ç•°ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e","title":"Rust: ç‰¹å¾µ( Trait )"},{"content":"æ³›å‹ ( generics )ï¼Œå¯¦éš›å‹åˆ¥æˆ–å±¬æ€§çš„æŠ½è±¡è¡¨ç¤ºã€‚èˆ‰ä¾‹ä¾†èªªï¼ŒString å’Œ i32 é€™å…©å€‹ä¸åŒå‹åˆ¥çš„è³‡æ–™éƒ½å¯ä»¥è¢«å­˜åˆ° Vec çµæ§‹é«”å»ºç«‹çš„å¯¦ä¾‹ä¸­ï¼Œä¸éœ€è¦é‡å°å‹åˆ¥ä¾†åšåˆ†åˆ¥ï¼Œåªè¦ä½¿ç”¨Â Vec\u0026lt;String\u0026gt;Â æˆ–Â Vec\u0026lt;i32\u0026gt;ï¼Œé€™æ˜¯å› ç‚ºÂ VecÂ çµæ§‹é«”ä½¿ç”¨äº†æ³›å‹ã€‚\næ³›å‹å°±æ˜¯Â åƒæ•¸å¤šå‹ ( parametric polymorphism )ï¼Œåœ¨å®šç¾©å‹åˆ¥æˆ–å‡½æ•¸çš„æ™‚å€™ä¸å»æ˜ç¢ºæŒ‡å®šå…·é«”çš„å‹åˆ¥ï¼Œè€Œæ˜¯ä»¥åƒæ•¸çš„å½¢å¼ä¾†å‚³å…¥å‹åˆ¥ï¼Œé€™å¯ä»¥è®“ç¨‹å¼è¨­è¨ˆæ›´ç‚ºå½ˆæ€§ã€‚\nä»¥ä¸‹å…ˆä¾†çœ‹æ³›å‹åœ¨å„å€‹åœ°æ–¹ä¸­å¦‚ä½•å®šç¾©ã€‚\nå‡½å¼ä¸­å®šç¾© ç”¨ä¸€å€‹æ‰¾å‡ºé™£åˆ—æœ€å¤§å…ƒç´ å€¼çš„ç¨‹å¼ä¾†å¯¦ä½œæ³›å‹ï¼Œé¦–å…ˆï¼Œå…ˆä¾†çœ‹å®ƒåŸæœ¬çš„æ¨£å­ï¼š\nfn largest_i32(list: \u0026amp;[i32]) -\u0026gt; i32 { let mut largest = list[0]; for \u0026amp;item in list.iter() { if item \u0026gt; largest { largest = item; } } largest } fn largest_char(list: \u0026amp;[char]) -\u0026gt; char { let mut largest = list[0]; for \u0026amp;item in list.iter() { if item \u0026gt; largest { largest = item; } } largest } fn main() { let int_list = vec![34, 50, 25, 100, 65]; let result = largest_i32(\u0026amp;int_list); println!(\u0026#34;The largest integer number is {}\u0026#34;, result); let char_list = vec![\u0026#39;y\u0026#39;, \u0026#39;m\u0026#39;, \u0026#39;a\u0026#39;, \u0026#39;q\u0026#39;]; let result = largest_char(\u0026amp;char_list); println!(\u0026#34;The largest char is {}\u0026#34;, result); } å…©å€‹ largest_i32ã€largest_charï¼Œå¯ä»¥åˆ†åˆ¥å¾ 32ä½å…ƒçš„æœ‰è™Ÿæ•´æ•¸é™£åˆ—åˆ‡ç‰‡ã€å­—å…ƒé™£åˆ—åˆ‡ç‰‡ä¸­æ‰¾å‡ºæœ€å¤§çš„å…ƒç´ ä¸¦å›å‚³å‡ºä¾†ã€‚åŸºæœ¬ä¸Šå‡½å¼è£¡é¢çš„ç¨‹å¼ç¢¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯å› ç‚ºæˆ‘å€‘è¦è™•ç†ä¸åŒå‹åˆ¥çš„è³‡æ–™æ‰€ä»¥å¯«äº†ä¸‰æ¬¡ï¼Œå¦‚æœè¦é€£ i8ã€i16ã€i64ã€u8ã€u16ã€u32ã€u64ã€f32 ç­‰å‹åˆ¥çš„é™£åˆ—åˆ‡ç‰‡éƒ½å¯«ï¼Œé‚£ä¸å°±è¦å†å¤šå¯«8æ¬¡ï¼Œæ‰€ä»¥ Rust æä¾›æ³›å‹ä¾†è§£æ±ºé€™å€‹å•é¡Œï¼Œä»¥ä¸‹æ˜¯æ”¹ç‚ºæ³›å‹ç¤ºç¯„ï¼š\nfn largest\u0026lt;T\u0026gt;(list: \u0026amp;[T]) -\u0026gt; T { let mut largest = list[0]; for \u0026amp;item in list.iter() { if item \u0026gt; largest { largest = item; } } largest } fn main() { let int_list = vec![34, 50, 25, 100, 65]; let result = largest(\u0026amp;int_list); println!(\u0026#34;The largest integer number is {}\u0026#34;, result); let char_list = vec![\u0026#39;y\u0026#39;, \u0026#39;m\u0026#39;, \u0026#39;a\u0026#39;, \u0026#39;q\u0026#39;]; let result = largest(\u0026amp;char_list); println!(\u0026#34;The largest char is {}\u0026#34;, result); } åœ¨å‘¼å« largest\u0026lt;T\u0026gt; å‡½å¼æ™‚ï¼Œç·¨è­¯å™¨æœƒåœ¨ç·¨è­¯éšæ®µæ™‚è‡ªå‹•åˆ¤æ–·æ³›å‹çš„ç¬¬ä¸€å€‹åƒæ•¸å‹åˆ¥ï¼Œä¾†æ±ºå®š T æœƒæ˜¯ä»€éº¼å‹åˆ¥ã€‚å¦‚æœä¸æƒ³è¦è®“ç·¨è­¯å™¨è‡ªå·±åˆ¤å®šï¼Œé‚£å°±åœ¨å‘¼å«å‡½å¼æ™‚ç›´æ¥æŒ‡å®šæ³›å‹çš„å‹åˆ¥ï¼š\nfn largest\u0026lt;T\u0026gt;(list: \u0026amp;[T]) -\u0026gt; T { // ç•¥... } fn main() { let int_list = vec![34, 50, 25, 100, 65]; let result = largest::\u0026lt;i32\u0026gt;(\u0026amp;int_list); println!(\u0026#34;The largest integer number is {}\u0026#34;, result); let char_list = vec![\u0026#39;y\u0026#39;, \u0026#39;m\u0026#39;, \u0026#39;a\u0026#39;, \u0026#39;q\u0026#39;]; let result = largest::\u0026lt;char\u0026gt;(\u0026amp;char_list); println!(\u0026#34;The largest char is {}\u0026#34;, result); } ä¸ç®¡å¦‚ä½•ï¼Œä¸Šè¿°ç¨‹å¼ç¢¼åŸ·è¡Œéƒ½æœƒå‡ºç¾éŒ¯èª¤ã€‚é€™æ˜¯å› ç‚ºè¦å°‡å€¼é€²è¡Œå¤§æ–¼å°æ–¼çš„åˆ¤å®šä¹‹é¡çš„é‚è¼¯åˆ¤æ–·ï¼Œè©²å€¼å°±å¿…é ˆè¦æœ‰ PartialOrd çš„ç‰¹å¾µ ( trait ) ã€‚ç¶œä¸Šæ‰€çŸ¥ï¼Œæ³›å‹çš„ T å¯ä»¥æ˜¯ä»»ä½•å‹åˆ¥ï¼Œä½†å®ƒä¸ä¸€å®šæœƒæ˜¯ PartialOrd ç‰¹å¾µï¼Œæ‰€ä»¥ç¨‹å¼ç¢¼æ‰æœƒç·¨è­¯å¤±æ•—ã€‚ç‚ºäº†è¦è®“ç·¨è­¯å™¨ç¢ºå®š T è¦æœ‰é€™å€‹ PartialOrd ç‰¹å¾µï¼Œæˆ‘å€‘å¿…é ˆäº‹å…ˆæ˜ç¢ºå®šç¾©ï¼Œå°±åƒå®šç¾©ä¸€èˆ¬å‡½å¼åƒæ•¸çš„å‹åˆ¥ï¼š\nfn largest\u0026lt;T: PartialOrd\u0026gt;(list: \u0026amp;[T]) -\u0026gt; T { // åŠ ä¸Š PartialOrd ç‰¹å¾µ let mut largest = list[0]; for \u0026amp;item in list.iter() { if item \u0026gt; largest { largest = item; } } largest } fn main() { // ç•¥... } å†ç·¨è­¯ä¸€æ¬¡é‚„æ˜¯æœƒæœ‰éŒ¯èª¤ï¼Œé€™æ˜¯å› ç‚ºç¬¬ 2è¡Œæœ‰å°‡é™£åˆ—çš„å…ƒç´ æŒ‡æ´¾çµ¦ largest è®Šæ•¸ï¼Œé€™ç¨® æŠŠè®Šæ•¸æŒ‡æ´¾çµ¦å¦ä¸€å€‹è®Šæ•¸å°±è¡¨ç¤ºé€™å€‹å‹åˆ¥æœ‰ Copy çš„ç‰¹å¾µã€‚æ‰€ä»¥é‚„è¦å†è®“ T çŸ¥é“è©²å‹åˆ¥é‚„æœƒæœ‰ Copy ç‰¹å¾µï¼š\nfn largest\u0026lt;T: PartialOrd + Copy\u0026gt;(list: \u0026amp;[T]) -\u0026gt; T { // å†åŠ ä¸Š Copy ç‰¹å¾µ let mut largest = list[0]; for \u0026amp;item in list.iter() { if item \u0026gt; largest { largest = item; } } largest } fn main() { // ç•¥... } é€™æ¨£ç¨‹å¼å°±å¯ä»¥åŸ·è¡Œäº†ï¼š\nâ¯ cargo run Compiling hello_cargo v0.1.0 (file:///projects//hello_cargo) Finished dev [unoptimized + debuginfo] target(s) in 0.23s Running `target/debug/hello_cargo` The largest integer number is 100 The largest char is y çµæ§‹é«”ä¸­å®šç¾© åœ¨çµæ§‹é«”çš„åç¨±å³é‚ŠåŠ ä¸Š \u0026lt;\u0026gt; èªæ³•ä¾†å®šç¾©æ³›å‹ï¼š\nstruct Point\u0026lt;T\u0026gt; { x: T, y: T } fn main() { let integer = Point { x: 5, y: 10 }; let float = Point { x: 1.0, y: 4.0 }; } ç·¨è­¯å™¨åœ¨ç·¨è­¯æœŸé–“ä¹Ÿæœƒè‡ªå‹•åˆ¤æ–·æ³›å‹ç¬¬ä¸€å€‹æ¥è§¸çš„å€¼ï¼Œä¾†æ±ºå®šå‹åˆ¥ã€‚å› æ­¤ integer çš„æ³›å‹ç‚º i32ï¼›float çš„æ³›å‹ç‚º f64ã€‚\nå¦ä¸€å€‹ä¾‹å­ï¼š\nstruct Point\u0026lt;T\u0026gt; { x: T, y: T } fn main() { let wont_work = Point { x: 5, y: 4.0 }; } ä»¥ä¸Šç¨‹å¼å°±æœƒç™¼ç”ŸéŒ¯èª¤ï¼Œå› ç‚ºæ³›å‹ç¬¬ä¸€å€‹æ¥è§¸çš„å€¼æ˜¯ 5 ä¹Ÿå°±æ˜¯ i32 å‹åˆ¥ï¼Œæ­¤æ™‚ Point çš„ x èˆ‡ y çš„å€¼éƒ½ä¸€å®šè¦æ˜¯ i32ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸èƒ½å­˜å– 4.0 é€™å€‹ f64 çš„å‹åˆ¥ã€‚\nè¦è§£æ±ºä¸Šé¢çš„å•é¡Œï¼Œå¯ä»¥ä½¿ç”¨å…©å€‹æ³›å‹åƒæ•¸ï¼š\nstruct Point\u0026lt;T, U\u0026gt; { x: T, y: U } fn main() { let both_integer = Point { x: 5, y: 10 }; let both_float = Point { x: 1.0, y: 4.0 }; let integer_and_float = Point { x: 5, y: 4.0 }; } æšèˆ‰ä¸­å®šç¾© åƒæ˜¯ Option æšèˆ‰ èˆ‡ Result æšèˆ‰ï¼š\nenum Option\u0026lt;T\u0026gt; { Some(T), None } enum Result\u0026lt;T, E\u0026gt; { Ok(T), Err(E) } æ–¹æ³•ä¸­å®šç¾© impl é—œéµå­—å³é‚Šä¹Ÿå¯ä»¥åŠ ä¸Š \u0026lt;\u0026gt; ä¾†å®šç¾©æ³›å‹è¦ä½¿ç”¨çš„åƒæ•¸ï¼š\nstruct Point\u0026lt;T\u0026gt; { x: T, y: T, } impl\u0026lt;T\u0026gt; Point\u0026lt;T\u0026gt; { fn x(\u0026amp;self) -\u0026gt; \u0026amp;T { \u0026amp;self.x } } fn main() { let p = Point { x: 5, y: 10 }; println!(\u0026#34;p.x = {}\u0026#34;, p.x()); } impl ä¹Ÿå¯ä»¥åªé‡å°çš„ç‰¹å®šçš„å‹åˆ¥ï¼Œä¾†å¯¦ä½œé—œè¯å‡½å¼å’Œæ–¹æ³•ï¼š\nstruct Point\u0026lt;T\u0026gt; { x: T, y: T, } impl\u0026lt;T\u0026gt; Point\u0026lt;T\u0026gt; { fn x(\u0026amp;self) -\u0026gt; \u0026amp;T { \u0026amp;self.x } } impl Point\u0026lt;f64\u0026gt; { fn distance_from_origin(\u0026amp;self) -\u0026gt; f64 { (self.x.powi(2) + self.y.powi(2)).sqrt() } } impl Point\u0026lt;i32\u0026gt; { fn distance_from_origin(\u0026amp;self) -\u0026gt; f64 { ((self.x.pow(2) + self.y.pow(2)) as f64).sqrt() } } fn main() { let p = Point { x: 3.0, y: 4.0 }; println!(\u0026#34;distance = {}\u0026#34;, p.distance_from_origin()); let p = Point { x: 5, y: 12 }; println!(\u0026#34;distance = {}\u0026#34;, p.distance_from_origin()); } ä½¿ç”¨æ³›å‹çš„ç¨‹å¼ç¢¼æ•ˆèƒ½ Rust çš„æ³›å‹ä¸æœƒæœ‰ä»»ä½•é¡å¤–çš„é‹ç®—æ•ˆèƒ½çš„è€—æã€‚\nRust åœ¨ç·¨è­¯æ™‚å°ä½¿ç”¨æ³›å‹çš„ç¨‹å¼ç¢¼é€²è¡Œå–®æ…‹åŒ– ( monomorphization ) ã€‚å–®æ…‹åŒ–èƒ½è®“æ³›å‹è½‰æ›æˆç‰¹å®šç¨‹å¼ç¢¼çš„éç¨‹ï¼Œä¸¦åœ¨ç·¨è­¯æ™‚å¡«å…¥å¯¦éš›å‹åˆ¥ã€‚ç°¡å–®ä¾†èªªï¼Œå®ƒæœƒæ ¹æ“šå¡«å…¥çš„å¯¦éš›å‹åˆ¥ï¼Œè‡ªå‹•ç”¢ç”Ÿç›¸æ‡‰çš„ç¨‹å¼ç¢¼ã€‚\nä»¥ä¸‹ç¤ºç¯„æ¨™æº–å‡½å¼åº«çš„æ³›å‹æšèˆ‰Â Option\u0026lt;T\u0026gt; æ˜¯å¦‚ä½•åšåˆ°çš„ï¼š\nlet integer = Some(5); let float = Some(5.0); Rust åœ¨ç·¨è­¯ä¸Šé¢çš„ç¨‹å¼ç¢¼æ™‚ï¼Œå°±æœƒé€²è¡Œå–®æ…‹åŒ–ã€‚ä¸Šé¢çš„å‹æ…‹åˆ†åˆ¥æ˜¯ i32 èˆ‡ f64ï¼Œè€Œç·¨è­¯å™¨æœƒè‡ªå‹•ç”¢ç”Ÿ Option_i32 å’Œ Option_f64 çš„çµæ§‹é«” ( ç·¨è­¯å™¨å¯¦éš›çš„åç¨±èˆ‡é€™é‚Šçš„ä¸åŒ )ï¼š\nenum Option_i32 { Some(i32), None, } enum Option_f64 { Some(f64), None, } fn main() { let integer = Option_i32::Some(5); let float = Option_f64::Some(5.0); } å› æ­¤ï¼Œä½¿ç”¨æ³›å‹çš„æ™‚å€™ï¼Œç¨‹å¼åœ¨åŸ·è¡Œéšæ®µå®Œå…¨ä¸éœ€è¦ä½¿ç”¨é¡å¤–çš„é‹ç®—è³‡æºå»é€²è¡Œå‹åˆ¥çš„æª¢æŸ¥ï¼Œå› ç‚ºé€™äº›å·¥ä½œéƒ½åœ¨ç·¨è­¯æœŸé–“è‡ªå‹•å®Œæˆäº†ã€‚\nçµè«– åœ¨ TypeScript è£¡ä¹Ÿæœ‰æ³›å‹çš„æ©Ÿåˆ¶ï¼Œæ‰€ä»¥å­¸ç¿’èµ·ä¾†ä¸¦ä¸é‚£éº¼åƒåŠ›ã€‚æ³›å‹å°±æ˜¯ç‚ºäº†è§£æ±ºé€™ç¨®ä¸åŒå‹åˆ¥ä½†æ˜¯ç¨‹å¼ç¢¼é‡è¤‡çš„æƒ…æ³ï¼ŒåŠ ä¸Šä¸‹å€‹ç« ç¯€æœƒæåˆ°çš„ç‰¹å¾µ ( trait ) ä¾†é™å®šå“ªç¨®å‹åˆ¥èƒ½ä½¿ç”¨ã€‚\nå¼•ç”¨ æ³›å‹è³‡æ–™å‹åˆ¥ ","permalink":"https://et860525.github.io/posts/rust-generics/","summary":"\u003cp\u003eæ³›å‹ ( generics )ï¼Œå¯¦éš›å‹åˆ¥æˆ–å±¬æ€§çš„æŠ½è±¡è¡¨ç¤ºã€‚èˆ‰ä¾‹ä¾†èªªï¼Œ\u003ccode\u003eString\u003c/code\u003e å’Œ \u003ccode\u003ei32\u003c/code\u003e é€™å…©å€‹ä¸åŒå‹åˆ¥çš„è³‡æ–™éƒ½å¯ä»¥è¢«å­˜åˆ° \u003ca href=\"https://doc.rust-lang.org/std/vec/struct.Vec.html\"\u003eVec çµæ§‹é«”\u003c/a\u003eå»ºç«‹çš„å¯¦ä¾‹ä¸­ï¼Œä¸éœ€è¦é‡å°å‹åˆ¥ä¾†åšåˆ†åˆ¥ï¼Œåªè¦ä½¿ç”¨Â \u003ccode\u003eVec\u0026lt;String\u0026gt;\u003c/code\u003eÂ æˆ–Â \u003ccode\u003eVec\u0026lt;i32\u0026gt;\u003c/code\u003eï¼Œé€™æ˜¯å› ç‚ºÂ \u003ccode\u003eVec\u003c/code\u003eÂ çµæ§‹é«”ä½¿ç”¨äº†æ³›å‹ã€‚\u003c/p\u003e\n\u003cp\u003eæ³›å‹å°±æ˜¯Â \u003cstrong\u003eåƒæ•¸å¤šå‹ ( parametric polymorphism )\u003c/strong\u003eï¼Œåœ¨å®šç¾©å‹åˆ¥æˆ–å‡½æ•¸çš„æ™‚å€™ä¸å»æ˜ç¢ºæŒ‡å®šå…·é«”çš„å‹åˆ¥ï¼Œè€Œæ˜¯ä»¥åƒæ•¸çš„å½¢å¼ä¾†å‚³å…¥å‹åˆ¥ï¼Œé€™å¯ä»¥è®“ç¨‹å¼è¨­è¨ˆæ›´ç‚ºå½ˆæ€§ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥ä¸‹å…ˆä¾†çœ‹æ³›å‹åœ¨å„å€‹åœ°æ–¹ä¸­å¦‚ä½•å®šç¾©ã€‚\u003c/p\u003e","title":"Rust: æ³›å‹( Generics )"},{"content":"åœ¨ä¸€é–‹å§‹æ’°å¯«æ–‡ç« æ™‚ï¼Œæœ¬ä¾†æƒ³ä»¥å¯«æ¯”è¼ƒä¹…çš„ TypeScript ä¾†åšéƒ¨è½æ ¼çš„é–‹é ­æ–‡ç« ï¼Œä½†åœ¨éå¹´å‰æ¥è§¸åˆ° Rust é€™å€‹ç¨‹å¼èªè¨€ï¼Œå°±é †å‹¢æŠŠæœ€è¿‘å­¸åˆ°çš„æ±è¥¿æ”¾ä¸Šä¾†ã€‚ç­‰åˆ°æŠŠåœ¨ TypeScript é‡åˆ°çš„å•é¡Œæ•´ç†ä¸€ä¸‹å†å¯«æˆä¸€å€‹ç³»åˆ—æ”¾ä¸Šä¾†ã€‚\næ‰€æœ‰æ¬Š ( ownership ) æ˜¯ Rust ç”¨ä¾†Â ç®¡ç†ç¨‹å¼è¨˜æ†¶é«”çš„ä¸€ç³»åˆ—è¦å‰‡ï¼Œè®“ Rust ä¸éœ€è¦åƒåœ¾å›æ”¶ ( Garbage collection ) å°±å¯ä»¥ä¿éšœè¨˜æ†¶é«”çš„å®‰å…¨ã€‚\næ‰€æœ‰ç¨‹å¼éƒ½éœ€è¦åœ¨åŸ·è¡Œæ™‚ç®¡ç†å®ƒå€‘ä½¿ç”¨è¨˜æ†¶é«”çš„æ–¹å¼ï¼Œé€™è£¡æœ‰å¸¸è¦‹çš„å…©ç¨®ï¼š\nèªè¨€æœ¬èº«å°±æœ‰åƒåœ¾å›æ”¶æ©Ÿåˆ¶ï¼Œåœ¨ç¨‹å¼åŸ·è¡Œæ™‚ä¸æ–·å°‹æ‰¾ä¸å†ä½¿ç”¨çš„è¨˜æ†¶é«” é–‹ç™¼è€…å¿…é ˆè¦ªè‡ªåˆ†é…å’Œé‡‹æ”¾è¨˜æ†¶é«” è€Œ Rust é¸æ“‡ç¬¬ä¸‰ç¨®æ–¹å¼ï¼šè¨˜æ†¶é«”ç”±æ‰€æœ‰æ¬Šç³»çµ±ç®¡ç†ï¼Œç·¨è­¯å™¨æœƒåœ¨ç·¨è­¯æ™‚åŠ ä¸Šä¸€äº›è¦å‰‡æª¢æŸ¥ï¼Œå¦‚æœæœ‰é•è¦ï¼Œç¨‹å¼å°±ç„¡æ³•ç·¨è­¯ã€‚\næ‰€æœ‰æ¬Šçš„è¦å‰‡å®Œå…¨ä¸æœƒé™ä½åŸ·è¡Œç¨‹å¼çš„é€Ÿåº¦\nå †ç–Š ( Stack ) èˆ‡å †ç© ( Heap ) å †ç–Šèˆ‡å †ç©éƒ½æ˜¯æä¾›ç¨‹å¼ç¢¼åœ¨åŸ·è¡Œæ™‚èƒ½å¤ ä½¿ç”¨çš„è¨˜æ†¶é«”éƒ¨åˆ†ï¼Œä½†çµ„æˆçš„æ–¹å¼ä¸ä¸€æ¨£ã€‚\nå †ç–Š ( Stack ) æœƒæŒ‰ç…§é †åºä¾åºæ’åˆ—å®ƒå€‘ï¼Œä¸¦ä»¥ç›¸åé †åºç§»é™¤ï¼Œé€™ä¹Ÿç¨±ä¹‹ç‚º å¾Œé€²å…ˆå‡º ( last in, first out )ã€‚æ‰€æœ‰åœ¨å †ç–Šä¸Šçš„è³‡æ–™éƒ½å¿…é ˆæ˜¯å·²çŸ¥çš„å›ºå®šå¤§å°ï¼Œåœ¨ç·¨è­¯æœŸé–“å±¬æ–¼æœªçŸ¥æˆ–å¯èƒ½è®Šæ›´å¤§å°çš„è³‡æ–™å‰‡å¿…é ˆå„²å­˜åœ¨æ–¼å †ç©ã€‚\næƒ³åƒå †ç–Šæ˜¯ç›¤å­ï¼Œç•¶åŠ å…¥ç›¤å­æ™‚åªèƒ½ç–Šåœ¨æœ€ä¸Šæ–¹ï¼Œæƒ³è¦æ‹¿èµ°ç›¤å­ä¹Ÿåªèƒ½æ‹¿æœ€ä¸Šé¢çš„ç›¤å­ï¼Œæƒ³å¾ä¸­é–“æˆ–æœ€ä¸‹é¢æ’å…¥æˆ–æ‹¿èµ°ç›¤å­éƒ½ä¸è¡Œã€‚\nå †ç© ( Heap ) ç›¸æ¯”å †ç–Šå°±æ²’æœ‰çµ„ç¹”ï¼Œç•¶è³‡æ–™æ”¾é€²å †ç©æ™‚ï¼Œè¨˜æ†¶é«”åˆ†é…å™¨ ( memory allocator )æœƒæ‰¾åˆ°ä¸€å¡Šå¤ å¤§çš„ç©ºä½ï¼Œä¸¦æ¨™è¨˜å·²å ç”¨ï¼Œç„¶å¾Œå›å‚³ä¸€å€‹æŒ‡æ¨™ ( pointer ) æŒ‡å‘è©²ä½å€ã€‚é€™ä¸€æ•´å€‹éç¨‹ç¨±ä¹‹ç‚º å †ç©ä¸Šåˆ†é… ( allocating on the heap ) æˆ–ç°¡ç¨±ç‚ºåˆ†é…ã€‚ä¹Ÿå› ç‚ºæŒ‡æ¨™æ˜¯å›ºå®šçš„å¤§å°ï¼Œå®ƒå¯ä»¥è¢«å­˜åœ¨å †ç–Šä¸Šï¼Œç•¶éœ€è¦å­˜å–å¯¦éš›çš„è³‡æ–™æ™‚ï¼Œå°±é€éæŒ‡æ¨™å»ç²å¾—å³å¯ã€‚\nè³‡æ–™åœ¨å †ç–Šèˆ‡å †ç©çš„æ¯”è¼ƒï¼š\nå°‡è³‡æ–™æ¨å…¥å †ç–Šæœƒæ¯”å †ç©åˆ†é…é‚„å¿«ï¼Œå› ç‚ºåˆ†é…å™¨ä¸ç”¨å»å°‹æ‰¾ç©ºä½ï¼Œå…¶ä½ç½®æ°¸é åœ¨å †ç–Šçš„æœ€ä¸Šæ–¹ã€‚å †ç©å°±éœ€è¦æ¯”è¼ƒå¤šçš„æ­¥é©Ÿï¼Œåˆ†é…å™¨å¿…é ˆè¦å…ˆæ‰¾åˆ°ä¸€å€‹è¶³å¤ çš„ç©ºä½ï¼Œä¸¦åšç´€éŒ„ç‚ºä¸‹ä¸€æ¬¡åˆ†é…åšæº–å‚™ã€‚\nç²å¾—è³‡æ–™çš„æ™‚é–“ä¹Ÿæ˜¯å †ç–Šæœ€å¿«ï¼Œå› ç‚ºå †ç©å¿…é ˆè¦é€éæŒ‡æ¨™æ‰èƒ½æ‰¾åˆ°ã€‚å¦‚æœè™•ç†å™¨èˆ‡è¨˜æ†¶é«”é–“è·³è½‰çš„æ™‚é–“è¶Šå°‘ï¼Œå‰‡é€Ÿåº¦å°±è¶Šå¿«ã€‚\nç†è§£æ‰€æœ‰æ¬Šä¸»è¦å°±æ˜¯ç‚ºäº†ç®¡ç†å †ç©ã€‚\næ‰€æœ‰æ¬Šè¦å‰‡ Rust ä¸­æ¯å€‹æ•¸å€¼éƒ½æœ‰å€‹æ“æœ‰è€… ( owner )ã€‚ åŒæ™‚é–“åªèƒ½æœ‰ä¸€å€‹æ“æœ‰è€…ã€‚ ç•¶æ“æœ‰è€…é›¢é–‹ä½œç”¨åŸŸ ( scope ) æ™‚ï¼Œæ•¸å€¼å°±æœƒè¢«ä¸Ÿæ£„ã€‚ ä½œç”¨åŸŸ ( scope ) fn main() { { // s åœ¨æ­¤è™•ç„¡æ•ˆï¼Œå› ç‚ºå®ƒé‚„æ²’å®£å‘Š let s = \u0026#34;hello\u0026#34;; // s åœ¨æ­¤é–‹å§‹è¦–ç‚ºæœ‰æ•ˆ // ä½¿ç”¨ s } // æ­¤ä½œç”¨åŸŸçµæŸï¼Œ s ä¸å†æœ‰æ•ˆ } å…©å€‹é‡è¦çš„æ™‚é–“é»ï¼š\nç•¶Â sÂ é€²å…¥ä½œç”¨åŸŸæ™‚ï¼Œå®ƒæ˜¯æœ‰æ•ˆçš„ã€‚ å®ƒæŒçºŒè¢«è¦–ç‚ºæœ‰æ•ˆç›´åˆ°å®ƒé›¢é–‹ä½œç”¨åŸŸç‚ºæ­¢ã€‚ è¨˜æ†¶é«”èˆ‡åˆ†é… è€Œå°æ–¼Â StringÂ å‹åˆ¥ä¾†èªªï¼Œç‚ºäº†è¦èƒ½å¤ æ”¯æ´å¯è®Šæ€§Â (æ”¹è®Šæ–‡å­—é•·åº¦å¤§å°)ï¼Œæˆ‘å€‘éœ€è¦åœ¨å †ç© ( Heap ) ä¸Šåˆ†é…ä¸€å¡Šç·¨è­¯æ™‚æœªçŸ¥å¤§å°çš„è¨˜æ†¶é«”ä¾†å„²å­˜é€™æ¨£çš„å…§å®¹ï¼š\nè¨˜æ†¶é«”åˆ†é…å™¨å¿…é ˆåœ¨åŸ·è¡Œæ™‚è«‹æ±‚è¨˜æ†¶é«” æˆ‘å€‘ä¸å†éœ€è¦é€™å€‹Â StringÂ æ™‚ï¼Œæˆ‘å€‘éœ€è¦ä»¥æŸç¨®æ–¹æ³•å°‡æ­¤è¨˜æ†¶é«”é‚„çµ¦åˆ†é…å™¨ ç¬¬ä¸€éƒ¨åˆ†ï¼Œç•¶å‘¼å«Â String::fromÂ ï¼Œä»–æœƒè«‹æ±‚åˆ†é…ä¸€å¡Šå®ƒéœ€è¦çš„è¨˜æ†¶é«”ï¼Œé€™åœ¨å…¶ä»–ç¨‹å¼èªè¨€éƒ½ä¸€æ¨£ã€‚\nç¬¬äºŒéƒ¨åˆ†ï¼Œåœ¨æ“æœ‰åƒåœ¾å›æ”¶æ©Ÿåˆ¶(garbage collector, GC)Â çš„èªè¨€ä¸­ï¼ŒGC æœƒè¿½è¹¤ä¸¦æ¸…ç†ä¸å†ä½¿ç”¨çš„è¨˜æ†¶é«”ã€‚æ²’æœ‰ GC çš„è©±ï¼Œå°±å¿…é ˆè‡ªå·±å»è­˜åˆ¥å“ªäº›è¨˜æ†¶é«”ä¸å†ä½¿ç”¨ï¼Œä¸¦ä¸”é‡‹æ”¾å®ƒå€‘ã€‚å¦‚æœå¿˜è¨˜é‡‹æ”¾æœƒé€ æˆè¨˜æ†¶é«”çš„æµªè²»ï¼Œå¤ªæ—©é‡‹æ”¾å‰‡æœƒæ‹¿åˆ°ç„¡æ•ˆçš„è®Šæ•¸ï¼Œå¦‚æœé‡‹æ”¾äº†å…©æ¬¡ï¼Œå°±æœƒé€ æˆç¨‹å¼éŒ¯èª¤ã€‚\nRust çš„æ–¹æ³•æ˜¯ï¼Œç•¶è¨˜æ†¶é«”åœ¨æ“æœ‰å®ƒçš„è®Šæ•¸é›¢é–‹ä½œç”¨åŸŸæ™‚å°±æœƒè‡ªå‹•é‡‹æ”¾ï¼š\nfn main() { { let s = String::from(\u0026#34;hello\u0026#34;); // s åœ¨æ­¤é–‹å§‹è¦–ç‚ºæœ‰æ•ˆ // ä½¿ç”¨ s } // æ­¤ä½œç”¨åŸŸçµæŸ // s ä¸å†æœ‰æ•ˆ } ç•¶Â sÂ é›¢é–‹ä½œç”¨åŸŸï¼ŒStringÂ æ‰€éœ€è¦çš„è¨˜æ†¶é«”é‡‹æ”¾å›åˆ†é…å™¨ã€‚ç•¶é›¢é–‹ä½œç”¨åŸŸï¼ŒRust æœƒå¹«æˆ‘å€‘å‘¼å«ä¸€å€‹ç‰¹æ®Šå‡½å¼Â dropÂ ä¾†é‡‹æ”¾è¨˜æ†¶é«”ã€‚\nè®Šæ•¸èˆ‡è³‡æ–™äº’å‹•çš„æ–¹å¼ï¼šç§»å‹•ï¼ˆMoveï¼‰ fn main() { let x = 5; let y = x; } ä¸€èˆ¬ä¾†èªªï¼Œx å–å¾—æ•¸å€¼ 5ï¼Œç„¶å¾Œ copy ä¸€ä»½çµ¦ yã€‚\nä½†åœ¨ String çš„ç‰ˆæœ¬ï¼Œå°±ä¸åªæ˜¯æ‹·è²é‚£éº¼ç°¡å–®\nfn main() { let s1 = String::from(\u0026#34;hello\u0026#34;); let s2 = s1; println!(\u0026#34;{}, world!\u0026#34;, s1); } é€™å°±è¦å…ˆäº†è§£ String çš„æ¶æ§‹ï¼Œä¸€å€‹ String ç”±ä¸‰å€‹éƒ¨åˆ†çµ„æˆï¼š\næŒ‡å‘å„²å­˜å­—ä¸²å…§å®¹è¨˜æ†¶é«”çš„æŒ‡æ¨™ å®ƒçš„é•·åº¦ï¼šæ˜¯ String å…§å®¹åœ¨è¨˜æ†¶é«”ä»¥ä½å…ƒçµ„ç‚ºå–®ä½æ‰€ä½”ç”¨çš„å¤§å° å®ƒçš„å®¹é‡ï¼šæ˜¯ StringÂ å¾åˆ†é…å™¨ä»¥ä½å…ƒçµ„ç‚ºå–®ä½å–å¾—çš„ç¸½è¨˜æ†¶é«”é‡ æ‰€ä»¥å°‡Â s1Â è³¦å€¼çµ¦Â s2ï¼ŒStringÂ çš„è³‡æ–™æœƒè¢«æ‹·è²ï¼Œä¸éé€™è£¡æŒ‡çš„æ˜¯æ‹·è²å †ç–Šä¸Šçš„æŒ‡æ¨™ã€é•·åº¦å’Œå®¹é‡ã€‚\nå¦‚æœ Rust ç›´æ¥æ‹·è²å †ç©çš„è³‡æ–™ï¼Œs2 = s1Â çš„å‹•ä½œèŠ±è²»æœƒè®Šå¾—éå¸¸æ˜‚è²´ï¼Œç•¶å †ç©ä¸Šçš„è³‡æ–™éå¸¸é¾å¤§æ™‚ï¼Œæ˜¯ååˆ†å½±éŸ¿æ•ˆèƒ½çš„ã€‚\nå…ˆå‰æœ‰æåˆ°ç•¶è®Šæ•¸é›¢é–‹ä½œç”¨åŸŸæ™‚ï¼ŒRust æœƒè‡ªå‹•å‘¼å« drop å‡½å¼ä¾†æ¸…ç†å †ç©ä¸Šçš„è³‡æ–™ã€‚è€Œç•¶ s2 èˆ‡ s1 é›¢é–‹ä½œç”¨åŸŸæ™‚ï¼Œå®ƒå€‘éƒ½æœƒå˜—è©¦é‡‹æ”¾ç›¸åŒçš„è¨˜æ†¶é«”ï¼Œé€™è¢«ç¨±ç‚º é›™é‡é‡‹æ”¾ ( double free )ï¼Œé‡‹æ”¾è¨˜æ†¶é«”å…©æ¬¡å¯èƒ½æœƒå°è‡´è¨˜æ†¶é«”æå£ï¼Œé€²è€Œé€ æˆå®‰å…¨æ¼æ´ã€‚\næ‰€ä»¥ç‚ºäº†ä¿éšœè¨˜æ†¶é«”å®‰å…¨ï¼Œlet s2 = s1; å¾Œ s1 å°±ä¸å†æœ‰æ•ˆï¼Œæ‰€ä»¥åœ¨ s2 å»ºç«‹å¾Œå†ä½¿ç”¨ s1 å°±æœƒç„¡æ³•åŸ·è¡Œï¼š\nlet s1 = String::from(\u0026#34;hello\u0026#34;); let s2 = s1; println!(\u0026#34;{}, world!\u0026#34;, s1); Rust æœƒè·³å‡ºéŒ¯èª¤é˜²æ­¢ä½ åŸ·è¡Œï¼š\n$ cargo run Compiling ownership v0.1.0 (file:///projects/ownership) error[E0382]: borrow of moved value: `s1` --\u0026gt; src/main.rs:5:28 | 2 | let s1 = String::from(\u0026#34;hello\u0026#34;); | -- move occurs because `s1` has type `String`, which does not implement the `Copy` trait 3 | let s2 = s1; | -- value moved here 4 | 5 | println!(\u0026#34;{}, world!\u0026#34;, s1); | ^^ value borrowed here after move | = note: this error originates in the macro `$crate::format_args_nl` which comes from the expansion of the macro `println` (in Nightly builds, run with -Z macro-backtrace for more info) For more information about this error, try `rustc --explain E0382`. error: could not compile `ownership` due to previous error è®Šæ•¸èˆ‡è³‡æ–™äº’å‹•çš„æ–¹å¼ï¼šå…‹éš†ï¼ˆCloneï¼‰ å¦‚æœéœ€è¦æ·±æ‹·è² ( deep copy )çš„è©±ï¼Œä½¿ç”¨ cloneï¼š\nfn main() { let s1 = String::from(\u0026#34;hello\u0026#34;); let s2 = s1.clone(); println!(\u0026#34;s1 = {}, s2 = {}\u0026#34;, s1, s2); } é€™æ¨£ s1 èˆ‡ s2 éƒ½èƒ½ä½¿ç”¨ã€‚\nåªåœ¨å †ç–Šä¸Šçš„è³‡æ–™ï¼šæ‹·è²ï¼ˆCopyï¼‰ fn main() { let x = 5; let y = x; println!(\u0026#34;x = {}, y = {}\u0026#34;, x, y); } Q: é‚£ç‚ºä»€éº¼ä¸Šé¢çš„ç¨‹å¼ç¢¼æœƒæˆç«‹ï¼Ÿæ²’æœ‰å‘¼å«Â cloneï¼Œä½†Â xÂ å»ä»æ˜¯æœ‰æ•ˆçš„ï¼Œæ²’æœ‰ç§»å‹•åˆ°Â yã€‚\nA: å› ç‚ºåƒæ•´æ•¸é€™æ¨£çš„å‹åˆ¥åœ¨ç·¨è­¯æ™‚æ˜¯å·²çŸ¥å¤§å°ï¼Œæ‰€ä»¥åªæœƒå­˜åœ¨åœ¨å †ç–Šä¸Šã€‚\nRust æœ‰å€‹ç‰¹åˆ¥çš„æ¨™è¨˜å«åšÂ CopyÂ ç‰¹å¾µï¼ˆtraitï¼‰å¯ä»¥ç”¨åœ¨æ¨™è¨˜åƒæ•´æ•¸é€™æ¨£å­˜åœ¨å †ç–Šä¸Šçš„å‹åˆ¥ã€‚å¦‚æœä¸€å€‹å‹åˆ¥æœ‰å¯¦ä½œ ( implement ) DropÂ ç‰¹å¾µçš„è©±ï¼ŒRust ä¸æœƒå…è¨±æˆ‘å€‘è®“æ­¤å‹åˆ¥æ“æœ‰Â CopyÂ ç‰¹å¾µã€‚\nå“ªäº›å‹åˆ¥æœ‰å¯¦ä½œÂ CopyÂ ç‰¹å¾µå‘¢ï¼ŸåŸºæœ¬åŸå‰‡æ˜¯ä»»ä½•ç°¡å–®åœ°ç´”é‡æ•¸å€¼éƒ½å¯ä»¥å¯¦ä½œÂ Copy\næ‰€æœ‰æ•´æ•¸å‹åˆ¥åƒæ˜¯Â u32ã€‚ å¸ƒæ—å‹åˆ¥Â boolï¼Œå®ƒåªæœ‰æ•¸å€¼Â trueÂ èˆ‡Â falseã€‚ æ‰€æœ‰æµ®é»æ•¸å‹åˆ¥åƒæ˜¯Â f64ã€‚ å­—å…ƒå‹åˆ¥Â charã€‚ å…ƒçµ„ï¼Œä¸éåŒ…å«çš„å‹åˆ¥ä¹Ÿéƒ½è¦æœ‰å¯¦ä½œÂ CopyÂ æ‰è¡Œã€‚æ¯”å¦‚Â (i32, i32)Â å°±æœ‰å¯¦ä½œÂ Copyï¼Œä½†Â (i32, String)Â å‰‡ç„¡ã€‚ æ‰€æœ‰æ¬Šèˆ‡å‡½å¼ å‚³éæ•¸å€¼çµ¦å‡½å¼çš„æ–¹å¼å’Œè³¦å€¼çµ¦è®Šæ•¸æ˜¯é¡ä¼¼çš„ã€‚\nfn main() { let s = String::from(\u0026#34;hello\u0026#34;); // s é€²å…¥ä½œç”¨åŸŸ takes_ownership(s); // s çš„å€¼é€²å…¥å‡½å¼ // æ‰€ä»¥ s ä¹Ÿåœ¨æ­¤ç„¡æ•ˆ let x = 5; // x é€²å…¥ä½œç”¨åŸŸ makes_copy(x); // x æœ¬è©²ç§»å‹•é€²å‡½å¼è£¡ // ä½† i32 æœ‰ Copyï¼Œæ‰€ä»¥ x å¯ç¹¼çºŒä½¿ç”¨ } fn takes_ownership(some_string: String) { // some_string é€²å…¥ä½œç”¨åŸŸ println!(\u0026#34;{}\u0026#34;, some_string); } // some_string åœ¨æ­¤é›¢é–‹ä½œç”¨åŸŸä¸¦å‘¼å« `drop` // ä½”ç”¨çš„è¨˜æ†¶é«”è¢«é‡‹æ”¾ fn makes_copy(some_integer: i32) { // some_integer é€²å…¥ä½œç”¨åŸŸ println!(\u0026#34;{}\u0026#34;, some_integer); } // some_integer åœ¨æ­¤é›¢é–‹ä½œç”¨åŸŸï¼Œæ²’æœ‰ä»»ä½•å‹•ä½œç™¼ç”Ÿ å¦‚æœå‘¼å«Â takes_ownershipÂ å¾Œä½¿ç”¨Â sï¼ŒRust æœƒæ‹‹å‡ºç·¨è­¯æ™‚æœŸéŒ¯èª¤ã€‚\nå›å‚³å€¼èˆ‡ä½œç”¨åŸŸ è®Šæ•¸çš„æ‰€æœ‰æ¬Šæ¯æ¬¡éƒ½æœƒéµç…§ç›¸åŒçš„æ¨¡å¼ï¼Œåªè¦è³¦å€¼çµ¦å…¶ä»–è®Šæ•¸å°±æœƒç§»å‹•ã€‚ç•¶æœ‰å †ç©çš„è®Šæ•¸é›¢é–‹ä½œç”¨åŸŸï¼Œè©²å€¼å°±æœƒè¢« drop æ¸…é™¤ï¼Œé™¤éè³‡æ–™çš„æ‰€æœ‰æ¬Šè¢«è½‰ç§»åˆ°å…¶ä»–è®Šæ•¸ã€‚\nä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä¾†å›å‚³åƒæ•¸çš„æ‰€æœ‰å€¼ï¼š\nfn main() { let s1 = String::from(\u0026#34;hello\u0026#34;); let (s2, len) = calculate_length(s1); // s1 ç§»å…¥ calculate_length // å°‡æ‰€æœ‰æ¬Šé€éå›å‚³çµ¦ s2 println!(\u0026#34;\u0026#39;{}\u0026#39; çš„é•·åº¦ç‚º {}ã€‚\u0026#34;, s2, len); } fn calculate_length(s: String) -\u0026gt; (String, usize) { let length = s.len(); // len() å›å‚³ String çš„é•·åº¦ (s, length) } ä»¥ä¸Šæ˜¯æ­£ç¢ºçš„åšæ³•ï¼Œä½†å¦‚æœè¦é‡è¤‡ä½¿ç”¨é€™å€‹å€¼ï¼Œæ¯ä¸€æ¬¡éƒ½è¦å‚³é€²å‚³å‡ºå°±å¾ˆéº»ç…©ã€‚æ‰€ä»¥ Rust é‚„æœ‰æä¾›ä¸€å€‹åœ¨ä¸ç§»è½‰æ‰€æœ‰æ¬Šçš„æƒ…æ³ä¸‹ä½¿ç”¨æ•¸å€¼ï¼Œç¨±ç‚º å¼•ç”¨ ( references )ã€‚\nå¼•ç”¨èˆ‡å€Ÿç”¨ å¼•ç”¨ ( references )Â å°±åƒæ˜¯æŒ‡å‘æŸå€‹åœ°å€çš„æŒ‡æ¨™ï¼Œæˆ‘å€‘å¯ä»¥è¿½è¹¤å­˜å–åˆ°è©²è™•å„²å­˜çš„è³‡è¨Šï¼Œè€Œè®“è©²åœ°å€è¢«å…¶ä»–è®Šæ•¸æ‰€æ“æœ‰ï¼Œèˆ‡æŒ‡æ¨™ä¸åŒçš„æ˜¯ï¼Œå¼•ç”¨ä¿è­‰æ‰€æŒ‡å‘çš„ç‰¹å®šå‹åˆ¥çš„æ•¸å€¼ä¸€å®šæ˜¯æœ‰æ•ˆçš„ã€‚\nfn main() { let s1 = String::from(\u0026#34;hello\u0026#34;); let len = calculate_length(\u0026amp;s1); println!(\u0026#34;\u0026#39;{}\u0026#39; çš„é•·åº¦ç‚º {}ã€‚\u0026#34;, s1, len); } fn calculate_length(s: \u0026amp;String) -\u0026gt; usize { s.len() } \u0026amp;s1Â èªæ³•è®“æˆ‘å€‘å¯ä»¥å»ºç«‹ä¸€å€‹æŒ‡å‘Â s1Â æ•¸å€¼çš„å¼•ç”¨ï¼Œä½†ä¸æœƒæ“æœ‰å®ƒã€‚ä¹Ÿå› ç‚ºå®ƒæ²’æœ‰æ‰€æœ‰æ¬Šï¼Œå®ƒæ‰€æŒ‡å‘çš„è³‡æ–™åœ¨å¼•ç”¨ä¸å†ä½¿ç”¨å¾Œä¸¦ä¸æœƒè¢«ä¸Ÿæ£„ã€‚\nå»ºç«‹å¼•ç”¨é€™æ¨£çš„å‹•ä½œå«åšå€Ÿç”¨ï¼ˆborrowingï¼‰ã€‚å°±åƒç¾å¯¦ä¸–ç•Œä¸€æ¨£ï¼Œå¦‚æœæœ‰äººæ“æœ‰ä¸€å€‹æ±è¥¿ï¼Œä»–å¯ä»¥å€Ÿç”¨çµ¦ä½ ã€‚ç•¶ä½ ä½¿ç”¨å®Œå¾Œï¼Œä½ å°±é‚„çµ¦ä»–ï¼Œä½ ä¸¦ä¸æ“æœ‰å®ƒã€‚\nä»¥ä¸‹ç¨‹å¼ç¢¼èƒ½ä¸èƒ½åŸ·è¡Œï¼Ÿ\nfn main() { let s = String::from(\u0026#34;hello\u0026#34;); change(\u0026amp;s); } fn change(some_string: \u0026amp;String) { some_string.push_str(\u0026#34;, world\u0026#34;); } ç­”æ¡ˆæ˜¯ä¸è¡Œï¼Œå› ç‚ºå®ƒåªæ˜¯å€Ÿç”¨ï¼Œæ‰€ä»¥ä¸èƒ½æ”¹è®Šå¼•ç”¨çš„å€¼ã€‚\nå¯è®Šå¼•ç”¨ å¦‚æœè¦è®“ä¸Šæ–¹çš„ç¨‹å¼ç¢¼ï¼Œæ”¹è®Šå¼•ç”¨çš„å€¼ï¼š\nfn main() { let mut s = String::from(\u0026#34;hello\u0026#34;); change(\u0026amp;mut s); } fn change(some_string: \u0026amp;mut String) { some_string.push_str(\u0026#34;, world\u0026#34;); } å…ˆå°‡ s åŠ å…¥ mut è®“ä»–èƒ½è¢«æ”¹è®Š changeÂ å‡½å¼çš„åœ°æ–¹å»ºç«‹äº†ä¸€å€‹å¯è®Šå¼•ç”¨Â \u0026amp;mut s change å‡½å¼çš„æ–°ç°½ç« ç‚º some_string: \u0026amp;mut String ä¾†æ¥æ”¶é€™å€‹å¯è®Šå¼•ç”¨ å¯è®Šå¼•ç”¨æœ‰ä¸€å€‹å¤§é™åˆ¶ï¼šå°ç›¸åŒçš„è®Šæ•¸å¯è®Šå¼•ç”¨åªèƒ½æœ‰ä¸€å€‹ã€‚å¦‚æœå˜—è©¦å»ºç«‹å…©å€‹å¯è®Šå¼•ç”¨å°±æœƒå¤±æ•—ï¼š\nfn main() { let mut s = String::from(\u0026#34;hello\u0026#34;); let r1 = \u0026amp;mut s; let r2 = \u0026amp;mut s; println!(\u0026#34;{}, {}\u0026#34;, r1, r2); } éŒ¯èª¤è³‡è¨Šï¼š\n$ cargo run Compiling ownership v0.1.0 (file:///projects/ownership) error[E0499]: cannot borrow `s` as mutable more than once at a time --\u0026gt; src/main.rs:5:14 | 4 | let r1 = \u0026amp;mut s; | ------ first mutable borrow occurs here 5 | let r2 = \u0026amp;mut s; | ^^^^^^ second mutable borrow occurs here 6 | 7 | println!(\u0026#34;{}, {}\u0026#34;, r1, r2); | -- first borrow later used here For more information about this error, try `rustc --explain E0499`. error: could not compile `ownership` due to previous error é€™é …é™åˆ¶çš„å¥½è™•æ˜¯ Rust å¯ä»¥åœ¨ç·¨è­¯æ™‚æœŸå°±é˜²æ­¢è³‡æ–™ç«¶çˆ­ ( data races )ã€‚å®ƒæœƒç”±ä»¥ä¸‹ä¸‰ç¨®è¡Œç‚ºå¼•ç™¼ï¼š\nåŒæ™‚æœ‰å…©å€‹ä»¥ä¸Šçš„æŒ‡æ¨™å­˜å–åŒå€‹è³‡æ–™ã€‚ è‡³å°‘æœ‰ä¸€å€‹æŒ‡æ¨™åœ¨å¯«å…¥è³‡æ–™ã€‚ æ²’æœ‰é‡å°è³‡æ–™çš„åŒæ­¥å­˜å–æ©Ÿåˆ¶ã€‚ è³‡æ–™ç«¶çˆ­æœƒé€ æˆæœªå®šç¾©è¡Œç‚º ( undefined behavior )ï¼Œè€Œä¸”åœ¨åŸ·è¡Œæ™‚ä½ é€šå¸¸æ˜¯å¾ˆé›£è¨ºæ–·ä¸¦ä¿®æ­£çš„ï¼Œè€Œ Rust èƒ½é˜»æ­¢é€™æ¨£çš„å•é¡Œï¼Œå®ƒä¸æœƒè®“æœ‰è³‡æ–™ç«¶çˆ­çš„ç¨‹å¼ç¢¼ç·¨è­¯ã€‚\nç°¡å–®ä¾†èªªï¼Œä¸è¦åŒæ™‚æ“æœ‰åŒä¸€å€‹å¼•ç”¨å°±å¯åŸ·è¡Œï¼š\nfn main() { let mut s = String::from(\u0026#34;hello\u0026#34;); { let r1 = \u0026amp;mut s; } // r1 é›¢é–‹ä½œç”¨åŸŸï¼Œæ‰€ä»¥å»ºç«‹æ–°çš„å¼•ç”¨ä¹Ÿä¸æœƒæœ‰å•é¡Œ let r2 = \u0026amp;mut s; } å¯è®Šå¼•ç”¨å’Œä¸å¯è®Šå¼•ç”¨ï¼Œä¸èƒ½åŒæ™‚ä½¿ç”¨ï¼š\nfn main() { let mut s = String::from(\u0026#34;hello\u0026#34;); let r1 = \u0026amp;s; // æ²’å•é¡Œ let r2 = \u0026amp;s; // æ²’å•é¡Œ let r3 = \u0026amp;mut s; // æœ‰å•é¡Œï¼ println!(\u0026#34;{}, {}, and {}\u0026#34;, r1, r2, r3); } é€™æ˜¯å› ç‚ºï¼Œä¸å¯è®Šå¼•ç”¨çš„ä½¿ç”¨è€…ä¸å¸Œæœ›æœ‰äººæ”¹è®Šäº†å€¼ï¼Œä¸¦é€ æˆéŒ¯èª¤ã€‚ä¸éå¤šå€‹ä¸å¯è®Šå¼•ç”¨æ˜¯æ²’å•é¡Œçš„ï¼Œå› ç‚ºå¤§å®¶éƒ½ä¸èƒ½è®Šæ›´å€¼ã€‚\nå¼•ç”¨çš„ä½œç”¨åŸŸå§‹æ–¼å®ƒè¢«å®£å‘Šçš„åœ°æ–¹ï¼Œä¸€ç›´åˆ°å®ƒæœ€å¾Œä¸€æ¬¡å¼•ç”¨è¢«ä½¿ç”¨ç‚ºæ­¢ï¼š\nfn main() { let mut s = String::from(\u0026#34;hello\u0026#34;); let r1 = \u0026amp;s; // æ²’å•é¡Œ let r2 = \u0026amp;s; // æ²’å•é¡Œ println!(\u0026#34;{} and {}\u0026#34;, r1, r2); // è®Šæ•¸ r1 å’Œ r2 å°‡ä¸å†ä½¿ç”¨ let r3 = \u0026amp;mut s; // æ²’å•é¡Œ println!(\u0026#34;{}\u0026#34;, r3); } è¿·é€”å¼•ç”¨ ( Dangling references ) æœ‰æŒ‡æ¨™çš„ç¨‹å¼èªè¨€ï¼Œå°±æœƒä¸å°å¿ƒç”¢ç”Ÿ è¿·é€”æŒ‡æ¨™ ( dangling pointer )ã€‚ç•¶è³‡æºå·²ç¶“è¢«é‡‹æ”¾ä½†æŒ‡æ¨™å»é‚„ç•™è‘—ï¼Œé€™æ¨£çš„æŒ‡æ¨™æŒ‡å‘çš„åœ°æ–¹å¾ˆå¯èƒ½å°±å·²ç¶“è¢«åˆ¥äººæ‰€æœ‰äº†ã€‚åœ¨ Rust ä¸­ç·¨è­¯å™¨æœƒä¿è­‰å¼•ç”¨çµ•ä¸æœƒæ˜¯è¿·é€”å¼•ç”¨ã€‚\nfn main() { let reference_to_nothing = dangle(); } fn dangle() -\u0026gt; \u0026amp;String { // å›å‚³ String çš„è¿·é€”å¼•ç”¨ let s = String::from(\u0026#34;hello\u0026#34;); // s æ˜¯å€‹æ–° String \u0026amp;s // æˆ‘å€‘å›å‚³ String s çš„å¼•ç”¨ } // s åœ¨æ­¤æœƒé›¢é–‹ä½œç”¨åŸŸä¸¦é‡‹æ”¾ï¼Œå®ƒçš„è¨˜æ†¶é«”å°±ä¸è¦‹äº†ã€‚ // å±éšªï¼ s æ˜¯åœ¨ dangle è£¡é¢ç”¢ç”Ÿçš„ï¼Œç•¶ dangle çµæŸ s æœƒè¢«é‡‹æ”¾ã€‚å¦‚æœå˜—è©¦å›å‚³ sï¼Œé€™å€‹å¼•ç”¨æœƒæŒ‡å‘ä¸€å€‹ç„¡æ•ˆçš„ Stringï¼Œæ‰€ä»¥ Rust ä¸æœƒè®“å®ƒç™¼ç”Ÿã€‚\nè®“ä»–å›å‚³çš„å€¼ä¸æ˜¯å¼•ç”¨å°±å¯ä»¥äº†ï¼Œé€™é‚Šç›´æ¥å›å‚³ Stringå°±å¥½ï¼š\nfn main() { let string = no_dangle(); } fn no_dangle() -\u0026gt; String { let s = String::from(\u0026#34;hello\u0026#34;); s } åˆ‡ç‰‡ (Slice) åˆ‡ç‰‡ (Slice) å¯ä»¥å¼•ç”¨ä¸€ä¸²é›†åˆçš„å…ƒç´ åˆ—ï¼Œä¸¦éå¼•ç”¨æ•´å€‹é›†åˆã€‚åˆ‡ç‰‡ä¹Ÿæ˜¯ä¸€ç¨®å¼•ç”¨ï¼Œæ‰€ä»¥å®ƒæ²’æœ‰æ‰€æœ‰æ¬Šã€‚\nå¯«ä¸€å€‹å‡½å¼æ¥æ”¶ä¸€ä¸²ç”¨ç©ºæ ¼åˆ†é–‹å–®å­—çš„å­—ä¸²ï¼Œå¦‚ï¼šHello worldã€Good jobï¼Œä¸¦å›å‚³ç¬¬ä¸€å€‹æ‰¾åˆ°çš„å–®å­—ï¼›å¦‚æœæ²’æœ‰æ‰¾åˆ°ä»»ä½•ç©ºæ ¼ï¼Œå°±ä»£è¡¨æ•´å€‹å­—ä¸²å°±æ˜¯ä¸€å€‹å–®å­—ï¼Œä¸¦å›å‚³æ•´å€‹å­—ä¸²ã€‚\nfn first_word(s: \u0026amp;String) -\u0026gt; usize { let bytes = s.as_bytes(); for (i, \u0026amp;item) in bytes.iter().enumerate() { if item == b\u0026#39; \u0026#39; { return i; } } s.len() } fn main() { let mut s = String::from(\u0026#34;hello world\u0026#34;); let word = first_word(\u0026amp;s); // word å–å¾—æ•¸å€¼ 5 s.clear(); // é€™æœƒæ¸…ç©º Stringï¼Œé€™å°±ç­‰æ–¼ \u0026#34;\u0026#34; // word ä»ç„¶æ˜¯æ•¸å€¼ 5 ï¼Œä½†æ˜¯æˆ‘å€‘å·²ç¶“æ²’æœ‰ç›¸ç­‰æ„ç¾©çš„å­—ä¸²äº† // æ“æœ‰ 5 çš„è®Šæ•¸ word ç¾åœ¨å®Œå…¨æ²’æ„ç¾©ï¼ } let bytes = s.as_bytes();ï¼šå°‡ String è½‰æ›æˆä¸€å€‹ä½å…ƒçµ„é™£åˆ— for (i, \u0026amp;item) in bytes.iter().enumerate()ï¼šä½¿ç”¨ iter æ–¹æ³•å°ä½å…ƒå»ºç«‹ä¸€å€‹ç–Šä»£å™¨ (iterator) iter()ï¼šæ˜¯ä¸€å€‹å›å‚³é›†åˆä¸­çš„æ¯å€‹å…ƒç´ æ–¹æ³• enumerate()ï¼šå›å‚³çš„å…ƒçµ„ä¸­ç¬¬ä¸€å€‹æ˜¯ç´¢å¼•(i)ï¼Œç¬¬äºŒå€‹æ˜¯å…ƒç´ çš„å¼•ç”¨(\u0026amp;item) if item == b' ' {return i} ï¼šæ‰¾åˆ°ç©ºæ ¼å¾Œå›å‚³è©²ä½ç½®ï¼Œå¦‚æœæ²’æœ‰å°±å›å‚³æ•´å€‹å­—ä¸²é•·åº¦ ç¨‹å¼é›–ç„¶å¯ä»¥æˆåŠŸç·¨è­¯ï¼Œå¯ä»¥çœ‹åˆ° s çš„å…§å®¹èˆ‡ word æ˜¯æ²’æœ‰ç›´æ¥é—œä¿‚çš„ï¼Œæ‰€ä»¥ç•¶ s æ”¹è®Šå¾Œï¼Œç›´æ¥ä½¿ç”¨ word å»ç²å¾— s çš„å–®å­—ï¼Œå°±æœƒé€ æˆéŒ¯èª¤ï¼Œé€™ä¹Ÿå°è‡´éœ€è¦ç•™æ„ word æ˜¯ä¸æ˜¯èˆ‡ s è„«é‰¤ï¼Œè€Œé€™å€‹éº»ç…©å¯ä»¥ä½¿ç”¨ Rust çš„ å­—ä¸²åˆ‡ç‰‡(tring slice)ã€‚\nå­—ä¸²åˆ‡ç‰‡ fn main() { let s = String::from(\u0026#34;hello world\u0026#34;); let hello = \u0026amp;s[0..5]; let world = \u0026amp;s[6..11]; } åŸºæœ¬ä¸Šå°±æ˜¯ Python çš„ sliceï¼Œåªæ˜¯ç”¨å¼•ç”¨çš„æ–¹å¼\nèˆ‡å…¶å¼•ç”¨æ•´å€‹Â Stringï¼Œé€éÂ [0..5]Â ä¾†å¼•ç”¨äº†ä¸€éƒ¨åˆ†çš„ Stringã€‚\næ›´æ”¹ä¸Šæ–¹å›å‚³å­—ä¸²çš„ç¨‹å¼ï¼š\nfn first_word(s: \u0026amp;str) -\u0026gt; \u0026amp;str { let bytes = s.as_bytes(); for (i, \u0026amp;item) in bytes.iter().enumerate() { if item == b\u0026#39; \u0026#39; { return \u0026amp;s[0..i]; } } \u0026amp;s[..] } å¯ä»¥å°‡ fn first_word(s: \u0026amp;String) -\u0026gt; \u0026amp;String å¯«æˆ fn first_word(s: \u0026amp;str) -\u0026gt; \u0026amp;str\nç¾åœ¨ç·¨è­¯å™¨æœƒç¢ºä¿ String çš„å¼•ç”¨æ˜¯æœ‰æ•ˆçš„ï¼Œæ‰€ä»¥ç•¶ä½¿ç”¨ä»¥ä¸‹ç¨‹å¼ç¢¼é€²è¡Œç·¨è­¯ï¼Œå°±æœƒç›´æ¥è·³å‡ºéŒ¯èª¤ï¼š\nfn main() { let mut s = String::from(\u0026#34;hello world\u0026#34;); let word = first_word(\u0026amp;s); // word å–å¾—æ•¸å€¼ 5 s.clear(); // éŒ¯èª¤ println!(\u0026#34;ç¬¬ä¸€å€‹å–®å­—ç‚ºï¼š{}\u0026#34;, word); } $ cargo run Compiling ownership v0.1.0 (file:///projects/ownership) error[E0502]: cannot borrow `s` as mutable because it is also borrowed as immutable --\u0026gt; src/main.rs:18:5 | 16 | let word = first_word(\u0026amp;s); | -- immutable borrow occurs here 17 | 18 | s.clear(); // éŒ¯èª¤ï¼ | ^^^^^^^^^ mutable borrow occurs here 19 | 20 | println!(\u0026#34;ç¬¬ä¸€å€‹å–®å­—ç‚ºï¼š{}\u0026#34;, word); | ---- immutable borrow later used here For more information about this error, try `rustc --explain E0502`. error: could not compile `ownership` due to previous error å‡ºç¾éŒ¯èª¤æ˜¯å› ç‚ºå€Ÿç”¨çš„è¦å‰‡ï¼šç•¶å‘¼å« clear æœƒæ¸…é™¤ Stringï¼Œé€™è¡¨ç¤ºå®ƒå¿…é ˆæ˜¯å¯è®Šå¼•ç”¨ã€‚åœ¨ clear å¾Œå‘¼å« println! ï¼Œé€™æ™‚å°±æœƒç”¨åˆ° word çš„å¼•ç”¨ã€‚Rust ä¸å…è¨±åŒæ™‚å­˜åœ¨Â clearÂ çš„å¯è®Šå¼•ç”¨èˆ‡Â wordÂ çš„ä¸å¯è®Šå¼•ç”¨ï¼Œæ‰€ä»¥æœƒç·¨è­¯å¤±æ•—ã€‚é€™å°±èƒ½è®“é€™äº›éŒ¯èª¤åœ¨ç·¨è­¯æœŸé–“å°±è¢«ç™¼ç¾ï¼Œé€²è€Œä¿®æ”¹ã€‚\nçµè«– åœ¨é«˜ä¸­æ™‚æœŸæœ‰ä½¿ç”¨ Unity è£½ä½œééŠæˆ²ï¼Œç•¶æ™‚æ‰€ä½¿ç”¨çš„å°±æ˜¯ C# ç¨‹å¼èªè¨€ï¼Œå°æ–¼ GC é€™å€‹æ©Ÿåˆ¶æ˜¯ä¸é™Œç”Ÿçš„ï¼Œè€Œåˆ°äº†å¤§å­¸è½‰ç‚ºå¯«ç¶²é æ™‚ï¼ŒJavaScript ä¹Ÿæœ‰ GC çš„æ©Ÿåˆ¶ä¾†å›æ”¶è¨˜æ†¶é«”ã€‚ç¬¬ä¸€æ¬¡æ¥è§¸ Rust ç®¡ç†è¨˜æ†¶é«”çš„æ–¹æ³•ï¼Œæ‰€æœ‰æ¬Šçš„è¦å‰‡çœ‹ä¼¼é™åˆ¶å¾ˆå¤šå…¶å¯¦ç”¨èµ·ä¾†å¾ˆç›´è¦ºï¼Œä»–å¯ä»¥é é˜²å¾ˆå¤šå•é¡Œï¼Œä¾‹å¦‚: æŒ‡æ¨™æ˜¯ç©ºçš„ã€è¿·é€”æŒ‡æ¨™ç­‰ç­‰ã€‚\nå¼•ç”¨ ç†è§£æ‰€æœ‰æ¬Š ","permalink":"https://et860525.github.io/posts/rust-ownership/","summary":"\u003cp\u003eåœ¨ä¸€é–‹å§‹æ’°å¯«æ–‡ç« æ™‚ï¼Œæœ¬ä¾†æƒ³ä»¥å¯«æ¯”è¼ƒä¹…çš„ TypeScript ä¾†åšéƒ¨è½æ ¼çš„é–‹é ­æ–‡ç« ï¼Œä½†åœ¨éå¹´å‰æ¥è§¸åˆ° Rust é€™å€‹ç¨‹å¼èªè¨€ï¼Œå°±é †å‹¢æŠŠæœ€è¿‘å­¸åˆ°çš„æ±è¥¿æ”¾ä¸Šä¾†ã€‚ç­‰åˆ°æŠŠåœ¨ TypeScript é‡åˆ°çš„å•é¡Œæ•´ç†ä¸€ä¸‹å†å¯«æˆä¸€å€‹ç³»åˆ—æ”¾ä¸Šä¾†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eæ‰€æœ‰æ¬Š ( ownership )\u003c/strong\u003e æ˜¯ Rust ç”¨ä¾†Â \u003cstrong\u003eç®¡ç†ç¨‹å¼è¨˜æ†¶é«”çš„ä¸€ç³»åˆ—è¦å‰‡\u003c/strong\u003eï¼Œè®“ Rust ä¸éœ€è¦\u003ca href=\"https://zh.wikipedia.org/zh-tw/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6_(%E8%A8%88%E7%AE%97%E6%A9%9F%E7%A7%91%E5%AD%B8)\"\u003eåƒåœ¾å›æ”¶ ( Garbage collection )\u003c/a\u003e å°±å¯ä»¥ä¿éšœè¨˜æ†¶é«”çš„å®‰å…¨ã€‚\u003c/p\u003e","title":"Rust: æ‰€æœ‰æ¬Š( Ownership )"},{"content":"åœ¨åˆæœŸå»ºç«‹éƒ¨è½æ ¼æ™‚ï¼Œæœ¬ä¾†æ˜¯æƒ³ç§Ÿä¸€å°è™›æ“¬ä¸»æ©Ÿï¼Œå†æŠŠå¯«å¥½çš„ç¶²é ä¸Ÿä¸Šå»ï¼Œä¸éæœ€å¾Œé‚„æ˜¯é¸æ“‡ä½¿ç”¨ GitHub Pagesã€‚\nJekyll æ˜¯ Github å»ºè­°çš„éœæ…‹ç¶²ç«™ç”¢ç”Ÿå™¨ï¼Œä¸éåœ¨æŸ¥è©¢è³‡æ–™æ™‚ç™¼ç¾ç”± Go æ‰€å»ºæ§‹çš„ Hugoï¼Œé»é€²å»ç¶²é ä¸Šé¢å°±å¯«è‘—è‡ªå·±æ˜¯ã€Œä¸–ç•Œä¸Šæœ€å¿«çš„ç¶²ç«™æ¶è¨­æ¡†æ¶ã€ï¼Œé‚£ä¸è©¦è©¦çœ‹æ€éº¼è¡Œã€‚\nå®‰è£ Hugo Hugo æœ‰å…©ç¨®ç‰ˆæœ¬ï¼Œæ¨™æº–ç‰ˆ (standard) èˆ‡æ“´å……ç‰ˆ (extended)ï¼Œå®˜æ–¹æ¨è–¦ä½¿ç”¨ æ“´å……ç‰ˆã€‚\nä¸‹è¼‰çš„æ–¹å¼æ˜¯æ ¹æ“šè‡ªå·±çš„ä½œæ¥­ç³»çµ±ä¾†é¸æ“‡ï¼Œè€Œæˆ‘ä½¿ç”¨çš„æ˜¯ Linuxï¼Œå…¶ä»–çš„ä½œæ¥­ç³»çµ±å¯ä»¥åƒè€ƒ Hugo Installationã€‚\nå°æ–¼ Linux ç³»çµ±ï¼Œæœ€ç°¡å–®çš„æ–¹å¼å°±æ˜¯ç›´æ¥ä½¿ç”¨ Package managers ä¸‹è¼‰ï¼š\nsudo apt install hugo ä½†æ˜¯ç”¨é€™å€‹æ–¹å¼ä¸‹è¼‰çš„é€šå¸¸éƒ½ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œæ‰€ä»¥ Hugo é‚„æä¾› Prebuilt binaries çš„æ–¹å¼ï¼Œä¸‹è¼‰å‰è¦å…ˆç¢ºå®šç‰ˆæœ¬ (ä½¿ç”¨ç•¶ä¸‹æ˜¯ v0.109.0)ï¼š\ncd /tmp \u0026amp;\u0026amp; mkdir hugo-binary \u0026amp;\u0026amp; cd hugo-binary wget https://github.com/gohugoio/hugo/releases/download/v0.109.0/hugo_extended_0.109.0_linux-amd64.tar.gz tar -xvf hugo_extended_0.109.0_linux-amd64.tar.gz cd ../ \u0026amp;\u0026amp; rm -rf hugo-binary/ hugo version æœ€å¾Œå¦‚æœæœ‰å‡ºç¾ç‰ˆæœ¬è™Ÿå°±æ˜¯æˆåŠŸå®‰è£äº†ã€‚\nåˆå§‹åŒ–ç¶²ç«™ ä½¿ç”¨ä»¥ä¸‹å¾—æŒ‡ä»¤ä¾†å»ºç«‹å°ˆæ¡ˆçš„ç›®éŒ„ï¼š\nhugo new site my_blog é€²åˆ°è³‡æ–™å¤¾è£¡æ‰¾åˆ° config.tomlï¼Œé€™å€‹æ˜¯ Hugo çš„è¨­å®šæª”ã€‚\nå¦‚æœä½ ä¸å–œæ­¡ä½¿ç”¨ config.tomlï¼ŒHugo æœ‰æä¾› config.yaml æˆ– config.jsonï¼Œåœ¨å»ºç«‹å°ˆæ¡ˆæ™‚ä½¿ç”¨ hugo new my_project -f \u0026lt;yaml or json\u0026gt;\né¸æ“‡ä¸»é¡Œ å¯ä»¥åˆ° Hugo Themes ä¾†é¸æ“‡ä½ æƒ³è¦çš„ä¸»é¡Œï¼Œæˆ‘é€™è£¡ä½¿ç”¨ hugo-PaperModï¼š\ncd my_blog git init # åˆå§‹åŒ– Git git submodule add --depth=1 https://github.com/adityatelange/hugo-PaperMod.git themes/PaperMod git submodule update --init --recursive # needed when you reclone your repo (submodules may not get cloned automatically) æ¥è‘—å°‡ä¸»é¡Œåç¨±åŠ å…¥ config.tomlï¼š\ntheme = \u0026#34;PaperMod\u0026#34; é€šå¸¸ä¸‹è¼‰çš„ä¸»é¡Œè£¡é¢éƒ½æœƒæœ‰ exampleSite æˆ–æ˜¯å°‡å®ƒç¨ç«‹å‡ºä¾†ï¼Œéƒ½èƒ½åœ¨è©²ä¸»é¡Œçš„ Github æ‰¾åˆ°ã€‚exampleSite è£¡éƒ½æœƒæœ‰å·²ç¶“è¨­å®šå¥½çš„ config.toml å¯ä»¥ç›´æ¥å¥—ç”¨ï¼Œä¹Ÿå¯ä»¥æ ¹æ“šè‡ªå·±çš„éœ€æ±‚ä¾†è¨­å®šã€‚\nå¯ä»¥å°‡ exampleSite çš„ content è£¡çš„æª”æ¡ˆéƒ½æ”¾é€²å°ˆæ¡ˆçš„ content è£¡ï¼Œé€™å°±æ˜¯é è¨­çš„æ–‡ç« ï¼Œå¯ä»¥åœ¨é‹è¡Œç¶²ç«™æ™‚å…ˆé è¦½é¡¯ç¤ºçš„ç‹€æ…‹\né‹è¡Œç¶²ç«™ hugo server å¦‚æœæ²’æœ‰ä»»ä½•éŒ¯èª¤ï¼Œå°±å¯ä»¥åˆ° http://localhost:1313 ä¾†è§€çœ‹ç¶²ç«™ã€‚\né€™å€‹ç¶²ç«™åªé‹è¡Œåœ¨ä½ çš„é›»è…¦ä¸Šï¼Œè¦æ”¾åˆ° GitHub Pages ä¸Šæ‰èƒ½è®“å…¶ä»–äººçœ‹åˆ°\néƒ¨å±¬åˆ° GitHub Pages é¦–å…ˆï¼Œå…ˆåœ¨ Github å»ºç«‹æ–°çš„å°ˆæ¡ˆï¼Œåå­—ç‚º \u0026lt;your-account\u0026gt;.github.ioã€‚\næ ¹æ“šå®˜æ–¹æ–‡ä»¶ Host on GitHubï¼Œä½¿ç”¨ GitHub Action ä¾†éƒ¨å±¬ç¶²ç«™ï¼Œåœ¨æ ¹ç›®éŒ„ä¸‹æ–°å¢æª”æ¡ˆ .github/workflows/gh-pages.ymlï¼Œè©²æª”æ¡ˆçš„ç¨‹å¼ç¢¼ç‚ºï¼š\nname: github pages on: push: branches: - main # Set a branch that will trigger a deployment pull_request: jobs: deploy: runs-on: ubuntu-22.04 steps: - uses: actions/checkout@v3 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: \u0026#39;latest\u0026#39; # extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 if: github.ref == \u0026#39;refs/heads/main\u0026#39; with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./public å®Œæˆå¾Œå†æŠŠå°ˆæ¡ˆæ¨ä¸Šå»ï¼š\ngit status git add . git commit -m \u0026#34;Init my hugo blog\u0026#34; git branch -M main git remote add origin git@github.com:\u0026lt;your-account\u0026gt;/\u0026lt;your-account\u0026gt;.github.io.git git push -u origin master åˆ°è©² repo çš„ Actions å°±æœƒçœ‹åˆ°ä»¥ä¸‹ç•«é¢ï¼š\n![[github-actions-build.png]]\nå¦‚æœæœ‰å‡ºç¾éŒ¯èª¤ï¼Œè«‹åˆ° Repo -\u0026gt; Settings -\u0026gt; Actions -\u0026gt; General ç¢ºèª\nActions permissions è¨­å®šç‚º Allow all actions and reusable workflows Workflow permissions è¨­å®šç‚º Read and write permissions Actions å®Œæˆç·¨è­¯å¾Œï¼Œè¨­å®š Github Pages è¦ä½¿ç”¨çš„ branchï¼š\n![[github-pages-branch-select.png]]\næœ€å¾Œå†åˆ° https://\u0026lt;your-account\u0026gt;.github.io/ å°±èƒ½çœ‹åˆ°è¨­å®šçš„é é¢äº†ã€‚\n","permalink":"https://et860525.github.io/posts/hugo-with-github-pages/","summary":"\u003cp\u003eåœ¨åˆæœŸå»ºç«‹éƒ¨è½æ ¼æ™‚ï¼Œæœ¬ä¾†æ˜¯æƒ³ç§Ÿä¸€å°è™›æ“¬ä¸»æ©Ÿï¼Œå†æŠŠå¯«å¥½çš„ç¶²é ä¸Ÿä¸Šå»ï¼Œä¸éæœ€å¾Œé‚„æ˜¯é¸æ“‡ä½¿ç”¨ \u003ca href=\"https://pages.github.com/\"\u003eGitHub Pages\u003c/a\u003eã€‚\u003c/p\u003e\n\u003cp\u003eJekyll æ˜¯ Github å»ºè­°çš„éœæ…‹ç¶²ç«™ç”¢ç”Ÿå™¨ï¼Œä¸éåœ¨æŸ¥è©¢è³‡æ–™æ™‚ç™¼ç¾ç”± Go æ‰€å»ºæ§‹çš„ \u003ca href=\"https://gohugo.io/\"\u003eHugo\u003c/a\u003eï¼Œé»é€²å»ç¶²é ä¸Šé¢å°±å¯«è‘—è‡ªå·±æ˜¯ã€Œä¸–ç•Œä¸Šæœ€å¿«çš„ç¶²ç«™æ¶è¨­æ¡†æ¶ã€ï¼Œé‚£ä¸è©¦è©¦çœ‹æ€éº¼è¡Œã€‚\u003c/p\u003e","title":"å°‡ Hugo ç”¢ç”Ÿçš„éœæ…‹ç¶²ç«™éƒ¨å±¬åœ¨ GitHub Pages"}]